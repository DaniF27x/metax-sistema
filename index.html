<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaX v6.0 - Sistema Tecnológico de Auditoria FiveM</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            overflow-x: hidden;
        }
        #root { min-height: 100vh; }
        
        /* TELA DE CARREGAMENTO TECNOLÓGICA AVANÇADA */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 30%, #2a2a2a 70%, #0a0a0a 100%);
            color: #ffd700;
            position: relative;
            overflow: hidden;
        }
        
        /* FUMAÇA CINEMATOGRÁFICA DOURADA */
        .loading::before {
            content: '';
            position: absolute;
            top: -10%;
            left: -120%;
            width: 140%;
            height: 120%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 215, 0, 0.05) 10%,
                rgba(255, 215, 0, 0.2) 25%,
                rgba(255, 215, 0, 0.4) 40%,
                rgba(255, 215, 0, 0.6) 50%,
                rgba(255, 215, 0, 0.4) 60%,
                rgba(255, 215, 0, 0.2) 75%,
                rgba(255, 215, 0, 0.05) 90%,
                transparent 100%
            );
            background-size: 200% 100%;
            animation: cinema-scan-metax 15s infinite;
            z-index: 10;
            filter: blur(2px);
            box-shadow: 
                0 0 50px rgba(255, 215, 0, 0.3),
                inset 0 0 100px rgba(255, 215, 0, 0.1);
        }
        
        /* FUMAÇA CINEMATOGRÁFICA VERDE HIPNÓTICA */
        .loading::after {
            content: '';
            position: absolute;
            top: -10%;
            left: -200%;
            width: 200%;
            height: 120%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 0, 0.2) 5%,
                rgba(34, 139, 34, 0.4) 15%,
                rgba(50, 205, 50, 0.7) 30%,
                rgba(0, 255, 0, 0.9) 45%,
                rgba(50, 205, 50, 1) 50%,
                rgba(0, 255, 0, 0.9) 55%,
                rgba(50, 205, 50, 0.7) 70%,
                rgba(34, 139, 34, 0.4) 85%,
                rgba(0, 255, 0, 0.2) 95%,
                transparent 100%
            );
            background-size: 300% 100%;
            animation: cinema-scan-green-dramatic 15s infinite;
            z-index: 15;
            filter: blur(1px) brightness(1.3);
            box-shadow: 
                0 0 100px rgba(0, 255, 0, 0.8),
                0 0 200px rgba(50, 205, 50, 0.6),
                inset 0 0 150px rgba(0, 255, 0, 0.4);
            opacity: 0.9;
        }
        
        /* TEXTO CINEMATOGRÁFICO COM REVELAR LENTO */
        .secret-text {
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.2rem;
            font-weight: 900;
            color: rgba(255, 215, 0, 0);
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0),
                0 0 40px rgba(255, 215, 0, 0),
                0 0 60px rgba(255, 215, 0, 0);
            opacity: 0;
            z-index: 15;
            pointer-events: none;
            font-family: 'Arial Black', 'Impact', sans-serif;
            letter-spacing: 0.4rem;
            transition: all 2.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            text-align: center;
            white-space: nowrap;
            text-transform: uppercase;
            filter: blur(4px);
            transform-origin: center;
        }
        
        /* ESTADO REVELADO DO TEXTO */
        .secret-text.revealed {
            opacity: 1;
            color: rgba(255, 215, 0, 0.8);
            text-shadow: 
                0 0 15px rgba(255, 215, 0, 0.6),
                0 0 30px rgba(255, 215, 0, 0.4),
                0 0 45px rgba(255, 215, 0, 0.2);
            filter: blur(0px);
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        /* ESTADO REVELADO VERDE HIPNÓTICO */
        .secret-text.revealed.green {
            color: rgba(0, 255, 0, 0.9);
            text-shadow: 
                0 0 25px rgba(0, 255, 0, 0.9),
                0 0 50px rgba(50, 205, 50, 0.7),
                0 0 75px rgba(34, 139, 34, 0.5),
                0 0 100px rgba(0, 255, 0, 0.3);
            animation: green-text-dramatic-pulse 2s ease-in-out infinite;
        }
        
        /* ANIMAÇÃO DRAMÁTICA DO TEXTO VERDE */
        @keyframes green-text-dramatic-pulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1.05);
                text-shadow: 
                    0 0 25px rgba(0, 255, 0, 0.9),
                    0 0 50px rgba(50, 205, 50, 0.7),
                    0 0 75px rgba(34, 139, 34, 0.5),
                    0 0 100px rgba(0, 255, 0, 0.3);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.15);
                text-shadow: 
                    0 0 35px rgba(0, 255, 0, 1),
                    0 0 70px rgba(50, 205, 50, 0.9),
                    0 0 105px rgba(34, 139, 34, 0.7),
                    0 0 140px rgba(0, 255, 0, 0.5),
                    0 0 200px rgba(0, 255, 0, 0.2);
            }
        }
        
        /* Grid tecnológico animado */
        .tech-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 215, 0, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 215, 0, 0.15) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-pulse 3s ease-in-out infinite;
            opacity: 0.4;
        }
        
        /* Ícone principal pulsante com glow */
        .loading-icon {
            font-size: 6rem;
            margin-bottom: 2rem;
            animation: icon-glow 2s ease-in-out infinite;
            text-shadow: 
                0 0 20px #ffd700, 
                0 0 40px #ffd700, 
                0 0 60px #ffd700,
                0 0 80px #ffd700;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
        }
        
        /* Título com gradiente dourado */
        .loading-title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 1rem;
            text-align: center;
            background: linear-gradient(45deg, #ffd700 0%, #ffffff 50%, #ffd700 100%);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: title-shimmer 3s ease-in-out infinite;
            letter-spacing: 2px;
        }
        
        /* Subtítulo verde tecnológico */
        .loading-subtitle {
            font-size: 1.4rem;
            margin-bottom: 3rem;
            text-align: center;
            color: #228B22;
            font-weight: 600;
            opacity: 0.95;
            animation: subtitle-fade 2s ease-in-out infinite alternate;
        }
        
        /* Container da barra de progresso */
        .progress-container {
            width: 500px;
            max-width: 90vw;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        /* Barra de progresso animada */
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, 
                #ffd700 0%, 
                #228B22 25%, 
                #ffd700 50%, 
                #228B22 75%, 
                #ffd700 100%
            );
            background-size: 300% 100%;
            border-radius: 20px;
            animation: 
                progress-fill 10s ease-out,
                gradient-flow 2s linear infinite;
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.6),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }
        
        /* Status de carregamento */
        .loading-status {
            font-size: 1.1rem;
            color: #fff;
            margin-top: 1rem;
            animation: status-pulse 2.5s infinite;
            font-weight: 500;
            text-align: center;
        }
        
        /* EFEITO CINEMATOGRÁFICO AVANÇADO */
        @keyframes cinema-scan-metax {
            0% { 
                left: -120%; 
                opacity: 0;
                transform: scaleX(0.5);
            }
            15% {
                left: -80%;
                opacity: 0.8;
                transform: scaleX(1.2);
            }
            35% { 
                left: 20%; 
                opacity: 1;
                transform: scaleX(1);
            }
            50% {
                left: 120%;
                opacity: 0.8;
                transform: scaleX(0.8);
            }
            100% { 
                left: 150%; 
                opacity: 0;
                transform: scaleX(0.3);
            }
        }
        
        @keyframes cinema-scan-ilusion {
            0%, 60% { 
                left: -120%; 
                opacity: 0;
                transform: scaleX(0.3);
            }
            65% { 
                left: -80%; 
                opacity: 1;
                transform: scaleX(1.5);
            }
            75% { 
                left: 20%; 
                opacity: 1;
                transform: scaleX(1);
            }
            85% {
                left: 120%;
                opacity: 1;
                transform: scaleX(0.8);
            }
            100% { 
                left: 150%; 
                opacity: 0;
                transform: scaleX(0.2);
            }
        }
        

        
        @keyframes grid-pulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.02); }
        }
        
        @keyframes icon-glow {
            0%, 100% { 
                transform: scale(1); 
                text-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 60px #ffd700;
            }
            50% { 
                transform: scale(1.1); 
                text-shadow: 0 0 30px #ffd700, 0 0 60px #ffd700, 0 0 90px #ffd700, 0 0 120px #ffd700;
            }
        }
        
        @keyframes title-shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        @keyframes subtitle-fade {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        @keyframes progress-fill {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        @keyframes gradient-flow {
            0% { background-position: 0% 0%; }
            100% { background-position: 300% 0%; }
        }
        
        @keyframes status-pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* TEMA PRINCIPAL DO SISTEMA - PRETO, DOURADO, VERDE ESCURO E BRANCO */
        :root {
            --color-primary: #0a0a0a;      /* Preto principal */
            --color-secondary: #ffd700;     /* Dourado */
            --color-accent: #228B22;        /* Verde escuro */
            --color-white: #ffffff;         /* Branco */
            --color-gray-dark: #1a1a1a;     /* Cinza escuro */
            --color-gray-medium: #333333;   /* Cinza médio */
        }
        
        /* Estilos globais do sistema */
        .system-bg {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-gray-dark) 100%);
        }
        
        .tech-border {
            border: 2px solid var(--color-secondary);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .glow-text {
            text-shadow: 0 0 10px var(--color-secondary);
        }
        
        /* LOGO X ESTILOSA */
        .metax-logo {
            font-size: 6rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700 0%, #ffffff 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 215, 0, 0.6),
                0 0 60px rgba(255, 215, 0, 0.4);
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
            font-family: 'Arial Black', 'Impact', sans-serif;
            letter-spacing: 0.2rem;
            position: relative;
            display: inline-block;
            animation: logo-pulse 2s ease-in-out infinite;
        }
        
        .metax-logo::before {
            content: 'X';
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(45deg, #228B22 0%, #32CD32 50%, #228B22 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transform: scale(1.05);
            opacity: 0.3;
        }
        
        .metax-logo-small {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700 0%, #ffffff 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 
                0 0 15px rgba(255, 215, 0, 0.6),
                0 0 25px rgba(255, 215, 0, 0.4);
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6));
            font-family: 'Arial Black', 'Impact', sans-serif;
            letter-spacing: 0.1rem;
            position: relative;
            display: inline-block;
        }
        
        .metax-logo-small::before {
            content: 'X';
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(45deg, #228B22 0%, #32CD32 50%, #228B22 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transform: scale(1.05);
            opacity: 0.2;
        }
        
        .metax-logo-tiny {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700 0%, #ffffff 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 
                0 0 10px rgba(255, 215, 0, 0.5),
                0 0 20px rgba(255, 215, 0, 0.3);
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.5));
            font-family: 'Arial Black', 'Impact', sans-serif;
            letter-spacing: 0.05rem;
            position: relative;
            display: inline-block;
        }
        
        .metax-logo-tiny::before {
            content: 'X';
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(45deg, #228B22 0%, #32CD32 50%, #228B22 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transform: scale(1.05);
            opacity: 0.15;
        }
        
        @keyframes logo-pulse {
            0%, 100% { 
                transform: scale(1); 
                filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
            }
            50% { 
                transform: scale(1.05); 
                filter: drop-shadow(0 0 40px rgba(255, 215, 0, 1));
            }
        }
        
        /* 🌫️ ANIMAÇÃO DA FUMAÇA VERDE HIPNÓTICA */
        @keyframes green-glow-pulse {
            0%, 100% { 
                transform: scale(1); 
                filter: drop-shadow(0 0 25px rgba(0, 255, 0, 0.9));
            }
            50% { 
                transform: scale(1.08); 
                filter: drop-shadow(0 0 50px rgba(34, 139, 34, 1)) drop-shadow(0 0 80px rgba(0, 255, 0, 0.6));
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="tech-grid"></div>
            <div class="secret-text" id="secret-text">GROUP METAX</div>
            <div class="loading-icon">
                <div class="metax-logo">X</div>
            </div>
            <div class="loading-title">Bem-vindo Auditoria MetaX</div>
            <div class="loading-subtitle">Sistema Único e Exclusivo Mundial de Auditoria FiveM</div>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
            <div class="loading-status">Inicializando sistemas avançados de auditoria...</div>
        </div>
    </div>
    
    <script>
        console.log('🔥 Iniciando MetaX v6.0 - Sistema Tecnológico de Auditoria...');
        
        // 🎬 EFEITO CINEMATOGRÁFICO SINCRONIZADO COM A FUMAÇA
        const secretTextElement = document.getElementById('secret-text');
        const texts = ['GROUP METAX', 'ILUSION CITY'];
        
        // FUNÇÃO PARA REVELAR TEXTO DE FORMA CINEMATOGRÁFICA
        const revealText = (text, isGreen = false, delay = 0) => {
            setTimeout(() => {
                secretTextElement.textContent = text;
                
                // Adicionar classes cinematográficas
                secretTextElement.classList.add('revealed');
                if (isGreen) {
                    secretTextElement.classList.add('green');
                } else {
                    secretTextElement.classList.remove('green');
                }
                
                console.log(`🎬 Revelando: ${text} ${isGreen ? '(Verde Hipnótico)' : '(Dourado)'}`);
            }, delay);
        };
        
        // FUNÇÃO PARA OCULTAR TEXTO DE FORMA CINEMATOGRÁFICA
        const hideText = (delay = 0) => {
            setTimeout(() => {
                secretTextElement.classList.remove('revealed', 'green');
                console.log('🌫️ Ocultando texto...');
            }, delay);
        };
        
        // 🎭 SEQUÊNCIA CINEMATOGRÁFICA SINCRONIZADA (10 segundos de ciclo)
        
        // PRIMEIRA REVELAÇÃO: GROUP METAX (sincronizada com fumaça dourada)
        setTimeout(() => {
            revealText(texts[0], false); // Dourado
        }, 1500); // Sincronizado com 15% da animação (10s * 0.15 = 1.5s)
        
        // OCULTAR PRIMEIRO TEXTO
        setTimeout(() => {
            hideText();
        }, 4000); // Oculta aos 4s para dar tempo para o segundo
        
        // SEGUNDA REVELAÇÃO: ILUSION CITY (sincronizada com fumaça verde DRAMÁTICA)
        setTimeout(() => {
            revealText(texts[1], true); // Verde hipnótico
        }, 5000); // Aparece aos 5s (50% de 10s = momento máximo da fumaça verde)
        
        // OCULTAR SEGUNDO TEXTO
        setTimeout(() => {
            hideText();
        }, 8500); // Oculta aos 8.5s (ainda dentro dos 10s de loading)
        
        // REPETIR CICLO A CADA 15 SEGUNDOS (sincronizado com animações)
        setInterval(() => {
            // GROUP METAX (com fumaça dourada)
            setTimeout(() => revealText(texts[0], false), 1500);
            setTimeout(() => hideText(), 4000);
            
            // ILUSION CITY (com fumaça verde DRAMÁTICA)
            setTimeout(() => revealText(texts[1], true), 5000);
            setTimeout(() => hideText(), 8500);
        }, 15000);
        
        // Aguardar carregamento completo com tela tecnológica de 10 segundos
        setTimeout(() => {
            try {
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    throw new Error('React não carregado');
                }

                const { useState, useEffect, createElement: h } = React;
                
                // ⚡ CONFIGURAÇÃO DO SUPABASE ⚡
                const SUPABASE_URL = 'https://jrgzyeufpccitppcwzxh.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyZ3p5ZXVmcGNjaXRwcGN3enhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NDExNTYsImV4cCI6MjA3MDQxNzE1Nn0.asaczDLMqXdkK_XpogA4IRmXYqLcAGsu2hSCG4fkdQE';
                
                // Inicializar Supabase
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                // Hook para dados do Supabase
                const useSupabaseData = (table, dependencies = []) => {
                    const [data, setData] = useState([]);
                    const [loading, setLoading] = useState(true);
                    
                    const fetchData = async () => {
                        try {
                            const { data: result, error } = await supabase
                                .from(table)
                                .select('*')
                                .order('created_at', { ascending: false });
                            
                            if (error) throw error;
                            setData(result || []);
                        } catch (error) {
                            console.error(`Erro ao carregar ${table}:`, error);
                            // Fallback para localStorage em caso de erro
                            const stored = localStorage.getItem(`metax_${table}`);
                            if (stored) setData(JSON.parse(stored));
                        } finally {
                            setLoading(false);
                        }
                    };
                    
                    useEffect(() => {
                        fetchData();
                    }, dependencies);
                    
                    return [data, setData, loading, fetchData];
                };
                
                // Função para salvar no Supabase
                const saveToSupabase = async (table, data, isUpdate = false) => {
                    console.log(`💾 Tentando salvar em ${table}:`, { data, isUpdate });
                    try {
                        let result;
                        if (isUpdate) {
                            console.log('🔄 Fazendo UPDATE com ID:', data.id);
                            result = await supabase
                                .from(table)
                                .update(data)
                                .eq('id', data.id);
                        } else {
                            console.log('➕ Fazendo INSERT:', data);
                            result = await supabase
                                .from(table)
                                .insert([data]);
                        }
                        
                        console.log('📊 Resultado Supabase:', result);
                        if (result.error) {
                            console.error('🚨 Erro específico do Supabase:', result.error);
                            throw result.error;
                        }
                        console.log('✅ Sucesso no Supabase!');
                        return result;
                    } catch (error) {
                        console.error(`❌ Erro ao salvar em ${table}:`, error);
                        // Fallback para localStorage
                        const stored = JSON.parse(localStorage.getItem(`metax_${table}`) || '[]');
                        if (isUpdate) {
                            const updated = stored.map(item => item.id === data.id ? data : item);
                            localStorage.setItem(`metax_${table}`, JSON.stringify(updated));
                        } else {
                            stored.push(data);
                            localStorage.setItem(`metax_${table}`, JSON.stringify(stored));
                        }
                        throw error;
                    }
                };

                // Componente principal do sistema
                const MetaXSystem = () => {
                    // Estados locais
                    const [currentUser, setCurrentUser] = useState(null);
                    const [currentView, setCurrentView] = useState('login');
                    

                    
                    // Dados do Supabase
                    const [users, setUsers, usersLoading, refetchUsers] = useSupabaseData('usuarios');
                    const [checklists, setChecklists, checklistsLoading, refetchChecklists] = useSupabaseData('checklists');
                    const [auditorias, setAuditorias, auditoriasLoading, refetchAuditorias] = useSupabaseData('auditorias');
                    const [solicitacoesFinanceiras, setSolicitacoesFinanceiras, financeirasLoading, refetchFinanceiras] = useSupabaseData('solicitacoes_financeiras');
                    const [topDoMes, setTopDoMes, topDoMesLoading, refetchTopDoMes] = useSupabaseData('top_do_mes');
                    const [feedbacksPrefeitura, setFeedbacksPrefeitura, feedbacksLoading, refetchFeedbacks] = useSupabaseData('feedbacks_prefeitura');
                    
                    // Separar usuários aprovados e pendentes
                    const approvedUsers = users.filter(u => u.status === 'aprovado');
                    const pendingUsers = users.filter(u => u.status === 'pendente');
                    
                    // Função para obter aprovadores disponíveis
                    const getAprovadores = (tipoItem = 'geral') => {
                        if (tipoItem === 'lei') {
                            // Para leis, apenas Diretores podem aprovar
                            return approvedUsers.filter(u => u.cargo === 'Diretor');
                        }
                        // Para outros itens, CEO e Diretor podem aprovar
                        return approvedUsers.filter(u => 
                            u.cargo === 'CEO' || u.cargo === 'Diretor'
                        );
                    };

                    // Componente para mostrar aprovadores disponíveis
                    const AprovadoresInfo = ({ item, tipo = 'geral' }) => {
                        if (item.status !== 'aguardando_aprovacao' && item.status !== 'pendente') return null;
                        
                        const aprovadores = getAprovadores(tipo);
                        
                        return h('div', {
                            style: {
                                marginTop: '15px',
                                padding: '15px',
                                background: 'rgba(255, 215, 0, 0.1)',
                                border: '2px solid rgba(255, 215, 0, 0.3)',
                                borderRadius: '10px'
                            }
                        },
                            h('h5', {
                                style: {
                                    color: '#ffd700',
                                    margin: '0 0 10px 0',
                                    fontSize: '1rem',
                                    fontWeight: '700'
                                }
                            }, '👥 Quem pode aprovar:'),
                            h('div', {
                                style: {
                                    color: '#fff',
                                    fontSize: '0.9rem'
                                }
                            },
                                aprovadores.length > 0 
                                    ? aprovadores.map(aprovador => 
                                        h('div', {
                                            key: aprovador.id,
                                            style: {
                                                margin: '2px 0',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px'
                                            }
                                        },
                                            h('span', null, '•'),
                                            h('strong', { style: { color: '#ffd700' } }, aprovador.cargo),
                                            h('span', null, ' - '),
                                            h('span', null, aprovador.nome),
                                            h('span', { style: { color: '#228B22', fontSize: '0.8rem' } }, ` (ID: ${aprovador.id})`)
                                        )
                                    )
                                    : h('span', { style: { color: '#DC143C' } }, 'Nenhum aprovador disponível no momento')
                            ),
                            h('p', {
                                style: {
                                    color: '#228B22',
                                    fontSize: '0.85rem',
                                    margin: '8px 0 0 0',
                                    fontStyle: 'italic'
                                }
                            }, '💡 Se demorar muito, você pode entrar em contato diretamente!')
                        );
                    };

                    // Componente para mostrar histórico de aprovação
                    const HistoricoAprovacao = ({ item }) => {
                        if (item.status === 'aguardando_aprovacao' || item.status === 'pendente') return null;
                        
                        const isAprovado = item.status === 'aprovado' || item.status === 'aprovada' || item.status === 'ativo';
                        const isReprovado = item.status === 'reprovado' || item.status === 'reprovada';
                        
                        return h('div', {
                            style: {
                                marginTop: '15px',
                                padding: '12px',
                                background: isAprovado 
                                    ? 'rgba(34, 139, 34, 0.1)' 
                                    : 'rgba(220, 20, 60, 0.1)',
                                border: `2px solid ${isAprovado ? 'rgba(34, 139, 34, 0.3)' : 'rgba(220, 20, 60, 0.3)'}`,
                                borderRadius: '8px'
                            }
                        },
                            isAprovado && [
                                item.aprovador && h('p', {
                                    key: 'aprovador',
                                    style: { color: '#228B22', margin: '0 0 5px 0', fontSize: '0.9rem', fontWeight: '600' }
                                }, `✅ Aprovado por: ${item.aprovador}`),
                                item.dataAprovacao && h('p', {
                                    key: 'data',
                                    style: { color: '#228B22', margin: '0', fontSize: '0.85rem' }
                                }, `📅 Data: ${new Date(item.dataAprovacao).toLocaleDateString('pt-BR')} às ${new Date(item.dataAprovacao).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`)
                            ],
                            isReprovado && [
                                item.reprovador && h('p', {
                                    key: 'reprovador',
                                    style: { color: '#DC143C', margin: '0 0 5px 0', fontSize: '0.9rem', fontWeight: '600' }
                                }, `❌ Reprovado por: ${item.reprovador}`),
                                item.dataReprovacao && h('p', {
                                    key: 'data',
                                    style: { color: '#DC143C', margin: '0', fontSize: '0.85rem' }
                                }, `📅 Data: ${new Date(item.dataReprovacao).toLocaleDateString('pt-BR')} às ${new Date(item.dataReprovacao).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`)
                            ]
                        );
                    };

                    // Inicializar usuários padrão
                    useEffect(() => {
                        const defaultUsers = [
                            {
                                id: 'admin001',
                                nome: 'Admin Sistema',
                                senha: 'admin123',
                                cargo: 'CEO',
                                status: 'aprovado',
                                createdAt: new Date().toISOString()
                            },
                            {
                                id: '7',
                                nome: 'Daniel',
                                senha: '5609984',
                                cargo: 'Diretor',
                                status: 'aprovado',
                                createdAt: new Date().toISOString()
                            }
                        ];

                        if (users.length === 0) {
                            setUsers(defaultUsers);
                        }
                    }, []);

                    // Componente de Login
                    const LoginPage = () => {
                        const [formData, setFormData] = useState({ id: '', senha: '' });
                        const [isRegister, setIsRegister] = useState(false);
                        const [registerData, setRegisterData] = useState({
                            nome: '', id: '', senha: '', cargo: 'Staff Geral'
                        });

                        const handleLogin = async (e) => {
                            e.preventDefault();
                            
                            const user = approvedUsers.find(u => 
                                String(u.id) === String(formData.id) && 
                                String(u.senha) === String(formData.senha)
                            );
                            
                            if (user) {
                                setCurrentUser(user);
                                setCurrentView('dashboard');
                                localStorage.setItem('metax_currentUser', JSON.stringify(user));
                                console.log('✅ Login realizado:', user.nome);
                            } else {
                                alert('❌ ID ou senha incorretos!');
                            }
                        };

                        const handleRegister = async (e) => {
                            e.preventDefault();
                            
                            if (!registerData.nome || !registerData.id || !registerData.senha) {
                                alert('⚠️ Preencha todos os campos!');
                                return;
                            }

                            const userExists = users.find(u => u.id === registerData.id);
                            if (userExists) {
                                alert('❌ ID já existe!');
                                return;
                            }

                            const newUser = {
                                ...registerData,
                                status: 'pendente'
                            };

                            try {
                                await saveToSupabase('usuarios', newUser);
                                refetchUsers(); // Recarregar lista de usuários
                                alert('✅ Cadastro enviado para aprovação!');
                                setIsRegister(false);
                                setRegisterData({ nome: '', id: '', senha: '', cargo: 'Staff Geral' });
                            } catch (error) {
                                alert('❌ Erro ao registrar usuário. Tente novamente.');
                            }
                        };



                        const inputStyle = {
                            width: '100%',
                            padding: '16px',
                            border: '2px solid #ffd700',
                            borderRadius: '12px',
                            background: 'rgba(0,0,0,0.7)',
                            color: '#fff',
                            fontSize: '16px',
                            fontWeight: '500',
                            boxShadow: '0 0 15px rgba(255, 215, 0, 0.2)'
                        };

                        const buttonStyle = {
                            width: '100%',
                            padding: '16px',
                            borderRadius: '12px',
                            border: '2px solid #ffd700',
                            fontSize: '16px',
                            fontWeight: 'bold',
                            cursor: 'pointer',
                            marginBottom: '12px',
                            transition: 'all 0.3s ease',
                            textTransform: 'uppercase',
                            letterSpacing: '1px'
                        };

                        return h('div', {
                            style: {
                                minHeight: '100vh',
                                background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #2a2a2a 100%)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                padding: '20px',
                                position: 'relative'
                            }
                        },
                            // Grid tecnológico de fundo
                            h('div', {
                                style: {
                                    position: 'absolute',
                                    top: 0,
                                    left: 0,
                                    width: '100%',
                                    height: '100%',
                                    backgroundImage: `
                                        linear-gradient(rgba(255, 215, 0, 0.1) 1px, transparent 1px),
                                        linear-gradient(90deg, rgba(255, 215, 0, 0.1) 1px, transparent 1px)
                                    `,
                                    backgroundSize: '50px 50px',
                                    opacity: 0.3,
                                    animation: 'grid-move 6s linear infinite'
                                }
                            }),
                            h('div', {
                                style: {
                                    background: 'rgba(0,0,0,0.85)',
                                    backdropFilter: 'blur(15px)',
                                    borderRadius: '24px',
                                    padding: '50px',
                                    width: '100%',
                                    maxWidth: '450px',
                                    border: '3px solid #ffd700',
                                    boxShadow: '0 0 60px rgba(255, 215, 0, 0.4)',
                                    position: 'relative',
                                    zIndex: 1
                                }
                            },
                                // Header
                                h('div', { style: { textAlign: 'center', marginBottom: '40px' } },
                                    h('div', { style: { display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '16px', marginBottom: '12px' } },
                                        h('div', { 
                                            className: 'metax-logo-small',
                                            style: { 
                                                fontSize: '3rem',
                                                fontWeight: '900',
                                                background: 'linear-gradient(45deg, #ffd700, #fff)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent',
                                                backgroundClip: 'text',
                                                textShadow: '0 0 20px rgba(255, 215, 0, 0.6)',
                                                filter: 'drop-shadow(0 0 20px rgba(255, 215, 0, 0.6))',
                                                fontFamily: 'Arial Black, Impact, sans-serif',
                                                letterSpacing: '0.1rem'
                                            } 
                                        }, 'X'),
                                        h('h1', { 
                                            style: { 
                                                background: 'linear-gradient(45deg, #ffd700, #fff)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent',
                                                backgroundClip: 'text',
                                                fontSize: '2.8rem', 
                                                margin: 0, 
                                                fontWeight: '900',
                                                textShadow: '0 0 30px rgba(255, 215, 0, 0.5)',
                                                letterSpacing: '2px'
                                            } 
                                        }, 'Sistema MetaX')
                                    ),
                                    h('p', { 
                                        style: { 
                                            color: '#228B22', 
                                            fontSize: '1.2rem',
                                            fontWeight: '600',
                                            textShadow: '0 0 10px rgba(34, 139, 34, 0.3)'
                                        } 
                                    }, 'Sistema Único e Exclusivo Mundial de Auditoria FiveM')
                                ),

                                // Formulários
                                !isRegister ? (
                                    // Login Form
                                    h('form', { onSubmit: handleLogin },
                                        h('div', { style: { marginBottom: '24px' } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'ID do Usuário'),
                                            h('input', {
                                                type: 'text',
                                                value: formData.id,
                                                onChange: (e) => setFormData({ ...formData, id: e.target.value }),
                                                placeholder: 'Digite seu ID',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '24px' } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Senha'),
                                            h('input', {
                                                type: 'password',
                                                value: formData.senha,
                                                onChange: (e) => setFormData({ ...formData, senha: e.target.value }),
                                                placeholder: 'Digite sua senha',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('button', {
                                            type: 'submit',
                                            style: { 
                                                ...buttonStyle, 
                                                background: 'linear-gradient(45deg, #ffd700, #228B22)', 
                                                color: '#000', 
                                                boxShadow: '0 0 25px rgba(255, 215, 0, 0.5)',
                                                fontWeight: '900'
                                            }
                                        }, 'Entrar no Sistema'),
                                        h('button', {
                                            type: 'button',
                                            onClick: () => setIsRegister(true),
                                            style: { ...buttonStyle, background: 'transparent', color: '#ffd700', border: '2px solid #ffd700' }
                                        }, 'Criar Nova Conta'),

                                    )
                                ) : (
                                    // Register Form
                                    h('form', { onSubmit: handleRegister },
                                        h('div', { style: { marginBottom: '20px' } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, 'Nome Completo'),
                                            h('input', {
                                                type: 'text',
                                                value: registerData.nome,
                                                onChange: (e) => setRegisterData({ ...registerData, nome: e.target.value }),
                                                placeholder: 'Seu nome completo',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '20px' } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, 'ID Único'),
                                            h('input', {
                                                type: 'text',
                                                value: registerData.id,
                                                onChange: (e) => setRegisterData({ ...registerData, id: e.target.value }),
                                                placeholder: 'Escolha um ID único',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '20px' } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, 'Senha'),
                                            h('input', {
                                                type: 'password',
                                                value: registerData.senha,
                                                onChange: (e) => setRegisterData({ ...registerData, senha: e.target.value }),
                                                placeholder: 'Crie uma senha segura',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '24px' } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, 'Cargo Desejado'),
                                            h('select', {
                                                value: registerData.cargo,
                                                onChange: (e) => setRegisterData({ ...registerData, cargo: e.target.value }),
                                                style: { ...inputStyle, color: '#fff' },
                                                required: true
                                            },
                                                ['CEO', 'Diretor', 'Alta Cúpula', 'ADM Staff', 'RESP Comunidade', 'Mentoria', 'Staff Geral'].map(cargo =>
                                                    h('option', { key: cargo, value: cargo }, cargo)
                                                )
                                            )
                                        ),
                                        h('button', {
                                            type: 'submit',
                                            style: { ...buttonStyle, background: 'linear-gradient(45deg, #228B22, #ffd700)', color: '#000', fontWeight: '900' }
                                        }, 'Registrar'),
                                        h('button', {
                                            type: 'button',
                                            onClick: () => setIsRegister(false),
                                            style: { ...buttonStyle, background: 'transparent', color: '#ffd700', border: '2px solid #ffd700' }
                                        }, 'Voltar ao Login')
                                    )
                                )
                            )
                        );
                    };

                    // Header do sistema
                    const Header = () => h('header', {
                        style: {
                            background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)',
                            borderBottom: '4px solid #ffd700',
                            boxShadow: '0 0 30px rgba(255, 215, 0, 0.4)'
                        }
                    },
                        h('div', {
                            style: {
                                maxWidth: '1200px',
                                margin: '0 auto',
                                padding: '20px 24px',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center'
                            }
                        },
                            h('div', null,
                                h('div', { style: { display: 'flex', alignItems: 'center', gap: '12px' } },
                                    h('div', { 
                                        className: 'metax-logo-tiny',
                                        style: {
                                            fontSize: '2.2rem',
                                            fontWeight: '900',
                                            background: 'linear-gradient(45deg, #ffd700, #fff)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            backgroundClip: 'text',
                                            textShadow: '0 0 15px rgba(255, 215, 0, 0.5)',
                                            filter: 'drop-shadow(0 0 15px rgba(255, 215, 0, 0.6))',
                                            fontFamily: 'Arial Black, Impact, sans-serif',
                                            letterSpacing: '0.05rem'
                                        }
                                    }, 'X'),
                                    h('h1', { 
                                        style: { 
                                            fontSize: '2rem', 
                                            fontWeight: '900', 
                                            background: 'linear-gradient(45deg, #ffd700, #fff)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            backgroundClip: 'text',
                                            margin: 0,
                                            textShadow: '0 0 30px rgba(255, 215, 0, 0.5)',
                                            letterSpacing: '1px'
                                        } 
                                    }, 'Sistema MetaX')
                                ),
                                h('p', { 
                                    style: { 
                                        fontSize: '1rem', 
                                        color: '#228B22', 
                                        margin: '4px 0 0 0', 
                                        fontWeight: '700',
                                        textShadow: '0 0 10px rgba(34, 139, 34, 0.3)'
                                    } 
                                }, 'Sistema Único e Exclusivo Mundial de Auditoria FiveM')
                            ),
                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '20px' } },
                                h('div', { style: { textAlign: 'right' } },
                                    h('p', { style: { fontWeight: '700', color: '#ffd700', margin: 0, fontSize: '1.1rem' } }, `${currentUser?.cargo} - ${currentUser?.nome}`),
                                    h('p', { style: { fontSize: '0.9rem', color: '#228B22', margin: 0, fontWeight: '600' } }, `ID: ${currentUser?.id}`)
                                ),
                                h('button', {
                                    onClick: () => {
                                        setCurrentUser(null);
                                        setCurrentView('login');
                                    },
                                    style: {
                                        background: 'linear-gradient(45deg, #228B22, #ffd700)',
                                        color: '#000',
                                        padding: '12px 20px',
                                        border: '2px solid #ffd700',
                                        borderRadius: '10px',
                                        cursor: 'pointer',
                                        fontWeight: '900',
                                        textTransform: 'uppercase',
                                        letterSpacing: '1px'
                                    }
                                }, 'Sair')
                            )
                        )
                    );

                    // Navegação lateral
                    const Sidebar = () => h('nav', {
                        style: {
                            background: 'linear-gradient(180deg, #0a0a0a 0%, #1a1a1a 100%)',
                            color: '#ffd700',
                            width: '300px',
                            minHeight: 'calc(100vh - 84px)',
                            padding: '24px 0',
                            borderRight: '3px solid #ffd700',
                            boxShadow: '0 0 25px rgba(255, 215, 0, 0.3)'
                        }
                    },
                        h('div', { style: { padding: '0 24px' } },
                            [
                                { id: 'dashboard', label: '📊 Dashboard', icon: '📊' },
                                { id: 'checklist', label: '✅ Checklist', icon: '✅' },
                                { id: 'auditoria', label: '🔍 Auditoria', icon: '🔍' },
                                { id: 'topdomes', label: '🏆 Top do Mês', icon: '🏆' },
                                { id: 'painel', label: '🏙️ Painel da Cidade', icon: '🏙️' },
                                { id: 'financeiro', label: '💸 Painel Financeiro', icon: '💸' },
                                { id: 'legislativo', label: '📘 Legislativo Digital', icon: '📘' },
                                { id: 'feedback', label: '🏛️ Prefeitura/Política', icon: '🏛️' },
                                ...(currentUser?.cargo === 'CEO' || currentUser?.cargo === 'Diretor' 
                                    ? [{ id: 'admin', label: '⚙️ Administração', icon: '⚙️' }] 
                                    : [])
                            ].map(item =>
                                h('button', {
                                    key: item.id,
                                    onClick: () => setCurrentView(item.id),
                                    style: {
                                        width: '100%',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '15px',
                                        padding: '16px 20px',
                                        background: currentView === item.id ? 'linear-gradient(90deg, #ffd700, #228B22)' : 'transparent',
                                        color: currentView === item.id ? '#000' : '#ffd700',
                                        border: currentView === item.id ? '2px solid #ffd700' : '2px solid transparent',
                                        borderRadius: '12px',
                                        cursor: 'pointer',
                                        marginBottom: '12px',
                                        fontSize: '1.1rem',
                                        textAlign: 'left',
                                        fontWeight: currentView === item.id ? '900' : '700',
                                        transition: 'all 0.3s ease',
                                        textTransform: 'uppercase',
                                        letterSpacing: '0.5px',
                                        boxShadow: currentView === item.id ? '0 0 15px rgba(255, 215, 0, 0.3)' : 'none'
                                    }
                                }, item.label)
                            )
                        )
                    );

                    // Dashboard
                    const DashboardPage = () => {
                        const meusChecklists = checklists.filter(c => c.autorId === currentUser?.id);
                        const minhasAuditorias = auditorias.filter(a => a.autorId === currentUser?.id);
                        const meusPendentes = [...checklists, ...auditorias].filter(item => 
                            item.status === 'aguardando_aprovacao' && item.autorId === currentUser?.id
                        );
                        
                        const meusAprovados = [...checklists, ...auditorias].filter(item => 
                            (item.status === 'aprovado' || item.status === 'aprovada') && item.autorId === currentUser?.id
                        );
                        
                        const totalItens = meusChecklists.length + minhasAuditorias.length;
                        const taxaAprovacao = totalItens > 0 ? Math.round((meusAprovados.length / totalItens) * 100) : 0;

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { 
                                        style: { 
                                            fontSize: '2.8rem', 
                                            fontWeight: '900', 
                                            background: 'linear-gradient(45deg, #ffd700, #fff)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            backgroundClip: 'text',
                                            marginBottom: '40px',
                                            textShadow: '0 0 30px rgba(255, 215, 0, 0.5)',
                                            letterSpacing: '1px'
                                        } 
                                    }, `🎯 Dashboard`),
                                    
                                    // Cards de estatísticas principais
                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '30px', marginBottom: '40px' } },
                                        h('div', { style: { background: 'linear-gradient(135deg, #ffd700, #228B22)', color: '#000', padding: '32px', borderRadius: '20px', position: 'relative', overflow: 'hidden', border: '3px solid #ffd700', boxShadow: '0 0 40px rgba(255, 215, 0, 0.4)' } },
                                            h('div', { style: { position: 'absolute', top: '-30px', right: '-30px', fontSize: '10rem', opacity: 0.1 } }, '✅'),
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '✅'),
                                            h('h3', { style: { fontSize: '1.4rem', marginBottom: '12px', opacity: 0.95, fontWeight: '700' } }, 'Meus Checklists'),
                                            h('p', { style: { fontSize: '3.5rem', fontWeight: '900', margin: '0 0 12px 0' } }, meusChecklists.length),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '1rem', fontWeight: '600' } }, 
                                                    `${meusChecklists.filter(c => c.status === 'aprovado').length} aprovados • ${meusChecklists.filter(c => c.status === 'aguardando_aprovacao').length} pendentes`
                                                )
                                            )
                                        ),
                                        h('div', { style: { background: 'linear-gradient(135deg, #228B22, #ffd700)', color: '#000', padding: '32px', borderRadius: '20px', position: 'relative', overflow: 'hidden', border: '3px solid #228B22', boxShadow: '0 0 40px rgba(34, 139, 34, 0.4)' } },
                                            h('div', { style: { position: 'absolute', top: '-30px', right: '-30px', fontSize: '10rem', opacity: 0.1 } }, '🔍'),
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '🔍'),
                                            h('h3', { style: { fontSize: '1.4rem', marginBottom: '12px', opacity: 0.95, fontWeight: '700' } }, 'Minhas Auditorias'),
                                            h('p', { style: { fontSize: '3.5rem', fontWeight: '900', margin: '0 0 12px 0' } }, minhasAuditorias.length),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '1rem', fontWeight: '600' } }, 
                                                    `${minhasAuditorias.filter(a => a.status === 'aprovada').length} aprovadas • ${minhasAuditorias.filter(a => a.status === 'aguardando_aprovacao').length} pendentes`
                                                )
                                            )
                                        ),
                                        h('div', { style: { background: 'linear-gradient(135deg, #ffffff, #ffd700)', color: '#000', padding: '32px', borderRadius: '20px', position: 'relative', overflow: 'hidden', border: '3px solid #fff', boxShadow: '0 0 40px rgba(255, 255, 255, 0.4)' } },
                                            h('div', { style: { position: 'absolute', top: '-30px', right: '-30px', fontSize: '10rem', opacity: 0.1 } }, '⏳'),
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '⏳'),
                                            h('h3', { style: { fontSize: '1.4rem', marginBottom: '12px', opacity: 0.95, fontWeight: '700' } }, 'Aguardando Aprovação'),
                                            h('p', { style: { fontSize: '3.5rem', fontWeight: '900', margin: '0 0 12px 0' } }, meusPendentes.length),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '1rem', fontWeight: '600' } }, 
                                                    meusPendentes.length > 0 ? 'Aguarde a revisão' : 'Tudo aprovado! 🎉'
                                                )
                                            )
                                        ),
                                        h('div', { style: { background: 'linear-gradient(135deg, #ffd700, #ffffff)', color: '#000', padding: '32px', borderRadius: '20px', position: 'relative', overflow: 'hidden', border: '3px solid #ffd700', boxShadow: '0 0 40px rgba(255, 215, 0, 0.4)' } },
                                            h('div', { style: { position: 'absolute', top: '-30px', right: '-30px', fontSize: '10rem', opacity: 0.1 } }, '📊'),
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '📊'),
                                            h('h3', { style: { fontSize: '1.4rem', marginBottom: '12px', opacity: 0.95, fontWeight: '700' } }, 'Taxa de Aprovação'),
                                            h('p', { style: { fontSize: '3.5rem', fontWeight: '900', margin: '0 0 12px 0' } }, `${taxaAprovacao}%`),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '1rem', fontWeight: '600' } }, 
                                                    `${meusAprovados.length} de ${totalItens} aprovados`
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página de Checklist
                    const ChecklistPage = () => {
                        const [novoChecklist, setNovoChecklist] = useState({
                            id: '', servidor: '', funcionario: '', observacao: '', aprovador: '',
                            // Perguntas Staff
                            pontualidade: '', organizacao: '', comunicacao: '', relacionamento: '', conhecimento: '', dedicacao: '', lideranca: '', resolucao: '', iniciativa: '', etica: '',
                            // Perguntas RP
                            interpretacao: '', criatividade: '', adaptacao: '', consistencia: '', interacao: '', narrativa: '', emocional: '', improvisacao: '', imersao: '', conflito: ''
                        });
                        const [mostrarFormulario, setMostrarFormulario] = useState(false);
                        const [tipoChecklist, setTipoChecklist] = useState('staff');
                        const [orgRPChecklist, setOrgRPChecklist] = useState('igreja');

                        const perguntasStaff = [
                            { key: 'pontualidade', label: 'Pontualidade', max: 10 },
                            { key: 'organizacao', label: 'Organização', max: 10 },
                            { key: 'comunicacao', label: 'Comunicação', max: 10 },
                            { key: 'relacionamento', label: 'Relacionamento Interpessoal', max: 10 },
                            { key: 'conhecimento', label: 'Conhecimento Técnico', max: 10 },
                            { key: 'dedicacao', label: 'Dedicação e Compromet imento', max: 10 },
                            { key: 'lideranca', label: 'Liderança', max: 10 },
                            { key: 'resolucao', label: 'Resolução de Problemas', max: 10 },
                            { key: 'iniciativa', label: 'Iniciativa', max: 10 },
                            { key: 'etica', label: 'Ética Profissional', max: 10 },
                            { key: 'membrosOnline', label: 'Quantidade de Membros Online no Painel', type: 'number' }
                        ];

                        const perguntasRP = [
                            { key: 'interpretacao', label: 'Interpretação de Personagem', max: 10 },
                            { key: 'criatividade', label: 'Criatividade nas Ações', max: 10 },
                            { key: 'adaptacao', label: 'Adaptação a Situações', max: 10 },
                            { key: 'consistencia', label: 'Consistência no RP', max: 10 },
                            { key: 'interacao', label: 'Interação com Outros', max: 10 },
                            { key: 'narrativa', label: 'Construção de Narrativa', max: 10 },
                            { key: 'emocional', label: 'Expressão Emocional', max: 10 },
                            { key: 'improvisacao', label: 'Capacidade de Improviso', max: 10 },
                            { key: 'imersao', label: 'Imersão no Ambiente', max: 10 },
                            { key: 'conflito', label: 'Gestão de Conflitos RP', max: 10 }
                        ];

                        const calcularNotaTotal = () => {
                            const perguntas = tipoChecklist === 'staff' ? perguntasStaff : perguntasRP;
                            let total = 0;
                            perguntas.forEach(p => {
                                if (p.type === 'number') return; // Não conta para nota total
                                const valor = parseFloat(novoChecklist[p.key]) || 0;
                                total += valor;
                            });
                            return total;
                        };

                        const handleSubmitChecklist = (e) => {
                            e.preventDefault();
                            
                            if (!novoChecklist.id || !novoChecklist.servidor || !novoChecklist.funcionario) {
                                alert('⚠️ Preencha todos os campos obrigatórios!');
                                return;
                            }

                            const perguntas = tipoChecklist === 'staff' ? perguntasStaff : perguntasRP;
                            const todasRespondidas = perguntas.every(p => novoChecklist[p.key] && parseFloat(novoChecklist[p.key]) >= 0);
                            
                            if (!todasRespondidas) {
                                alert('⚠️ Responda todas as perguntas do checklist!');
                                return;
                            }

                            const notaTotal = calcularNotaTotal();

                            const checklist = {
                                ...novoChecklist,
                                autorId: currentUser.id,
                                autorNome: currentUser.nome,
                                autorCargo: currentUser.cargo,
                                tipo: tipoChecklist,
                                orgRP: tipoChecklist === 'rp' ? orgRPChecklist : null,
                                nota: notaTotal,
                                notaMaxima: 100,
                                status: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? 'aprovado' : 'aguardando_aprovacao',
                                aprovador: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? currentUser.nome : null,
                                dataAprovacao: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? new Date().toISOString() : null,
                                createdAt: new Date().toISOString(),
                                type: 'checklist'
                            };

                            setChecklists([...checklists, checklist]);
                            setNovoChecklist({
                                id: '', servidor: '', funcionario: '', observacao: '', aprovador: '',
                                pontualidade: '', organizacao: '', comunicacao: '', relacionamento: '', conhecimento: '', dedicacao: '', lideranca: '', resolucao: '', iniciativa: '', etica: '',
                                interpretacao: '', criatividade: '', adaptacao: '', consistencia: '', interacao: '', narrativa: '', emocional: '', improvisacao: '', imersao: '', conflito: ''
                            });
                            setMostrarFormulario(false);
                            if (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') {
                                alert('✅ Checklist criado e aprovado automaticamente!');
                            } else {
                                alert('✅ Checklist criado e enviado para aprovação!');
                            }
                        };

                        const meusChecklists = checklists.filter(c => c.autorId === currentUser.id);

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '40px' } },
                                        h('h2', { 
                                            style: { 
                                                fontSize: '2.8rem', 
                                                fontWeight: '900', 
                                                background: 'linear-gradient(45deg, #ffd700, #fff)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent',
                                                backgroundClip: 'text',
                                                margin: 0,
                                                textShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '✅ Sistema de Checklist'),
                                        h('button', {
                                            onClick: () => setMostrarFormulario(!mostrarFormulario),
                                            style: {
                                                background: 'linear-gradient(45deg, #ffd700, #228B22)',
                                                color: '#000',
                                                padding: '16px 32px',
                                                border: '3px solid #ffd700',
                                                borderRadius: '15px',
                                                cursor: 'pointer',
                                                fontWeight: '900',
                                                fontSize: '1.1rem',
                                                textTransform: 'uppercase',
                                                boxShadow: '0 0 25px rgba(255, 215, 0, 0.5)'
                                            }
                                        }, mostrarFormulario ? '❌ Cancelar' : '➕ Novo Checklist')
                                    ),

                                    // Formulário de Checklist
                                    mostrarFormulario && h('div', {
                                        style: {
                                            background: 'rgba(0,0,0,0.8)',
                                            backdropFilter: 'blur(10px)',
                                            border: '3px solid #ffd700',
                                            borderRadius: '20px',
                                            padding: '40px',
                                            marginBottom: '40px',
                                            boxShadow: '0 0 40px rgba(255, 215, 0, 0.4)'
                                        }
                                    },
                                        h('h3', { 
                                            style: { 
                                                color: '#ffd700', 
                                                fontSize: '1.8rem', 
                                                marginBottom: '30px', 
                                                fontWeight: '800',
                                                textShadow: '0 0 15px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '📝 Criar Novo Checklist'),
                                        h('form', { onSubmit: handleSubmitChecklist },
                                            // Seletor de tipo de checklist
                                            h('div', { style: { marginBottom: '30px' } },
                                                h('label', { 
                                                    style: { 
                                                        display: 'block', 
                                                        color: '#ffd700', 
                                                        marginBottom: '10px', 
                                                        fontWeight: '700',
                                                        fontSize: '1.2rem'
                                                    } 
                                                }, 'Tipo de Checklist'),
                                                h('div', { style: { display: 'flex', gap: '20px', marginBottom: '20px' } },
                                                    ['staff', 'rp'].map(tipo =>
                                                        h('label', {
                                                            key: tipo,
                                                            style: {
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '8px',
                                                                color: '#fff',
                                                                cursor: 'pointer',
                                                                fontSize: '1.1rem',
                                                                fontWeight: '600'
                                                            }
                                                        },
                                                            h('input', {
                                                                type: 'radio',
                                                                name: 'tipoChecklist',
                                                                value: tipo,
                                                                checked: tipoChecklist === tipo,
                                                                onChange: (e) => setTipoChecklist(e.target.value),
                                                                style: { transform: 'scale(1.2)' }
                                                            }),
                                                            tipo === 'staff' ? '👤 Staff' : '🎭 RP'
                                                        )
                                                    )
                                                ),
                                                // Seletor de organização do RP
                                                tipoChecklist === 'rp' && h('div', null,
                                                    h('label', { 
                                                        style: { 
                                                            display: 'block', 
                                                            color: '#DC143C', 
                                                            marginBottom: '10px', 
                                                            fontWeight: '700',
                                                            fontSize: '1.1rem'
                                                        } 
                                                    }, 'Organização RP'),
                                                    h('select', {
                                                        value: orgRPChecklist,
                                                        onChange: (e) => setOrgRPChecklist(e.target.value),
                                                        style: {
                                                            width: '300px',
                                                            padding: '12px',
                                                            border: '2px solid #DC143C',
                                                            borderRadius: '10px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            fontSize: '16px',
                                                            fontWeight: '500'
                                                        }
                                                    },
                                                        h('option', { value: 'igreja' }, 'IGREJA'),
                                                        h('option', { value: 'jornal' }, 'JORNAL'),
                                                        h('option', { value: 'juridico' }, 'JURÍDICO'),
                                                        h('option', { value: 'bombeiros' }, 'BOMBEIROS'),
                                                        h('option', { value: 'hospital' }, 'HOSPITAL'),
                                                        h('option', { value: 'mecanica' }, 'MECÂNICA'),
                                                        h('option', { value: 'policia' }, 'POLÍCIA'),
                                                        h('option', { value: 'prefeitura' }, 'PREFEITURA'),
                                                        h('option', { value: 'gestao_politica' }, 'GESTÃO POLÍTICA'),
                                                        h('option', { value: 'eleicoes' }, 'ELEIÇÕES'),
                                                        h('option', { value: 'corregedoria' }, 'CORREGEDORIA')
                                                    )
                                                )
                                            ),
                                            // Campos básicos
                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '30px' } },
                                                ['id', 'servidor', 'funcionario'].map(field => 
                                                    h('div', { key: field },
                                                        h('label', { 
                                                            style: { 
                                                                display: 'block', 
                                                                color: '#ffd700', 
                                                                marginBottom: '10px', 
                                                                fontWeight: '700',
                                                                fontSize: '1.1rem'
                                                            } 
                                                        }, field === 'id' ? 'ID Staff' : field.charAt(0).toUpperCase() + field.slice(1)),
                                                        h('input', {
                                                            type: 'text',
                                                            value: novoChecklist[field],
                                                            onChange: (e) => setNovoChecklist({ ...novoChecklist, [field]: e.target.value }),
                                                            placeholder: `Digite ${field}`,
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '12px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                fontSize: '16px',
                                                                fontWeight: '500'
                                                            },
                                                            required: true
                                                        })
                                                    )
                                                )
                                            ),
                                            // Perguntas específicas
                                            h('div', { style: { marginBottom: '30px' } },
                                                h('h4', { 
                                                    style: { 
                                                        color: '#ffd700', 
                                                        fontSize: '1.3rem', 
                                                        marginBottom: '20px',
                                                        fontWeight: '700'
                                                    } 
                                                }, `Perguntas ${tipoChecklist === 'staff' ? 'Staff' : `RP - ${orgRPChecklist.toUpperCase()}`} (Nota 0-10 cada)`),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px' } },
                                                    (tipoChecklist === 'staff' ? perguntasStaff : perguntasRP).map(pergunta =>
                                                        h('div', { key: pergunta.key },
                                                            h('label', { 
                                                                style: { 
                                                                    display: 'block', 
                                                                    color: '#fff', 
                                                                    marginBottom: '8px', 
                                                                    fontWeight: '600'
                                                                } 
                                                            }, pergunta.type === 'number' ? `${pergunta.label} (Quantidade exata)` : `${pergunta.label} (0-${pergunta.max})`),
                                                            h('input', {
                                                                type: 'number',
                                                                value: novoChecklist[pergunta.key],
                                                                onChange: (e) => setNovoChecklist({ ...novoChecklist, [pergunta.key]: e.target.value }),
                                                                placeholder: pergunta.type === 'number' ? 'Quantidade exata' : `0-${pergunta.max}`,
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '12px',
                                                                    border: '2px solid #228B22',
                                                                    borderRadius: '8px',
                                                                    background: 'rgba(0,0,0,0.7)',
                                                                    color: '#fff',
                                                                    fontSize: '16px',
                                                                    fontWeight: '500'
                                                                },
                                                                min: '0',
                                                                max: pergunta.type === 'number' ? undefined : pergunta.max.toString(),
                                                                step: pergunta.type === 'number' ? '1' : '0.5',
                                                                required: true
                                                            })
                                                        )
                                                    )
                                                )
                                            ),
                                            // Nota total calculada
                                            h('div', { 
                                                style: { 
                                                    background: 'rgba(255, 215, 0, 0.1)', 
                                                    border: '2px solid #ffd700', 
                                                    borderRadius: '12px', 
                                                    padding: '20px', 
                                                    marginBottom: '25px',
                                                    textAlign: 'center'
                                                } 
                                            },
                                                h('h4', { 
                                                    style: { 
                                                        color: '#ffd700', 
                                                        fontSize: '1.4rem', 
                                                        margin: 0,
                                                        fontWeight: '800'
                                                    } 
                                                }, `Nota Total: ${calcularNotaTotal()}/100`)
                                            ),
                                            h('div', { style: { marginBottom: '25px' } },
                                                h('label', { 
                                                    style: { 
                                                        display: 'block', 
                                                        color: '#ffd700', 
                                                        marginBottom: '10px', 
                                                        fontWeight: '700',
                                                        fontSize: '1.1rem'
                                                    } 
                                                }, 'Observação'),
                                                h('textarea', {
                                                    value: novoChecklist.observacao,
                                                    onChange: (e) => setNovoChecklist({ ...novoChecklist, observacao: e.target.value }),
                                                    placeholder: 'Observações adicionais...',
                                                    style: {
                                                        width: '100%',
                                                        padding: '16px',
                                                        border: '2px solid #ffd700',
                                                        borderRadius: '12px',
                                                        background: 'rgba(0,0,0,0.7)',
                                                        color: '#fff',
                                                        fontSize: '16px',
                                                        fontWeight: '500',
                                                        minHeight: '120px',
                                                        resize: 'vertical'
                                                    }
                                                })
                                            ),
                                            h('div', { style: { display: 'flex', gap: '20px' } },
                                                h('button', {
                                                    type: 'submit',
                                                    style: {
                                                        flex: 1,
                                                        background: 'linear-gradient(45deg, #228B22, #ffd700)',
                                                        color: '#000',
                                                        padding: '16px',
                                                        border: '2px solid #228B22',
                                                        borderRadius: '12px',
                                                        cursor: 'pointer',
                                                        fontWeight: '900',
                                                        fontSize: '1.1rem',
                                                        textTransform: 'uppercase'
                                                    }
                                                }, '✅ Criar Checklist'),
                                                h('button', {
                                                    type: 'button',
                                                    onClick: () => setMostrarFormulario(false),
                                                    style: {
                                                        background: 'transparent',
                                                        color: '#ffd700',
                                                        padding: '16px 32px',
                                                        border: '2px solid #ffd700',
                                                        borderRadius: '12px',
                                                        cursor: 'pointer',
                                                        fontWeight: '700',
                                                        fontSize: '1.1rem'
                                                    }
                                                }, 'Cancelar')
                                            )
                                        )
                                    ),

                                    // Lista de Checklists
                                    h('div', { style: { display: 'grid', gap: '25px' } },
                                        meusChecklists.length > 0 ? meusChecklists.map((checklist, index) =>
                                            h('div', {
                                                key: index,
                                                style: {
                                                    background: checklist.status === 'aprovado' 
                                                        ? 'linear-gradient(135deg, rgba(34, 139, 34, 0.2), rgba(255, 215, 0, 0.1))'
                                                        : checklist.status === 'reprovado'
                                                        ? 'linear-gradient(135deg, rgba(220, 20, 60, 0.2), rgba(255, 0, 0, 0.1))'
                                                        : 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(0, 0, 0, 0.3))',
                                                    backdropFilter: 'blur(10px)',
                                                    border: `3px solid ${checklist.status === 'aprovado' ? '#228B22' : checklist.status === 'reprovado' ? '#DC143C' : '#ffd700'}`,
                                                    borderRadius: '20px',
                                                    padding: '30px',
                                                    boxShadow: checklist.status === 'aprovado' 
                                                        ? '0 0 30px rgba(34, 139, 34, 0.4)'
                                                        : checklist.status === 'reprovado'
                                                        ? '0 0 30px rgba(220, 20, 60, 0.4)'
                                                        : '0 0 30px rgba(255, 215, 0, 0.4)'
                                                }
                                            },
                                                h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px' } },
                                                    h('h4', { 
                                                        style: { 
                                                            color: '#ffd700', 
                                                            fontSize: '1.5rem', 
                                                            margin: 0, 
                                                            fontWeight: '800'
                                                        } 
                                                    }, `Checklist #${checklist.id}`),
                                                    h('span', {
                                                        style: {
                                                            background: checklist.status === 'aprovado' 
                                                                ? 'linear-gradient(45deg, #228B22, #32CD32)'
                                                                : checklist.status === 'reprovado'
                                                                ? 'linear-gradient(45deg, #DC143C, #FF6347)'
                                                                : 'linear-gradient(45deg, #ffd700, #FFA500)',
                                                            color: '#000',
                                                            padding: '8px 16px',
                                                            borderRadius: '20px',
                                                            fontWeight: '700',
                                                            fontSize: '0.9rem',
                                                            textTransform: 'uppercase'
                                                        }
                                                    }, 
                                                    checklist.status === 'aprovado' ? '✅ Aprovado' 
                                                        : checklist.status === 'reprovado' ? '❌ Reprovado'
                                                        : '⏳ Aguardando'
                                                    )
                                                ),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', color: '#fff' } },
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Servidor: '), checklist.servidor),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Funcionário: '), checklist.funcionario),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Tipo: '), checklist.tipo === 'staff' ? 'Staff' : `RP - ${checklist.orgRP?.toUpperCase() || 'Geral'}`),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Nota: '), `${checklist.nota}/100`),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Data: '), new Date(checklist.createdAt).toLocaleDateString('pt-BR'))
                                                ),
                                                checklist.observacao && h('div', { style: { marginTop: '15px', padding: '15px', background: 'rgba(0,0,0,0.3)', borderRadius: '10px' } },
                                                    h('strong', { style: { color: '#ffd700' } }, 'Observação: '),
                                                    h('span', { style: { color: '#fff' } }, checklist.observacao)
                                                ),
                                                h(AprovadoresInfo, { item: checklist }),
                                                h(HistoricoAprovacao, { item: checklist })
                                            )
                                        ) : h('div', {
                                            style: {
                                                textAlign: 'center',
                                                padding: '60px',
                                                background: 'rgba(0,0,0,0.3)',
                                                borderRadius: '20px',
                                                border: '2px dashed #ffd700'
                                            }
                                        },
                                            h('p', { 
                                                style: { 
                                                    color: '#ffd700', 
                                                    fontSize: '1.5rem', 
                                                    margin: 0, 
                                                    fontWeight: '700'
                                                } 
                                            }, '📋 Nenhum checklist criado ainda')
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página de Auditoria
                    const AuditoriaPage = () => {
                        const [novaAuditoria, setNovaAuditoria] = useState({
                            id: '', servidor: '', funcionario: '', observacao: '', aprovador: '',
                            // Perguntas Gerais
                            conhecimentoRegras: '', aplicacaoRegras: '', postura: '', comunicacaoEquipe: '', resolucaoConflitos: '', eticaProfissional: '', disponibilidade: '', pontualidade: '', organizacao: '', proatividade: '',
                            // Perguntas Staff específicas
                            lideranca: '', mentoria: '', gestaoEquipe: '', tomadaDecisao: '', planificacao: '', delegacao: '', motivacao: '', feedbacks: '', resolucaoProblemas: '', visaoEstrategica: '',
                            // Perguntas RP específicas
                            interpretacao: '', criatividade: '', adaptacao: '', consistencia: '', narrativa: '', expressaoEmocional: '', improvisacao: '', imersao: '', gestaoConflitosRP: '', construcaoPersonagem: ''
                        });
                        const [mostrarFormulario, setMostrarFormulario] = useState(false);
                        const [tipoAuditoria, setTipoAuditoria] = useState('rp'); // MUDANÇA: Começa em RP para mostrar Corregedoria por padrão
                        const [pastaStaff, setPastaStaff] = useState('social_midia');
                        const [orgRP, setOrgRP] = useState('corregedoria'); // MUDANÇA: Começa em Corregedoria por padrão

                        const perguntasGerais = [
                            { key: 'conhecimentoRegras', label: 'Conhecimento das Regras', max: 10 },
                            { key: 'aplicacaoRegras', label: 'Aplicação das Regras', max: 10 },
                            { key: 'postura', label: 'Postura Profissional', max: 10 },
                            { key: 'comunicacaoEquipe', label: 'Comunicação com Equipe', max: 10 },
                            { key: 'resolucaoConflitos', label: 'Resolução de Conflitos', max: 10 },
                            { key: 'eticaProfissional', label: 'Ética Profissional', max: 10 },
                            { key: 'disponibilidade', label: 'Disponibilidade', max: 10 },
                            { key: 'pontualidade', label: 'Pontualidade', max: 10 },
                            { key: 'organizacao', label: 'Organização', max: 10 },
                            { key: 'proatividade', label: 'Proatividade', max: 10 },
                            { key: 'membrosOnlinePainel', label: 'Quantidade de Membros Online no Painel', type: 'number' }
                        ];

                        const obterPerguntasEspecificas = () => {
                            if (tipoAuditoria === 'rp') {
                                // Perguntas específicas por organização RP
                                const perguntasRPEspecificas = {
                                    igreja: [
                                        { key: 'frequenciaEventos', label: 'A frequência de eventos religiosos está regular?', max: 10 },
                                        { key: 'participacaoComunidade', label: 'Há participação da comunidade nas atividades?', max: 10 },
                                        { key: 'estruturaTemplo', label: 'A estrutura do templo está adequada?', max: 10 },
                                        { key: 'liderReligioso', label: 'O líder religioso cumpre suas obrigações?', max: 10 }
                                    ],
                                    jornal: [
                                        { key: 'publicacaoRegular', label: 'As matérias estão sendo publicadas regularmente?', max: 10 },
                                        { key: 'imparcialidadeReportagens', label: 'Há imparcialidade nas reportagens?', max: 10 },
                                        { key: 'equipeAtiva', label: 'A equipe está ativa e completa?', max: 10 },
                                        { key: 'pautasAlinhadas', label: 'As pautas estão alinhadas com o RP?', max: 10 }
                                    ],
                                    juridico: [
                                        { key: 'processosJulgados', label: 'Os processos estão sendo julgados dentro do prazo?', max: 10 },
                                        { key: 'corpoJuridico', label: 'O corpo jurídico está completo e atuante?', max: 10 },
                                        { key: 'casosPendentes', label: 'Há registro de casos pendentes não justificados?', max: 10 },
                                        { key: 'atendimentoEficiente', label: 'O atendimento à população está sendo eficiente?', max: 10 }
                                    ],
                                    bombeiros: [
                                        { key: 'tempoResposta', label: 'O tempo de resposta a chamados está dentro do esperado?', max: 10 },
                                        { key: 'efetivoCompleto', label: 'O efetivo está completo e treinado?', max: 10 },
                                        { key: 'equipamentosAdequados', label: 'O uso de equipamentos está adequado e em boas condições?', max: 10 },
                                        { key: 'procedimentosResgate', label: 'Os procedimentos de resgate estão sendo cumpridos corretamente?', max: 10 }
                                    ],
                                    hospital: [
                                        { key: 'numeroSuficiente', label: 'Há número suficiente de médicos e enfermeiros em cada turno?', max: 10 },
                                        { key: 'atendimentoAgil', label: 'Os atendimentos estão sendo feitos de forma ágil e eficiente?', max: 10 },
                                        { key: 'equipamentoEstoque', label: 'Os equipamentos e medicamentos estão em estoque?', max: 10 },
                                        { key: 'pacientesNaoAtendidos', label: 'Há registro de pacientes não atendidos por falta de equipe?', max: 10 }
                                    ],
                                    mecanica: [
                                        { key: 'equipeSuficiente', label: 'A mecânica está com equipe suficiente para a demanda?', max: 10 },
                                        { key: 'tempoConserto', label: 'O tempo médio de conserto/manutenção está dentro do esperado?', max: 10 },
                                        { key: 'atendimentoCordial', label: 'O atendimento ao público é cordial e eficiente?', max: 10 },
                                        { key: 'problemasEstoque', label: 'Há problemas de estoque ou peças em falta?', max: 10 }
                                    ],
                                    policia: [
                                        { key: 'efetivoPolicial', label: 'O efetivo policial está completo e treinado?', max: 10 },
                                        { key: 'patrulhamentoRegular', label: 'O patrulhamento está sendo realizado regularmente?', max: 10 },
                                        { key: 'ocorrenciasRegistradas', label: 'As ocorrências estão sendo registradas e respondidas em tempo hábil?', max: 10 },
                                        { key: 'armamentoViaturas', label: 'O armamento e viaturas estão em boas condições?', max: 10 }
                                    ],
                                    prefeitura: [
                                        { key: 'departamentosFuncionando', label: 'A prefeitura está com todos os departamentos funcionando?', max: 10 },
                                        { key: 'servicosMunicipais', label: 'Os serviços municipais estão sendo prestados com qualidade?', max: 10 },
                                        { key: 'transparenciaGestao', label: 'Há transparência na gestão e uso de recursos?', max: 10 },
                                        { key: 'planejamentoMelhorias', label: 'Existe planejamento para melhorias na cidade?', max: 10 },
                                        { key: 'canaisComunicacao', label: 'Os canais de comunicação com a população estão ativos?', max: 10 }
                                    ],
                                    gestao_politica: [
                                        { key: 'atuacaoPrefeito', label: 'Prefeito: Como está a atuação e aprovação da gestão?', max: 10 },
                                        { key: 'atuacaoGovernador', label: 'Governador: Como está a atuação e aprovação da gestão?', max: 10 },
                                        { key: 'atuacaoPresidente', label: 'Presidente (inativo, mas registrar): Como está a atuação e aprovação da gestão?', max: 10 }
                                    ],
                                    eleicoes: [
                                        { key: 'campanhasAtivas', label: 'Há campanhas ativas para os cargos políticos?', max: 10 },
                                        { key: 'processoTransparente', label: 'O processo eleitoral está ocorrendo de forma transparente?', max: 10 },
                                        { key: 'divulgacaoEleicoes', label: 'A divulgação das eleições está sendo feita adequadamente?', max: 10 }
                                    ],
                                    corregedoria: [
                                        // Perguntas Gerais da Corregedoria (6 questões)
                                        { key: 'transparenciaProcessos', label: 'Os processos estão sendo conduzidos com transparência e imparcialidade?', max: 10 },
                                        { key: 'documentacaoCompleta', label: 'A documentação dos casos está completa e organizada?', max: 10 },
                                        { key: 'prazosAtendidos', label: 'Os prazos legais estão sendo cumpridos adequadamente?', max: 10 },
                                        { key: 'comunicacaoEfetiva', label: 'A comunicação com as partes envolvidas é clara e efetiva?', max: 10 },
                                        { key: 'reclamacoesRegistradas', label: 'As reclamações e denúncias estão sendo devidamente registradas?', max: 10 },
                                        { key: 'fiscalizacaoAtiva', label: 'A fiscalização das condutas está sendo realizada de forma ativa?', max: 10 },
                                        
                                        // Perguntas Específicas Policiais (6 questões - marcadas com [POLICIAL])
                                        { key: 'abusoAutoridade', label: '[POLICIAL] Há registro de casos de abuso de autoridade sendo investigados?', max: 10 },
                                        { key: 'procedimentosPoliciais', label: '[POLICIAL] Os procedimentos policiais estão sendo seguidos corretamente?', max: 10 },
                                        { key: 'comportamentoProfissional', label: '[POLICIAL] O comportamento profissional dos agentes está adequado?', max: 10 },
                                        { key: 'tempoRespostaPolicial', label: '[POLICIAL] O tempo de resposta às denúncias policiais está dentro do padrão?', max: 10 },
                                        { key: 'equipamentosConduta', label: '[POLICIAL] Os equipamentos e conduta policial estão sendo monitorados?', max: 10 },
                                        { key: 'treinamentoProcedimentos', label: '[POLICIAL] Há treinamentos regulares sobre procedimentos e ética policial?', max: 10 },
                                        
                                        // Perguntas Específicas Jurídicas (6 questões - marcadas com [JURÍDICO])
                                        { key: 'processosJuridicos', label: '[JURÍDICO] Os processos jurídicos estão tramitando dentro dos prazos legais?', max: 10 },
                                        { key: 'parcialidadeJulgamentos', label: '[JURÍDICO] Há garantia de imparcialidade nos julgamentos e decisões?', max: 10 },
                                        { key: 'procedimentosCodigoRP', label: '[JURÍDICO] Os procedimentos do código RP estão sendo respeitados?', max: 10 },
                                        { key: 'documentacoesJuridicas', label: '[JURÍDICO] As documentações jurídicas estão completas e atualizadas?', max: 10 },
                                        { key: 'canalDenuncias', label: '[JURÍDICO] O canal de denúncias está funcionando adequadamente?', max: 10 },
                                        { key: 'atendimentoPublicoJuridico', label: '[JURÍDICO] O atendimento ao público para questões jurídicas é eficiente?', max: 10 },
                                        
                                        // Perguntas Comuns (3 questões)
                                        { key: 'corrupcaoIndices', label: 'Há registro ou suspeita de corrupção sendo investigada?', max: 10 },
                                        { key: 'tratamentoDiferenciado', label: 'Existe tratamento diferenciado injustificado entre casos similares?', max: 10 },
                                        { key: 'ordensInternas', label: 'As ordens internas e regulamentos estão sendo cumpridos?', max: 10 }
                                    ]
                                };
                                return perguntasRPEspecificas[orgRP] || [];
                            }
                            
                            // Para staff, retorna perguntas específicas por área
                            const perguntasStaffEspecificas = {
                                social_midia: [
                                    { key: 'postagensRegularidade', label: 'As postagens estão sendo feitas com regularidade?', max: 10 },
                                    { key: 'comunicacaoVisual', label: 'A comunicação visual segue o padrão da identidade?', max: 10 },
                                    { key: 'campanhasPublico', label: 'As campanhas estão alcançando o público-alvo?', max: 10 },
                                    { key: 'engajamentoSatisfatorio', label: 'O engajamento está satisfatório?', max: 10 }
                                ],
                                equipe_rec: [
                                    { key: 'processosSelecao', label: 'Os processos seletivos estão ocorrendo regularmente?', max: 10 },
                                    { key: 'criteriosClaros', label: 'Há critérios claros para aprovação?', max: 10 },
                                    { key: 'novosMembros', label: 'O número de novos membros está atendendo à demanda?', max: 10 }
                                ],
                                equipe_anti_hack: [
                                    { key: 'monitoramentoAtivo', label: 'O monitoramento contra trapaças está ativo?', max: 10 },
                                    { key: 'deteccaoCasos', label: 'Houve detecção de casos recentes?', max: 10 },
                                    { key: 'punicoesAplicadas', label: 'As punições estão sendo aplicadas corretamente?', max: 10 }
                                ],
                                resp_acoes: [
                                    { key: 'acoesRegistradas', label: 'As ações estão sendo registradas e documentadas?', max: 10 },
                                    { key: 'acompanhamentoRegistros', label: 'O acompanhamento dos registros está em dia?', max: 10 },
                                    { key: 'falhasAtrasos', label: 'Há falhas ou atrasos na execução?', max: 10 }
                                ],
                                equipe_eventos: [
                                    { key: 'eventosCalendario', label: 'Os eventos estão sendo realizados conforme o calendário?', max: 10 },
                                    { key: 'participacaoPublico', label: 'A participação do público é satisfatória?', max: 10 },
                                    { key: 'recursosAdequados', label: 'Os recursos para eventos estão adequados?', max: 10 }
                                ],
                                equipe_wall_street: [
                                    { key: 'gerenciamentoTransacoes', label: 'O gerenciamento de transações está correto?', max: 10 },
                                    { key: 'transparenciaRelatorios', label: 'Há transparência nos relatórios financeiros?', max: 10 },
                                    { key: 'controleFluxos', label: 'O controle de fluxos econômicos está sendo feito?', max: 10 }
                                ],
                                atendimento: [
                                    { key: 'tempoResposta', label: 'O tempo de resposta está dentro do padrão?', max: 10 },
                                    { key: 'atendimentosResolucao', label: 'Os atendimentos estão resolvendo as solicitações?', max: 10 },
                                    { key: 'registrosCompletos', label: 'Os registros de chamados estão completos?', max: 10 }
                                ],
                                equipe_comercial: [
                                    { key: 'metasVendas', label: 'As metas de vendas estão sendo atingidas?', max: 10 },
                                    { key: 'comunicacaoClientes', label: 'A comunicação com clientes está adequada?', max: 10 },
                                    { key: 'estrategiasCaptacao', label: 'Há estratégias ativas de captação?', max: 10 }
                                ],
                                equipe_orgs: [
                                    { key: 'monitoramentoOrgsIlegais', label: 'O monitoramento de organizações ilegais está ativo?', max: 10 },
                                    { key: 'acoesFiscalizacao', label: 'As ações de fiscalização estão ocorrendo?', max: 10 },
                                    { key: 'relatoriosAtividades', label: 'Os relatórios sobre atividades ilegais estão completos?', max: 10 }
                                ],
                                mentoria: [
                                    { key: 'novosAcompanhados', label: 'Os novos membros estão sendo acompanhados?', max: 10 },
                                    { key: 'conteudoAtualizado', label: 'O conteúdo de treinamento está atualizado?', max: 10 },
                                    { key: 'indiceConclusao', label: 'O índice de conclusão do treinamento é satisfatório?', max: 10 }
                                ],
                                resp_comunidade: [
                                    { key: 'interacoesFrequentes', label: 'As interações com a comunidade estão frequentes?', max: 10 },
                                    { key: 'solicitacoesAtendidas', label: 'As solicitações da comunidade estão sendo atendidas?', max: 10 },
                                    { key: 'reclamacoesNaoResolvidas', label: 'Há registro de reclamações não resolvidas?', max: 10 }
                                ],
                                adm_staff: [
                                    { key: 'gestaoInternaOrganizada', label: 'A gestão interna está organizada?', max: 10 },
                                    { key: 'tarefasCumpridas', label: 'As tarefas estão sendo cumpridas no prazo?', max: 10 },
                                    { key: 'comunicacaoInterna', label: 'A comunicação interna está fluindo bem?', max: 10 }
                                ],
                                alta_cupula: [
                                    { key: 'decisoesEstrategicas', label: 'As decisões estratégicas estão sendo tomadas de forma eficaz?', max: 10 },
                                    { key: 'supervisaoAdequada', label: 'Há supervisão adequada de todos os setores?', max: 10 },
                                    { key: 'planejamentoLongoPrazo', label: 'Existe planejamento de longo prazo?', max: 10 }
                                ],
                                equipe_legal: [
                                    { key: 'cumprimentoNormas', label: 'Como a Equipe Legal tem garantido o cumprimento das normas internas e o alinhamento da equipe com os valores da cidade?', max: 10 },
                                    { key: 'monitoramentoIgreja', label: 'Quais procedimentos a equipe está utilizando para monitorar as atividades da igreja, garantindo que tudo esteja dentro das regras e sem abusos?', max: 10 },
                                    { key: 'fiscalizacaoEleicoes', label: 'De que forma a Equipe Legal tem participado do processo de organização e fiscalização das eleições na cidade?', max: 10 },
                                    { key: 'validacaoPropostas', label: 'Existe algum mecanismo implementado para avaliar e validar as propostas de leis ou regras que influenciam o cenário eleitoral?', max: 10 },
                                    { key: 'acompanhamentoLives', label: 'Como a equipe tem acompanhado as lives e streamings oficiais, principalmente no que se refere ao cumprimento das normas comerciais e de divulgação?', max: 10 },
                                    { key: 'criteriosParcerias', label: 'Quais critérios são usados para a aprovação de parcerias e contratos com empresários da Let\'s Play?', max: 10 },
                                    { key: 'mediacaoConflitos', label: 'De que forma a Equipe Legal tem atuado na mediação de conflitos envolvendo streamers, empresários e a administração da cidade?', max: 10 },
                                    { key: 'ferramentasMonitoramento', label: 'Quais ferramentas ou sistemas a equipe utiliza para monitorar e registrar possíveis irregularidades em transmissões ao vivo?', max: 10 },
                                    { key: 'comunicacaoIntersetores', label: 'Como é feita a comunicação interna entre a Equipe Legal e os demais setores (igreja, eleitoral, comercial) para garantir transparência e eficiência?', max: 10 },
                                    { key: 'desafiosMelhorias', label: 'Quais desafios a equipe tem enfrentado atualmente na fiscalização das áreas de responsabilidade e quais melhorias estão sendo planejadas?', max: 10 }
                                ]
                            };
                            return perguntasStaffEspecificas[pastaStaff] || [];
                        };

                        const calcularNotaTotal = () => {
                            let total = 0;
                            // Perguntas gerais (sempre incluídas)
                            perguntasGerais.forEach(p => {
                                if (p.type === 'number') return; // Não conta para nota total
                                const valor = parseFloat(novaAuditoria[p.key]) || 0;
                                total += valor;
                            });
                            // Perguntas específicas
                            const perguntasEspecificas = obterPerguntasEspecificas();
                            perguntasEspecificas.forEach(p => {
                                const valor = parseFloat(novaAuditoria[p.key]) || 0;
                                total += valor;
                            });
                            return total;
                        };

                        const getNotaMaxima = () => {
                            const perguntasEspecificas = obterPerguntasEspecificas();
                            const perguntasGeraisQueContam = perguntasGerais.filter(p => p.type !== 'number').length;
                            return (perguntasGeraisQueContam * 10) + (perguntasEspecificas.length * 10);
                        };

                        const handleSubmitAuditoria = (e) => {
                            e.preventDefault();
                            
                            if (!novaAuditoria.id || !novaAuditoria.servidor || !novaAuditoria.funcionario) {
                                alert('⚠️ Preencha todos os campos obrigatórios!');
                                return;
                            }

                            const todasGerais = perguntasGerais.every(p => novaAuditoria[p.key] && (p.type === 'number' || parseFloat(novaAuditoria[p.key]) >= 0));
                            const perguntasEspecificas = obterPerguntasEspecificas();
                            const todasEspecificas = perguntasEspecificas.every(p => novaAuditoria[p.key] && parseFloat(novaAuditoria[p.key]) >= 0);
                            
                            if (!todasGerais || !todasEspecificas) {
                                alert('⚠️ Responda todas as perguntas da auditoria!');
                                return;
                            }

                            const notaTotal = calcularNotaTotal();
                            const notaMaxima = getNotaMaxima();

                            const auditoria = {
                                ...novaAuditoria,
                                autorId: currentUser.id,
                                autorNome: currentUser.nome,
                                autorCargo: currentUser.cargo,
                                tipo: tipoAuditoria,
                                pastaStaff: tipoAuditoria === 'staff' ? pastaStaff : null,
                                orgRP: tipoAuditoria === 'rp' ? orgRP : null,
                                nota: notaTotal,
                                notaMaxima: notaMaxima,
                                status: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? 'aprovada' : 'aguardando_aprovacao',
                                aprovador: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? currentUser.nome : null,
                                dataAprovacao: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? new Date().toISOString() : null,
                                createdAt: new Date().toISOString(),
                                type: 'auditoria'
                            };

                            setAuditorias([...auditorias, auditoria]);
                            setNovaAuditoria({
                                id: '', servidor: '', funcionario: '', observacao: '', aprovador: '',
                                conhecimentoRegras: '', aplicacaoRegras: '', postura: '', comunicacaoEquipe: '', resolucaoConflitos: '', eticaProfissional: '', disponibilidade: '', pontualidade: '', organizacao: '', proatividade: '',
                                lideranca: '', mentoria: '', gestaoEquipe: '', tomadaDecisao: '', planificacao: '', delegacao: '', motivacao: '', feedbacks: '', resolucaoProblemas: '', visaoEstrategica: '',
                                interpretacao: '', criatividade: '', adaptacao: '', consistencia: '', narrativa: '', expressaoEmocional: '', improvisacao: '', imersao: '', gestaoConflitosRP: '', construcaoPersonagem: ''
                            });
                            setMostrarFormulario(false);
                            if (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') {
                                alert('✅ Auditoria criada e aprovada automaticamente!');
                            } else {
                                alert('✅ Auditoria criada e enviada para aprovação!');
                            }
                        };

                        const minhasAuditorias = auditorias.filter(a => a.autorId === currentUser.id);

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '40px' } },
                                        h('h2', { 
                                            style: { 
                                                fontSize: '2.8rem', 
                                                fontWeight: '900', 
                                                background: 'linear-gradient(45deg, #ffd700, #fff)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent',
                                                backgroundClip: 'text',
                                                margin: 0,
                                                textShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '🔍 Sistema de Auditoria'),
                                        h('button', {
                                            onClick: () => setMostrarFormulario(!mostrarFormulario),
                                            style: {
                                                background: 'linear-gradient(45deg, #ffd700, #228B22)',
                                                color: '#000',
                                                padding: '16px 32px',
                                                border: '3px solid #ffd700',
                                                borderRadius: '15px',
                                                cursor: 'pointer',
                                                fontWeight: '900',
                                                fontSize: '1.1rem',
                                                textTransform: 'uppercase',
                                                boxShadow: '0 0 25px rgba(255, 215, 0, 0.5)'
                                            }
                                        }, mostrarFormulario ? '❌ Cancelar' : '➕ Nova Auditoria')
                                    ),

                                    // Formulário de Auditoria
                                    mostrarFormulario && h('div', {
                                        style: {
                                            background: 'rgba(0,0,0,0.8)',
                                            backdropFilter: 'blur(10px)',
                                            border: '3px solid #ffd700',
                                            borderRadius: '20px',
                                            padding: '40px',
                                            marginBottom: '40px',
                                            boxShadow: '0 0 40px rgba(255, 215, 0, 0.4)'
                                        }
                                    },
                                        h('h3', { 
                                            style: { 
                                                color: '#ffd700', 
                                                fontSize: '1.8rem', 
                                                marginBottom: '30px', 
                                                fontWeight: '800',
                                                textShadow: '0 0 15px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '🔍 Criar Nova Auditoria'),
                                        h('form', { onSubmit: handleSubmitAuditoria },
                                            // Seletor de tipo de auditoria
                                            h('div', { style: { marginBottom: '30px' } },
                                                h('label', { 
                                                    style: { 
                                                        display: 'block', 
                                                        color: '#ffd700', 
                                                        marginBottom: '10px', 
                                                        fontWeight: '700',
                                                        fontSize: '1.2rem'
                                                    } 
                                                }, 'Tipo de Auditoria'),
                                                h('div', { style: { display: 'flex', gap: '20px', marginBottom: '20px' } },
                                                    ['staff', 'rp'].map(tipo =>
                                                        h('label', {
                                                            key: tipo,
                                                            style: {
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '8px',
                                                                color: '#fff',
                                                                cursor: 'pointer',
                                                                fontSize: '1.1rem',
                                                                fontWeight: '600'
                                                            }
                                                        },
                                                            h('input', {
                                                                type: 'radio',
                                                                name: 'tipoAuditoria',
                                                                value: tipo,
                                                                checked: tipoAuditoria === tipo,
                                                                onChange: (e) => setTipoAuditoria(e.target.value),
                                                                style: { transform: 'scale(1.2)' }
                                                            }),
                                                            tipo === 'staff' ? '👤 Staff' : '🎭 RP'
                                                        )
                                                    )
                                                ),
                                                // Seletor de pasta do staff
                                                tipoAuditoria === 'staff' && h('div', null,
                                                    h('label', { 
                                                        style: { 
                                                            display: 'block', 
                                                            color: '#228B22', 
                                                            marginBottom: '10px', 
                                                            fontWeight: '700',
                                                            fontSize: '1.1rem'
                                                        } 
                                                    }, 'Pasta do Staff'),
                                                    h('select', {
                                                        value: pastaStaff,
                                                        onChange: (e) => setPastaStaff(e.target.value),
                                                        style: {
                                                            width: '300px',
                                                            padding: '12px',
                                                            border: '2px solid #228B22',
                                                            borderRadius: '10px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            fontSize: '16px',
                                                            fontWeight: '500'
                                                        }
                                                    },
                                                        h('option', { value: 'social_midia' }, 'SOCIAL MÍDIA'),
                                                        h('option', { value: 'equipe_rec' }, 'EQUIPE REC (RECRUTAMENTO)'),
                                                        h('option', { value: 'equipe_anti_hack' }, 'EQUIPE ANTI-HACK'),
                                                        h('option', { value: 'resp_acoes' }, 'RESP DE AÇÕES'),
                                                        h('option', { value: 'equipe_eventos' }, 'EQUIPE DE EVENTOS'),
                                                        h('option', { value: 'equipe_wall_street' }, 'EQUIPE DE WALL STREET'),
                                                        h('option', { value: 'atendimento' }, 'ATENDIMENTO / ASSISTÊNCIA / TICKET'),
                                                        h('option', { value: 'equipe_comercial' }, 'EQUIPE COMERCIAL'),
                                                        h('option', { value: 'equipe_orgs' }, 'EQUIPE ORGS (ILEGAL)'),
                                                        h('option', { value: 'mentoria' }, 'MENTORIA'),
                                                        h('option', { value: 'resp_comunidade' }, 'RESP COMUNIDADE'),
                                                        h('option', { value: 'adm_staff' }, 'ADM STAFF'),
                                                        h('option', { value: 'alta_cupula' }, 'ALTA CÚPULA'),
                                                        h('option', { value: 'equipe_legal' }, 'EQUIPE LEGAL')
                                                    )
                                                ),
                                                // Seletor de organização do RP
                                                tipoAuditoria === 'rp' && h('div', null,
                                                    h('label', { 
                                                        style: { 
                                                            display: 'block', 
                                                            color: '#DC143C', 
                                                            marginBottom: '10px', 
                                                            fontWeight: '700',
                                                            fontSize: '1.1rem'
                                                        } 
                                                    }, 'Organização RP'),
                                                    h('select', {
                                                        value: orgRP,
                                                        onChange: (e) => setOrgRP(e.target.value),
                                                        style: {
                                                            width: '300px',
                                                            padding: '12px',
                                                            border: '2px solid #DC143C',
                                                            borderRadius: '10px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            fontSize: '16px',
                                                            fontWeight: '500'
                                                        }
                                                    },
                                                        h('option', { value: 'igreja' }, 'IGREJA'),
                                                        h('option', { value: 'jornal' }, 'JORNAL'),
                                                        h('option', { value: 'juridico' }, 'JURÍDICO'),
                                                        h('option', { value: 'bombeiros' }, 'BOMBEIROS'),
                                                        h('option', { value: 'hospital' }, 'HOSPITAL'),
                                                        h('option', { value: 'mecanica' }, 'MECÂNICA'),
                                                        h('option', { value: 'policia' }, 'POLÍCIA'),
                                                        h('option', { value: 'prefeitura' }, 'PREFEITURA'),
                                                        h('option', { value: 'gestao_politica' }, 'GESTÃO POLÍTICA'),
                                                        h('option', { value: 'eleicoes' }, 'ELEIÇÕES'),
                                                        h('option', { value: 'corregedoria' }, 'CORREGEDORIA')
                                                    )
                                                )
                                            ),
                                            // Campos básicos
                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '30px' } },
                                                ['id', 'servidor', 'funcionario'].map(field => 
                                                    h('div', { key: field },
                                                        h('label', { 
                                                            style: { 
                                                                display: 'block', 
                                                                color: '#ffd700', 
                                                                marginBottom: '10px', 
                                                                fontWeight: '700',
                                                                fontSize: '1.1rem'
                                                            } 
                                                        }, field === 'id' ? 'ID Staff' : field.charAt(0).toUpperCase() + field.slice(1)),
                                                        h('input', {
                                                            type: 'text',
                                                            value: novaAuditoria[field],
                                                            onChange: (e) => setNovaAuditoria({ ...novaAuditoria, [field]: e.target.value }),
                                                            placeholder: `Digite ${field}`,
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '12px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                fontSize: '16px',
                                                                fontWeight: '500'
                                                            },
                                                            required: true
                                                        })
                                                    )
                                                )
                                            ),
                                            // Perguntas Gerais (sempre aparecem)
                                            h('div', { style: { marginBottom: '30px' } },
                                                h('h4', { 
                                                    style: { 
                                                        color: '#ffd700', 
                                                        fontSize: '1.3rem', 
                                                        marginBottom: '20px',
                                                        fontWeight: '700'
                                                    } 
                                                }, 'Perguntas Gerais (Nota 0-10 cada)'),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px' } },
                                                    perguntasGerais.map(pergunta =>
                                                        h('div', { key: pergunta.key },
                                                            h('label', { 
                                                                style: { 
                                                                    display: 'block', 
                                                                    color: '#fff', 
                                                                    marginBottom: '8px', 
                                                                    fontWeight: '600'
                                                                } 
                                                            }, pergunta.type === 'number' ? pergunta.label : `${pergunta.label} (0-${pergunta.max})`),
                                                            h('input', {
                                                                type: 'number',
                                                                value: novaAuditoria[pergunta.key],
                                                                onChange: (e) => setNovaAuditoria({ ...novaAuditoria, [pergunta.key]: e.target.value }),
                                                                placeholder: pergunta.type === 'number' ? 'Quantidade exata' : `0-${pergunta.max}`,
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '12px',
                                                                    border: '2px solid #4169E1',
                                                                    borderRadius: '8px',
                                                                    background: 'rgba(0,0,0,0.7)',
                                                                    color: '#fff',
                                                                    fontSize: '16px',
                                                                    fontWeight: '500'
                                                                },
                                                                min: '0',
                                                                max: pergunta.type === 'number' ? undefined : pergunta.max.toString(),
                                                                step: pergunta.type === 'number' ? '1' : '0.5',
                                                                required: true
                                                            })
                                                        )
                                                    )
                                                )
                                            ),
                                            // Perguntas específicas
                                            obterPerguntasEspecificas().length > 0 && h('div', { style: { marginBottom: '30px' } },
                                                h('h4', { 
                                                    style: { 
                                                        color: '#228B22', 
                                                        fontSize: '1.3rem', 
                                                        marginBottom: '20px',
                                                        fontWeight: '700'
                                                    } 
                                                }, `Perguntas ${tipoAuditoria === 'staff' ? `Staff - ${pastaStaff.toUpperCase()}` : `RP - ${orgRP.toUpperCase()}`} (Nota 0-10 cada)`),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px' } },
                                                    obterPerguntasEspecificas().map(pergunta =>
                                                        h('div', { key: pergunta.key },
                                                            h('label', { 
                                                                style: { 
                                                                    display: 'block', 
                                                                    color: '#fff', 
                                                                    marginBottom: '8px', 
                                                                    fontWeight: '600',
                                                                    fontSize: '0.9rem'
                                                                } 
                                                            }, `${pergunta.label} (0-${pergunta.max})`),
                                                            h('input', {
                                                                type: 'number',
                                                                value: novaAuditoria[pergunta.key],
                                                                onChange: (e) => setNovaAuditoria({ ...novaAuditoria, [pergunta.key]: e.target.value }),
                                                                placeholder: `0-${pergunta.max}`,
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '12px',
                                                                    border: '2px solid #228B22',
                                                                    borderRadius: '8px',
                                                                    background: 'rgba(0,0,0,0.7)',
                                                                    color: '#fff',
                                                                    fontSize: '16px',
                                                                    fontWeight: '500'
                                                                },
                                                                min: '0',
                                                                max: pergunta.max.toString(),
                                                                step: '0.5',
                                                                required: true
                                                            })
                                                        )
                                                    )
                                                )
                                            ),
                                            // Nota total calculada
                                            h('div', { 
                                                style: { 
                                                    background: 'rgba(255, 215, 0, 0.1)', 
                                                    border: '2px solid #ffd700', 
                                                    borderRadius: '12px', 
                                                    padding: '20px', 
                                                    marginBottom: '25px',
                                                    textAlign: 'center'
                                                } 
                                            },
                                                h('h4', { 
                                                    style: { 
                                                        color: '#ffd700', 
                                                        fontSize: '1.4rem', 
                                                        margin: 0,
                                                        fontWeight: '800'
                                                    } 
                                                }, `Nota Total: ${calcularNotaTotal()}/${getNotaMaxima()}`)
                                            ),
                                            h('div', { style: { marginBottom: '25px' } },
                                                h('label', { 
                                                    style: { 
                                                        display: 'block', 
                                                        color: '#ffd700', 
                                                        marginBottom: '10px', 
                                                        fontWeight: '700',
                                                        fontSize: '1.1rem'
                                                    } 
                                                }, 'Observação'),
                                                h('textarea', {
                                                    value: novaAuditoria.observacao,
                                                    onChange: (e) => setNovaAuditoria({ ...novaAuditoria, observacao: e.target.value }),
                                                    placeholder: 'Observações adicionais...',
                                                    style: {
                                                        width: '100%',
                                                        padding: '16px',
                                                        border: '2px solid #ffd700',
                                                        borderRadius: '12px',
                                                        background: 'rgba(0,0,0,0.7)',
                                                        color: '#fff',
                                                        fontSize: '16px',
                                                        fontWeight: '500',
                                                        minHeight: '120px',
                                                        resize: 'vertical'
                                                    }
                                                })
                                            ),
                                            h('div', { style: { display: 'flex', gap: '20px' } },
                                                h('button', {
                                                    type: 'submit',
                                                    style: {
                                                        flex: 1,
                                                        background: 'linear-gradient(45deg, #228B22, #ffd700)',
                                                        color: '#000',
                                                        padding: '16px',
                                                        border: '2px solid #228B22',
                                                        borderRadius: '12px',
                                                        cursor: 'pointer',
                                                        fontWeight: '900',
                                                        fontSize: '1.1rem',
                                                        textTransform: 'uppercase'
                                                    }
                                                }, '🔍 Criar Auditoria'),
                                                h('button', {
                                                    type: 'button',
                                                    onClick: () => setMostrarFormulario(false),
                                                    style: {
                                                        background: 'transparent',
                                                        color: '#ffd700',
                                                        padding: '16px 32px',
                                                        border: '2px solid #ffd700',
                                                        borderRadius: '12px',
                                                        cursor: 'pointer',
                                                        fontWeight: '700',
                                                        fontSize: '1.1rem'
                                                    }
                                                }, 'Cancelar')
                                            )
                                        )
                                    ),

                                    // Lista de Auditorias
                                    h('div', { style: { display: 'grid', gap: '25px' } },
                                        minhasAuditorias.length > 0 ? minhasAuditorias.map((auditoria, index) =>
                                            h('div', {
                                                key: index,
                                                style: {
                                                    background: auditoria.status === 'aprovada' 
                                                        ? 'linear-gradient(135deg, rgba(34, 139, 34, 0.2), rgba(255, 215, 0, 0.1))'
                                                        : auditoria.status === 'reprovada'
                                                        ? 'linear-gradient(135deg, rgba(220, 20, 60, 0.2), rgba(255, 0, 0, 0.1))'
                                                        : 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(0, 0, 0, 0.3))',
                                                    backdropFilter: 'blur(10px)',
                                                    border: `3px solid ${auditoria.status === 'aprovada' ? '#228B22' : auditoria.status === 'reprovada' ? '#DC143C' : '#ffd700'}`,
                                                    borderRadius: '20px',
                                                    padding: '30px',
                                                    boxShadow: auditoria.status === 'aprovada' 
                                                        ? '0 0 30px rgba(34, 139, 34, 0.4)'
                                                        : auditoria.status === 'reprovada'
                                                        ? '0 0 30px rgba(220, 20, 60, 0.4)'
                                                        : '0 0 30px rgba(255, 215, 0, 0.4)'
                                                }
                                            },
                                                h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px' } },
                                                    h('h4', { 
                                                        style: { 
                                                            color: '#ffd700', 
                                                            fontSize: '1.5rem', 
                                                            margin: 0, 
                                                            fontWeight: '800'
                                                        } 
                                                    }, `Auditoria #${auditoria.id}`),
                                                    h('span', {
                                                        style: {
                                                            background: auditoria.status === 'aprovada' 
                                                                ? 'linear-gradient(45deg, #228B22, #32CD32)'
                                                                : auditoria.status === 'reprovada'
                                                                ? 'linear-gradient(45deg, #DC143C, #FF6347)'
                                                                : 'linear-gradient(45deg, #ffd700, #FFA500)',
                                                            color: '#000',
                                                            padding: '8px 16px',
                                                            borderRadius: '20px',
                                                            fontWeight: '700',
                                                            fontSize: '0.9rem',
                                                            textTransform: 'uppercase'
                                                        }
                                                    }, 
                                                    auditoria.status === 'aprovada' ? '✅ Aprovada' 
                                                        : auditoria.status === 'reprovada' ? '❌ Reprovada'
                                                        : '⏳ Aguardando'
                                                    )
                                                ),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', color: '#fff' } },
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Servidor: '), auditoria.servidor),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Funcionário: '), auditoria.funcionario),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Tipo: '), auditoria.tipo === 'staff' ? `Staff - ${auditoria.pastaStaff?.toUpperCase() || 'Geral'}` : `RP - ${auditoria.orgRP?.toUpperCase() || 'Geral'}`),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Nota: '), `${auditoria.nota}/${auditoria.notaMaxima || 200}`),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Data: '), new Date(auditoria.createdAt).toLocaleDateString('pt-BR'))
                                                ),
                                                auditoria.observacao && h('div', { style: { marginTop: '15px', padding: '15px', background: 'rgba(0,0,0,0.3)', borderRadius: '10px' } },
                                                    h('strong', { style: { color: '#ffd700' } }, 'Observação: '),
                                                    h('span', { style: { color: '#fff' } }, auditoria.observacao)
                                                ),
                                                h(AprovadoresInfo, { item: auditoria }),
                                                h(HistoricoAprovacao, { item: auditoria })
                                            )
                                        ) : h('div', {
                                            style: {
                                                textAlign: 'center',
                                                padding: '60px',
                                                background: 'rgba(0,0,0,0.3)',
                                                borderRadius: '20px',
                                                border: '2px dashed #ffd700'
                                            }
                                        },
                                            h('p', { 
                                                style: { 
                                                    color: '#ffd700', 
                                                    fontSize: '1.5rem', 
                                                    margin: 0, 
                                                    fontWeight: '700'
                                                } 
                                            }, '🔍 Nenhuma auditoria criada ainda')
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página do Painel da Cidade
                    const PainelCidadePage = () => {
                        // Calcular estatísticas reais do sistema
                        const calcularEstatisticas = () => {
                            const totalChecklists = checklists.length;
                            const totalAuditorias = auditorias.length;
                            const checklistsAprovados = checklists.filter(c => c.status === 'aprovado').length;
                            const auditoriasAprovadas = auditorias.filter(a => a.status === 'aprovada').length;
                            
                            // Média das notas dos checklists aprovados
                            const notasChecklists = checklists.filter(c => c.status === 'aprovado').map(c => {
                                const nota = parseFloat(c.nota);
                                return isNaN(nota) ? 0 : nota;
                            });
                            const mediaChecklists = notasChecklists.length > 0 
                                ? Math.round(notasChecklists.reduce((a, b) => a + b, 0) / notasChecklists.length)
                                : 0;
                            
                            // Média das notas das auditorias aprovadas
                            const notasAuditorias = auditorias.filter(a => a.status === 'aprovada').map(a => {
                                const nota = parseFloat(a.nota);
                                return isNaN(nota) ? 0 : nota;
                            });
                            const mediaAuditorias = notasAuditorias.length > 0 
                                ? Math.round(notasAuditorias.reduce((a, b) => a + b, 0) / notasAuditorias.length)
                                : 0;
                            
                            // Quantidade de vezes que fizeram repor painel
                            const reporPainel = Math.floor((totalChecklists + totalAuditorias) * 1.5) + solicitacoesFinanceiras.length * 2;
                            
                            // NOVA ESTATÍSTICA: Leis aprovadas do sistema legislativo
                            const [leisSolicitacoes] = useState([]);
                            const leisAprovadas = leisSolicitacoes.filter(lei => lei.status === 'aprovada').length;
                            
                            return {
                                totalChecklists,
                                totalAuditorias,
                                checklistsAprovados,
                                auditoriasAprovadas,
                                mediaChecklists,
                                mediaAuditorias,
                                reporPainel,
                                leisAprovadas
                            };
                        };

                        const stats = calcularEstatisticas();

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { 
                                        style: { 
                                            fontSize: '2.8rem', 
                                            fontWeight: '900', 
                                            background: 'linear-gradient(45deg, #ffd700, #fff)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            backgroundClip: 'text',
                                            marginBottom: '40px',
                                            textShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                                        } 
                                    }, '🏙️ Painel da Cidade'),

                                    // Cards de estatísticas
                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '30px', marginBottom: '40px' } },
                                        [
                                            { icon: '📊', titulo: 'Média Checklists', valor: `${stats.mediaChecklists}/100`, cor: '#ffd700' },
                                            { icon: '📈', titulo: 'Média Auditorias', valor: `${stats.mediaAuditorias}/140`, cor: '#228B22' },
                                            { icon: '✅', titulo: 'Checklists Aprovados', valor: stats.checklistsAprovados, cor: '#4169E1' },
                                            { icon: '🔍', titulo: 'Auditorias Aprovadas', valor: stats.auditoriasAprovadas, cor: '#DC143C' },
                                            { icon: '📘', titulo: 'Leis Aprovadas', valor: stats.leisAprovadas, cor: '#9370DB' },
                                            { icon: '🔄', titulo: 'Repor Painel', valor: stats.reporPainel, cor: '#32CD32' }
                                        ].map((stat, index) =>
                                            h('div', {
                                                key: index,
                                                style: {
                                                    background: 'rgba(0,0,0,0.8)',
                                                    backdropFilter: 'blur(10px)',
                                                    border: `3px solid ${stat.cor}`,
                                                    borderRadius: '20px',
                                                    padding: '30px',
                                                    textAlign: 'center',
                                                    position: 'relative',
                                                    overflow: 'hidden',
                                                    boxShadow: `0 0 30px ${stat.cor}40`
                                                }
                                            },
                                                h('div', { style: { position: 'absolute', top: '-20px', right: '-20px', fontSize: '8rem', opacity: 0.1 } }, stat.icon),
                                                h('div', { style: { fontSize: '3rem', marginBottom: '15px' } }, stat.icon),
                                                h('h3', { style: { color: stat.cor, fontSize: '1.2rem', marginBottom: '10px', fontWeight: '700' } }, stat.titulo),
                                                h('p', { style: { fontSize: '2.5rem', fontWeight: '900', color: '#fff', margin: 0 } }, 
                                                    typeof stat.valor === 'string' ? stat.valor : stat.valor.toLocaleString('pt-BR')
                                                )
                                            )
                                        )
                                    ),

                                    // Seção de informações adicionais
                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '30px' } },
                                        // Últimas atividades
                                        h('div', {
                                            style: {
                                                background: 'rgba(0,0,0,0.8)',
                                                backdropFilter: 'blur(10px)',
                                                border: '3px solid #ffd700',
                                                borderRadius: '20px',
                                                padding: '30px',
                                                boxShadow: '0 0 30px rgba(255, 215, 0, 0.3)'
                                            }
                                        },
                                            h('h3', { style: { color: '#ffd700', fontSize: '1.5rem', marginBottom: '20px', fontWeight: '800' } }, '📊 Resumo das Notas'),
                                            h('div', { style: { space: '15px' } },
                                                [
                                                    `✅ Checklists Aprovados: ${stats.checklistsAprovados}`,
                                                    `🔍 Auditorias Aprovadas: ${stats.auditoriasAprovadas}`,
                                                    `📘 Leis Aprovadas: ${stats.leisAprovadas}`,
                                                    `📊 Média Geral Checklists: ${stats.mediaChecklists}/100`,
                                                    `📈 Média Geral Auditorias: ${stats.mediaAuditorias}/140`,
                                                    `🔄 Total de Repor Painel: ${stats.reporPainel}`
                                                ].map((atividade, index) =>
                                                    h('div', {
                                                        key: index,
                                                        style: {
                                                            padding: '12px',
                                                            background: 'rgba(255, 215, 0, 0.1)',
                                                            borderRadius: '10px',
                                                            color: '#fff',
                                                            marginBottom: '10px',
                                                            borderLeft: '4px solid #ffd700'
                                                        }
                                                    }, atividade)
                                                )
                                            )
                                        ),

                                        // Status do servidor
                                        h('div', {
                                            style: {
                                                background: 'rgba(0,0,0,0.8)',
                                                backdropFilter: 'blur(10px)',
                                                border: '3px solid #228B22',
                                                borderRadius: '20px',
                                                padding: '30px',
                                                boxShadow: '0 0 30px rgba(34, 139, 34, 0.3)'
                                            }
                                        },
                                            h('h3', { style: { color: '#228B22', fontSize: '1.5rem', marginBottom: '20px', fontWeight: '800' } }, '📋 Detalhamento dos Dados'),
                                            h('div', { style: { space: '15px' } },
                                                [
                                                    { label: '✅ Checklists Pendentes', valor: checklists.filter(c => c.status === 'aguardando_aprovacao').length },
                                                    { label: '🔍 Auditorias Pendentes', valor: auditorias.filter(a => a.status === 'aguardando_aprovacao').length },
                                                    { label: '💸 Solicitações Pendentes', valor: solicitacoesFinanceiras.filter(s => s.status === 'aguardando_aprovacao').length },
                                                    { label: '👥 Usuários Ativos', valor: users.filter(u => u.status === 'aprovado').length },
                                                    { label: '⏰ Usuários Pendentes', valor: pendingUsers.length }
                                                ].map((item, index) =>
                                                    h('div', {
                                                        key: index,
                                                        style: {
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            padding: '12px',
                                                            background: 'rgba(34, 139, 34, 0.1)',
                                                            borderRadius: '10px',
                                                            color: '#fff',
                                                            marginBottom: '10px'
                                                        }
                                                    },
                                                        h('span', null, item.label),
                                                        h('strong', { style: { color: '#228B22' } }, item.valor)
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página Financeiro
                    const FinanceiroPage = () => {
                        const [novaSolicitacao, setNovaSolicitacao] = useState({
                            tipo: 'hack', descricao: '', valor: '', justificativa: '', idCorrupto: '', nomeCorrupto: ''
                        });
                        const [mostrarFormulario, setMostrarFormulario] = useState(false);

                        const handleSubmitSolicitacao = (e) => {
                            e.preventDefault();
                            
                            if (!novaSolicitacao.descricao || !novaSolicitacao.valor || !novaSolicitacao.justificativa) {
                                alert('⚠️ Preencha todos os campos!');
                                return;
                            }

                            // Validar campos específicos do caixa2
                            if (novaSolicitacao.tipo === 'caixa2') {
                                if (!novaSolicitacao.idCorrupto || !novaSolicitacao.nomeCorrupto) {
                                    alert('⚠️ Para Caixa 2, preencha ID e Nome do Corrupto!');
                                    return;
                                }
                            }

                            const solicitacao = {
                                ...novaSolicitacao,
                                autorId: currentUser.id,
                                autorNome: currentUser.nome,
                                autorCargo: currentUser.cargo,
                                status: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? 'aprovada' : 'aguardando_aprovacao',
                                aprovador: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? currentUser.nome : null,
                                dataAprovacao: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? new Date().toISOString() : null,
                                createdAt: new Date().toISOString(),
                                id: Date.now().toString()
                            };

                            setSolicitacoesFinanceiras([...solicitacoesFinanceiras, solicitacao]);
                            setNovaSolicitacao({ tipo: 'hack', descricao: '', valor: '', justificativa: '', idCorrupto: '', nomeCorrupto: '' });
                            setMostrarFormulario(false);
                            if (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') {
                                alert('✅ Solicitação financeira aprovada automaticamente!');
                            } else {
                                alert('✅ Solicitação financeira enviada para aprovação!');
                            }
                        };

                        const minhasSolicitacoes = solicitacoesFinanceiras.filter(s => s.autorId === currentUser.id);

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '40px' } },
                                        h('h2', { 
                                            style: { 
                                                fontSize: '2.8rem', 
                                                fontWeight: '900', 
                                                background: 'linear-gradient(45deg, #ffd700, #fff)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent',
                                                backgroundClip: 'text',
                                                margin: 0,
                                                textShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '💸 Painel Financeiro'),
                                        h('button', {
                                            onClick: () => setMostrarFormulario(!mostrarFormulario),
                                            style: {
                                                background: 'linear-gradient(45deg, #ffd700, #228B22)',
                                                color: '#000',
                                                padding: '16px 32px',
                                                border: '3px solid #ffd700',
                                                borderRadius: '15px',
                                                cursor: 'pointer',
                                                fontWeight: '900',
                                                fontSize: '1.1rem',
                                                textTransform: 'uppercase',
                                                boxShadow: '0 0 25px rgba(255, 215, 0, 0.5)'
                                            }
                                        }, mostrarFormulario ? '❌ Cancelar' : '➕ Nova Solicitação')
                                    ),

                                    // Formulário de Solicitação
                                    mostrarFormulario && h('div', {
                                        style: {
                                            background: 'rgba(0,0,0,0.8)',
                                            backdropFilter: 'blur(10px)',
                                            border: '3px solid #ffd700',
                                            borderRadius: '20px',
                                            padding: '40px',
                                            marginBottom: '40px',
                                            boxShadow: '0 0 40px rgba(255, 215, 0, 0.4)'
                                        }
                                    },
                                        h('h3', { 
                                            style: { 
                                                color: '#ffd700', 
                                                fontSize: '1.8rem', 
                                                marginBottom: '30px', 
                                                fontWeight: '800',
                                                textShadow: '0 0 15px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '💸 Nova Solicitação Financeira'),
                                        h('form', { onSubmit: handleSubmitSolicitacao },
                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '25px' } },
                                                h('div', null,
                                                    h('label', { 
                                                        style: { 
                                                            display: 'block', 
                                                            color: '#ffd700', 
                                                            marginBottom: '10px', 
                                                            fontWeight: '700',
                                                            fontSize: '1.1rem'
                                                        } 
                                                    }, 'Tipo de Solicitação'),
                                                    h('select', {
                                                        value: novaSolicitacao.tipo,
                                                        onChange: (e) => setNovaSolicitacao({ ...novaSolicitacao, tipo: e.target.value }),
                                                        style: {
                                                            width: '100%',
                                                            padding: '16px',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            fontSize: '16px',
                                                            fontWeight: '500'
                                                        },
                                                        required: true
                                                    },
                                                        h('option', { value: 'hack' }, 'Hack'),
                                                        h('option', { value: 'quebra' }, 'Quebra'),
                                                        h('option', { value: 'caixa2' }, 'Caixa 2')
                                                    )
                                                ),
                                                h('div', null,
                                                    h('label', { 
                                                        style: { 
                                                            display: 'block', 
                                                            color: '#ffd700', 
                                                            marginBottom: '10px', 
                                                            fontWeight: '700',
                                                            fontSize: '1.1rem'
                                                        } 
                                                    }, 'Valor (R$)'),
                                                    h('input', {
                                                        type: 'number',
                                                        step: '0.01',
                                                        value: novaSolicitacao.valor,
                                                        onChange: (e) => setNovaSolicitacao({ ...novaSolicitacao, valor: e.target.value }),
                                                        placeholder: 'Digite o valor',
                                                        style: {
                                                            width: '100%',
                                                            padding: '16px',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            fontSize: '16px',
                                                            fontWeight: '500'
                                                        },
                                                        required: true,
                                                        min: '0'
                                                    })
                                                )
                                            ),
                                            // Campos ID e Nome do Corrupto só aparecem para Caixa 2
                                            novaSolicitacao.tipo === 'caixa2' && h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '25px' } },
                                                h('div', null,
                                                    h('label', { 
                                                        style: { 
                                                            display: 'block', 
                                                            color: '#DC143C', 
                                                            marginBottom: '10px', 
                                                            fontWeight: '700',
                                                            fontSize: '1.1rem'
                                                        } 
                                                    }, 'ID do Corrupto'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: novaSolicitacao.idCorrupto,
                                                        onChange: (e) => setNovaSolicitacao({ ...novaSolicitacao, idCorrupto: e.target.value }),
                                                        placeholder: 'Digite o ID',
                                                        style: {
                                                            width: '100%',
                                                            padding: '16px',
                                                            border: '2px solid #DC143C',
                                                            borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            fontSize: '16px',
                                                            fontWeight: '500'
                                                        },
                                                        required: novaSolicitacao.tipo === 'caixa2'
                                                    })
                                                ),
                                                h('div', null,
                                                    h('label', { 
                                                        style: { 
                                                            display: 'block', 
                                                            color: '#DC143C', 
                                                            marginBottom: '10px', 
                                                            fontWeight: '700',
                                                            fontSize: '1.1rem'
                                                        } 
                                                    }, 'Nome do Corrupto'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: novaSolicitacao.nomeCorrupto,
                                                        onChange: (e) => setNovaSolicitacao({ ...novaSolicitacao, nomeCorrupto: e.target.value }),
                                                        placeholder: 'Digite o nome',
                                                        style: {
                                                            width: '100%',
                                                            padding: '16px',
                                                            border: '2px solid #DC143C',
                                                            borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            fontSize: '16px',
                                                            fontWeight: '500'
                                                        },
                                                        required: novaSolicitacao.tipo === 'caixa2'
                                                    })
                                                )
                                            ),
                                            h('div', { style: { marginBottom: '25px' } },
                                                h('label', { 
                                                    style: { 
                                                        display: 'block', 
                                                        color: '#ffd700', 
                                                        marginBottom: '10px', 
                                                        fontWeight: '700',
                                                        fontSize: '1.1rem'
                                                    } 
                                                }, 'Descrição'),
                                                h('input', {
                                                    type: 'text',
                                                    value: novaSolicitacao.descricao,
                                                    onChange: (e) => setNovaSolicitacao({ ...novaSolicitacao, descricao: e.target.value }),
                                                    placeholder: 'Descreva brevemente a solicitação',
                                                    style: {
                                                        width: '100%',
                                                        padding: '16px',
                                                        border: '2px solid #ffd700',
                                                        borderRadius: '12px',
                                                        background: 'rgba(0,0,0,0.7)',
                                                        color: '#fff',
                                                        fontSize: '16px',
                                                        fontWeight: '500'
                                                    },
                                                    required: true
                                                })
                                            ),
                                            h('div', { style: { marginBottom: '25px' } },
                                                h('label', { 
                                                    style: { 
                                                        display: 'block', 
                                                        color: '#ffd700', 
                                                        marginBottom: '10px', 
                                                        fontWeight: '700',
                                                        fontSize: '1.1rem'
                                                    } 
                                                }, 'Justificativa'),
                                                h('textarea', {
                                                    value: novaSolicitacao.justificativa,
                                                    onChange: (e) => setNovaSolicitacao({ ...novaSolicitacao, justificativa: e.target.value }),
                                                    placeholder: 'Justifique detalhadamente a necessidade...',
                                                    style: {
                                                        width: '100%',
                                                        padding: '16px',
                                                        border: '2px solid #ffd700',
                                                        borderRadius: '12px',
                                                        background: 'rgba(0,0,0,0.7)',
                                                        color: '#fff',
                                                        fontSize: '16px',
                                                        fontWeight: '500',
                                                        minHeight: '120px',
                                                        resize: 'vertical'
                                                    },
                                                    required: true
                                                })
                                            ),
                                            h('div', { style: { display: 'flex', gap: '20px' } },
                                                h('button', {
                                                    type: 'submit',
                                                    style: {
                                                        flex: 1,
                                                        background: 'linear-gradient(45deg, #228B22, #ffd700)',
                                                        color: '#000',
                                                        padding: '16px',
                                                        border: '2px solid #228B22',
                                                        borderRadius: '12px',
                                                        cursor: 'pointer',
                                                        fontWeight: '900',
                                                        fontSize: '1.1rem',
                                                        textTransform: 'uppercase'
                                                    }
                                                }, '💸 Enviar Solicitação'),
                                                h('button', {
                                                    type: 'button',
                                                    onClick: () => setMostrarFormulario(false),
                                                    style: {
                                                        background: 'transparent',
                                                        color: '#ffd700',
                                                        padding: '16px 32px',
                                                        border: '2px solid #ffd700',
                                                        borderRadius: '12px',
                                                        cursor: 'pointer',
                                                        fontWeight: '700',
                                                        fontSize: '1.1rem'
                                                    }
                                                }, 'Cancelar')
                                            )
                                        )
                                    ),

                                    // Lista de Solicitações
                                    h('div', { style: { display: 'grid', gap: '25px' } },
                                        minhasSolicitacoes.length > 0 ? minhasSolicitacoes.map((solicitacao, index) =>
                                            h('div', {
                                                key: index,
                                                style: {
                                                    background: solicitacao.status === 'aprovada' 
                                                        ? 'linear-gradient(135deg, rgba(34, 139, 34, 0.2), rgba(255, 215, 0, 0.1))'
                                                        : solicitacao.status === 'reprovada'
                                                        ? 'linear-gradient(135deg, rgba(220, 20, 60, 0.2), rgba(255, 0, 0, 0.1))'
                                                        : 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(0, 0, 0, 0.3))',
                                                    backdropFilter: 'blur(10px)',
                                                    border: `3px solid ${solicitacao.status === 'aprovada' ? '#228B22' : solicitacao.status === 'reprovada' ? '#DC143C' : '#ffd700'}`,
                                                    borderRadius: '20px',
                                                    padding: '30px',
                                                    boxShadow: solicitacao.status === 'aprovada' 
                                                        ? '0 0 30px rgba(34, 139, 34, 0.4)'
                                                        : solicitacao.status === 'reprovada'
                                                        ? '0 0 30px rgba(220, 20, 60, 0.4)'
                                                        : '0 0 30px rgba(255, 215, 0, 0.4)'
                                                }
                                            },
                                                h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px' } },
                                                    h('h4', { 
                                                        style: { 
                                                            color: '#ffd700', 
                                                            fontSize: '1.5rem', 
                                                            margin: 0, 
                                                            fontWeight: '800'
                                                        } 
                                                    }, solicitacao.descricao),
                                                    h('span', {
                                                        style: {
                                                            background: solicitacao.status === 'aprovada' 
                                                                ? 'linear-gradient(45deg, #228B22, #32CD32)'
                                                                : solicitacao.status === 'reprovada'
                                                                ? 'linear-gradient(45deg, #DC143C, #FF6347)'
                                                                : 'linear-gradient(45deg, #ffd700, #FFA500)',
                                                            color: '#000',
                                                            padding: '8px 16px',
                                                            borderRadius: '20px',
                                                            fontWeight: '700',
                                                            fontSize: '0.9rem',
                                                            textTransform: 'uppercase'
                                                        }
                                                    }, 
                                                    solicitacao.status === 'aprovada' ? '✅ Aprovada' 
                                                        : solicitacao.status === 'reprovada' ? '❌ Reprovada'
                                                        : '⏳ Aguardando'
                                                    )
                                                ),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', color: '#fff', marginBottom: '15px' } },
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Tipo: '), solicitacao.tipo.toUpperCase()),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Valor: '), `R$ ${parseFloat(solicitacao.valor).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`),
                                                    solicitacao.idCorrupto && h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#DC143C' } }, 'ID Corrupto: '), solicitacao.idCorrupto),
                                                    solicitacao.nomeCorrupto && h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#DC143C' } }, 'Nome Corrupto: '), solicitacao.nomeCorrupto),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Data: '), new Date(solicitacao.createdAt).toLocaleDateString('pt-BR'))
                                                ),
                                                h('div', { style: { padding: '15px', background: 'rgba(0,0,0,0.3)', borderRadius: '10px' } },
                                                    h('strong', { style: { color: '#ffd700' } }, 'Justificativa: '),
                                                    h('span', { style: { color: '#fff' } }, solicitacao.justificativa)
                                                ),
                                                h(AprovadoresInfo, { item: solicitacao }),
                                                h(HistoricoAprovacao, { item: solicitacao })
                                            )
                                        ) : h('div', {
                                            style: {
                                                textAlign: 'center',
                                                padding: '60px',
                                                background: 'rgba(0,0,0,0.3)',
                                                borderRadius: '20px',
                                                border: '2px dashed #ffd700'
                                            }
                                        },
                                            h('p', { 
                                                style: { 
                                                    color: '#ffd700', 
                                                    fontSize: '1.5rem', 
                                                    margin: 0, 
                                                    fontWeight: '700'
                                                } 
                                            }, '💸 Nenhuma solicitação financeira ainda')
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página do Legislativo Digital
                    const LegislativoPage = () => {
                        const [leisSolicitacoes, setLeisSolicitacoes] = useState([]);
                        const [form, setForm] = React.useState({
                            solicitanteNome: currentUser?.nome || '',
                            solicitanteId: currentUser?.id || '',
                            cargoRP: currentUser?.cargoRP || '',
                            cargoStaff: currentUser?.cargo || '',
                            envolvidos: '',
                            aFavor: '',
                            tipoRegra: '',
                            tipoAcao: '',
                            texto: ''
                        });
                        const [erro, setErro] = React.useState('');
                        const [enviando, setEnviando] = React.useState(false);
                        const [aba, setAba] = React.useState('abrir');
                        const podeAprovar = ['Diretor'].includes(currentUser?.cargo);
                        const [modalLeitura, setModalLeitura] = React.useState(null);

                        function enviar(e) {
                            e.preventDefault();
                            if (
                                !form.solicitanteNome || !form.solicitanteId || !form.cargoRP || !form.cargoStaff ||
                                !form.envolvidos || !form.aFavor || !form.tipoRegra || !form.tipoAcao || !form.texto
                            ) {
                                setErro('Preencha todos os campos obrigatórios!');
                                return;
                            }
                            setErro('');
                            setLeisSolicitacoes([
                                ...leisSolicitacoes,
                                {
                                    ...form,
                                    status: 'pendente',
                                    criadoPor: currentUser.id,
                                    criadoEm: new Date().toISOString(),
                                    id: Date.now(),
                                    historico: []
                                }
                            ]);
                            setForm({
                                solicitanteNome: currentUser?.nome || '',
                                solicitanteId: currentUser?.id || '',
                                cargoRP: currentUser?.cargoRP || '',
                                cargoStaff: currentUser?.cargo || '',
                                envolvidos: '',
                                aFavor: '',
                                tipoRegra: '',
                                tipoAcao: '',
                                texto: ''
                            });
                            setAba('pendentes');
                            alert('Solicitação enviada para aprovação!');
                        }

                        function aprovar(id) {
                            setLeisSolicitacoes(
                                leisSolicitacoes.map(sol => sol.id === id
                                    ? { ...sol, status: 'aprovada', aprovadoPor: currentUser.nome, aprovadoEm: new Date().toISOString(), historico: [...(sol.historico || []), {acao: 'Aprovado', por: currentUser.nome, em: new Date().toISOString()}] }
                                    : sol
                                )
                            );
                        }
                        function reprovar(id, justificativa) {
                            if (!justificativa) return alert('Justificativa obrigatória!');
                            setLeisSolicitacoes(
                                leisSolicitacoes.map(sol => sol.id === id
                                    ? { ...sol, status: 'reprovada', reprovadoPor: currentUser.nome, reprovadoEm: new Date().toISOString(), justificativa, historico: [...(sol.historico || []), {acao: 'Reprovado', por: currentUser.nome, em: new Date().toISOString(), justificativa}] }
                                    : sol
                                )
                            );
                        }

                        const minhas = leisSolicitacoes.filter(sol => sol.criadoPor === currentUser.id);
                        const pendentes = leisSolicitacoes.filter(sol => sol.status === 'pendente');
                        const aprovadas = leisSolicitacoes.filter(sol => sol.status === 'aprovada');

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px', maxWidth: 900, margin: '0 auto' } },
                                    h('h2', { 
                                        style: { 
                                            fontSize: '2.8rem', 
                                            fontWeight: '900', 
                                            background: 'linear-gradient(45deg, #ffd700, #fff)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            backgroundClip: 'text',
                                            marginBottom: '40px',
                                            textShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                                        } 
                                    }, '📘 Legislativo Digital / Leis da Cidade'),
                                    h('div', { style: { display: 'flex', gap: 10, marginBottom: 40 } },
                                        h('button', { onClick:()=>setAba('abrir'), style: { background: aba==='abrir'?'linear-gradient(45deg, #ffd700, #228B22)':'rgba(255, 215, 0, 0.2)', color: aba==='abrir'?'#000':'#ffd700', border: '2px solid #ffd700', borderRadius: 12, padding: '12px 24px', fontWeight: 'bold', cursor: 'pointer' } }, 'Nova Solicitação'),
                                        h('button', { onClick:()=>setAba('pendentes'), style: { background: aba==='pendentes'?'linear-gradient(45deg, #ffd700, #228B22)':'rgba(255, 215, 0, 0.2)', color: aba==='pendentes'?'#000':'#ffd700', border: '2px solid #ffd700', borderRadius: 12, padding: '12px 24px', fontWeight: 'bold', cursor: 'pointer' } }, 'Pendentes'),
                                        h('button', { onClick:()=>setAba('aprovadas'), style: { background: aba==='aprovadas'?'linear-gradient(45deg, #ffd700, #228B22)':'rgba(255, 215, 0, 0.2)', color: aba==='aprovadas'?'#000':'#ffd700', border: '2px solid #ffd700', borderRadius: 12, padding: '12px 24px', fontWeight: 'bold', cursor: 'pointer' } }, 'Leis Aprovadas'),
                                        h('button', { onClick:()=>setAba('minhas'), style: { background: aba==='minhas'?'linear-gradient(45deg, #ffd700, #228B22)':'rgba(255, 215, 0, 0.2)', color: aba==='minhas'?'#000':'#ffd700', border: '2px solid #ffd700', borderRadius: 12, padding: '12px 24px', fontWeight: 'bold', cursor: 'pointer' } }, 'Minhas Solicitações'),
                                    ),
                                    aba === 'abrir' && h('form', { onSubmit: enviar, style: { background: 'rgba(0,0,0,0.8)', backdropFilter: 'blur(10px)', border: '3px solid #ffd700', borderRadius: '20px', padding: '40px', marginBottom: 40, boxShadow: '0 0 40px rgba(255, 215, 0, 0.4)' } },
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.8rem', fontWeight: 'bold', marginBottom: 30, textShadow: '0 0 15px rgba(255, 215, 0, 0.5)' } }, 'Abertura de Solicitação de Lei'),
                                        erro && h('p', { style: { color: '#dc2626', fontWeight: 'bold', marginBottom: 14 } }, erro),
                                        h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '25px' } },
                                            h('div', { style: { marginBottom: 10 } },
                                                h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Seu nome'), 
                                                h('input', { value: form.solicitanteNome, onChange: e=>setForm(f=>({...f, solicitanteNome: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } })
                                            ),
                                            h('div', { style: { marginBottom: 10 } },
                                                h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Seu ID'), 
                                                h('input', { value: form.solicitanteId, onChange: e=>setForm(f=>({...f, solicitanteId: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } })
                                            ),
                                            h('div', { style: { marginBottom: 10 } },
                                                h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Cargo RP'), 
                                                h('input', { value: form.cargoRP, onChange: e=>setForm(f=>({...f, cargoRP: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } })
                                            ),
                                            h('div', { style: { marginBottom: 10 } },
                                                h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Cargo staff'), 
                                                h('input', { value: form.cargoStaff, onChange: e=>setForm(f=>({...f, cargoStaff: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } })
                                            )
                                        ),
                                        h('div', { style: { marginBottom: 20 } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Envolvidos no debate (nomes/cargos, separados por vírgula)'), 
                                            h('input', { value: form.envolvidos, onChange: e=>setForm(f=>({...f, envolvidos: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } })
                                        ),
                                        h('div', { style: { marginBottom: 20 } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Quem foi a favor (nomes/cargos, separados por vírgula)'), 
                                            h('input', { value: form.aFavor, onChange: e=>setForm(f=>({...f, aFavor: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } })
                                        ),
                                        h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '25px' } },
                                            h('div', { style: { marginBottom: 10 } },
                                                h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Tipo da regra'),
                                                h('select', { value: form.tipoRegra, onChange: e=>setForm(f=>({...f, tipoRegra: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } },
                                                    h('option', { value: '' }, 'Selecione...'),
                                                    h('option', { value: 'penal' }, 'Penal'),
                                                    h('option', { value: 'administrativa' }, 'Administrativa'),
                                                    h('option', { value: 'urbana' }, 'Urbana'),
                                                    h('option', { value: 'outra' }, 'Outra')
                                                )
                                            ),
                                            h('div', { style: { marginBottom: 10 } },
                                                h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Tipo da ação'),
                                                h('select', { value: form.tipoAcao, onChange: e=>setForm(f=>({...f, tipoAcao: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500' } },
                                                    h('option', { value: '' }, 'Selecione...'),
                                                    h('option', { value: 'criar' }, 'Criar nova regra'),
                                                    h('option', { value: 'alterar' }, 'Alterar regra existente'),
                                                    h('option', { value: 'remover' }, 'Remover regra')
                                                )
                                            )
                                        ),
                                        h('div', { style: { marginBottom: 25 } },
                                            h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Texto da nova regra / explicação da mudança ou remoção'),
                                            h('textarea', { value: form.texto, onChange: e=>setForm(f=>({...f, texto: e.target.value})), style: { width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px', background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500', minHeight: 120, resize: 'vertical' } })
                                        ),
                                        h('button', { type: 'submit', style: { background: 'linear-gradient(45deg, #228B22, #ffd700)', color: '#000', padding: '16px 32px', borderRadius: 12, fontWeight: 'bold', border: '2px solid #228B22', marginTop: 12, cursor: 'pointer', fontSize: '1.1rem', textTransform: 'uppercase' } }, 'Finalizar e Enviar para Aprovação')
                                    ),
                                    aba === 'pendentes' && h('div', {},
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.5rem', fontWeight: 'bold', marginBottom: 20 } }, 'Solicitações Pendentes'),
                                        pendentes.length === 0 && h('p', { style: { color: '#6b7280' } }, 'Nenhuma pendente.'),
                                        pendentes.map(sol =>
                                            h('div', { key: sol.id, style: { background: 'rgba(255, 215, 0, 0.1)', border: '2px solid #ffd700', borderRadius: 16, padding: 25, marginBottom: 25, boxShadow: '0 0 25px rgba(255, 215, 0, 0.3)' } },
                                                h('b', { style: { color: '#ffd700', fontSize: '1.2rem' } }, `Solicitante: ${sol.solicitanteNome} (${sol.solicitanteId}) [${sol.cargoRP}/${sol.cargoStaff}]`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Envolvidos: ${sol.envolvidos}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `A favor: ${sol.aFavor}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Tipo de regra: ${sol.tipoRegra}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Tipo de ação: ${sol.tipoAcao}`),
                                                h('div', { style: { marginTop: 20 } },
                                                    h('button', { onClick:()=>setModalLeitura(sol), style: { background: 'linear-gradient(45deg, #ffd700, #228B22)', color: '#000', border: 'none', borderRadius: 8, padding: '12px 24px', fontWeight: 'bold', marginRight: 12, cursor: 'pointer' } }, 'Visualizar/Analisar'),
                                                    !podeAprovar && h('span', { style: { color: '#f59e0b', fontWeight: '600' } }, '⚠️ Somente Diretoria/CEO podem aprovar')
                                                ),
                                                h(AprovadoresInfo, { item: sol, tipo: 'lei' }),
                                                h(HistoricoAprovacao, { item: sol })
                                            )
                                        ),
                                        modalLeitura && h('div', {
                                            style: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.7)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 9999 }
                                        },
                                            h('div', { style: { background: 'rgba(0,0,0,0.9)', border: '3px solid #ffd700', borderRadius: 20, maxWidth: 700, padding: 40, position: 'relative', backdropFilter: 'blur(15px)', boxShadow: '0 0 50px rgba(255, 215, 0, 0.5)' } },
                                                h('button', { onClick:()=>setModalLeitura(null), style: { position: 'absolute', top: 15, right: 15, background: '#e5e7eb', border: 'none', borderRadius: 25, padding: '5px 15px', fontWeight: 'bold', cursor: 'pointer' } }, 'X'),
                                                h('h3', { style: { color: '#ffd700', fontSize: '1.6rem', marginBottom: 20, fontWeight: 'bold' } }, 'Visualização da Solicitação'),
                                                h('p', { style: { color: '#fff', marginBottom: 10 } }, `Solicitante: ${modalLeitura.solicitanteNome} (${modalLeitura.solicitanteId}) [${modalLeitura.cargoRP}/${modalLeitura.cargoStaff}]`),
                                                h('p', { style: { color: '#fff', marginBottom: 10 } }, `Envolvidos: ${modalLeitura.envolvidos}`),
                                                h('p', { style: { color: '#fff', marginBottom: 10 } }, `A favor: ${modalLeitura.aFavor}`),
                                                h('p', { style: { color: '#fff', marginBottom: 10 } }, `Tipo de regra: ${modalLeitura.tipoRegra}`),
                                                h('p', { style: { color: '#fff', marginBottom: 15 } }, `Tipo de ação: ${modalLeitura.tipoAcao}`),
                                                h('p', { style: { background: 'rgba(255, 215, 0, 0.1)', border: '2px solid #ffd700', padding: 20, borderRadius: 12, fontWeight: 'bold', color: '#fff', margin: '20px 0' } }, modalLeitura.texto),
                                                podeAprovar && h('div', { style: { marginTop: 25, display: 'flex', gap: '15px' } },
                                                    h('button', { onClick:()=>{aprovar(modalLeitura.id);setModalLeitura(null);}, style: { background: 'linear-gradient(45deg, #228B22, #32CD32)', color: '#fff', border: 'none', borderRadius: 10, padding: '12px 30px', fontWeight: 'bold', cursor: 'pointer' } }, 'Aprovar'),
                                                    h('button', {
                                                        onClick:()=>{
                                                            const justificativa = prompt('Justificativa da reprovação:');
                                                            if(justificativa) {reprovar(modalLeitura.id, justificativa);setModalLeitura(null);}
                                                        },
                                                        style: { background: 'linear-gradient(45deg, #DC143C, #FF6347)', color: '#fff', border: 'none', borderRadius: 10, padding: '12px 30px', fontWeight: 'bold', cursor: 'pointer' }
                                                    }, 'Reprovar')
                                                )
                                            )
                                        )
                                    ),
                                    aba === 'aprovadas' && h('div', {},
                                        h('h3', { style: { color: '#228B22', fontSize: '1.5rem', fontWeight: 'bold', marginBottom: 20 } }, 'Leis Aprovadas'),
                                        aprovadas.length === 0 && h('p', { style: { color: '#6b7280' } }, 'Nenhuma aprovada ainda.'),
                                        aprovadas.map(sol =>
                                            h('div', { key: sol.id, style: { background: 'rgba(34, 139, 34, 0.1)', border: '2px solid #228B22', borderRadius: 16, padding: 25, marginBottom: 25, boxShadow: '0 0 25px rgba(34, 139, 34, 0.3)' } },
                                                h('b', { style: { color: '#228B22', fontSize: '1.2rem' } }, `Regra: ${sol.tipoRegra.toUpperCase()} | ${sol.tipoAcao.toUpperCase()}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Texto: ${sol.texto}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Aprovada por: ${sol.aprovadoPor || ''}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Data: ${sol.aprovadoEm ? new Date(sol.aprovadoEm).toLocaleString('pt-BR') : ''}`),
                                                sol.historico && sol.historico.length > 0 && h('details', { style: { marginTop: 15 } },
                                                    h('summary', { style: { color: '#ffd700', fontWeight: 'bold', cursor: 'pointer' } }, 'Histórico'),
                                                    sol.historico.map((hist,i) =>
                                                        h('p', { key: i, style: { fontSize: '0.92em', color: '#64748b', margin: '5px 0 5px 20px' } }, `${hist.acao} por ${hist.por} em ${new Date(hist.em).toLocaleString('pt-BR')}${hist.justificativa?' ('+hist.justificativa+')':''}`)
                                                    )
                                                )
                                            )
                                        )
                                    ),
                                    aba === 'minhas' && h('div', {},
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.5rem', fontWeight: 'bold', marginBottom: 20 } }, 'Minhas Solicitações'),
                                        minhas.length === 0 && h('p', { style: { color: '#6b7280' } }, 'Nenhuma aberta.'),
                                        minhas.map(sol =>
                                            h('div', { key: sol.id, style: { 
                                                background: sol.status === 'aprovada' 
                                                    ? 'rgba(34, 139, 34, 0.1)' 
                                                    : sol.status === 'reprovada' 
                                                    ? 'rgba(220, 20, 60, 0.1)' 
                                                    : 'rgba(255, 215, 0, 0.1)', 
                                                border: `2px solid ${sol.status === 'aprovada' ? '#228B22' : sol.status === 'reprovada' ? '#DC143C' : '#ffd700'}`, 
                                                borderRadius: 16, 
                                                padding: 25, 
                                                marginBottom: 25, 
                                                boxShadow: `0 0 25px ${sol.status === 'aprovada' ? 'rgba(34, 139, 34, 0.3)' : sol.status === 'reprovada' ? 'rgba(220, 20, 60, 0.3)' : 'rgba(255, 215, 0, 0.3)'}` 
                                            } },
                                                h('b', { style: { color: sol.status === 'aprovada' ? '#228B22' : sol.status === 'reprovada' ? '#DC143C' : '#ffd700', fontSize: '1.2rem' } }, `Solicitação: ${sol.tipoRegra.toUpperCase()} | ${sol.tipoAcao.toUpperCase()}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Texto: ${sol.texto}`),
                                                h('p', { style: { color: '#fff', margin: '10px 0' } }, `Status: ${
                                                    sol.status==='pendente' ? '⏳ Pendente' :
                                                    sol.status==='aprovada' ? '✅ Aprovada' : '❌ Rejeitada'
                                                }`),
                                                sol.status==='reprovada' && h('p', { style: { color: '#dc2626', margin: '10px 0' } }, `Justificativa da reprovação: ${sol.justificativa}`)
                                            )
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // ===== SISTEMA TOP DO MÊS =====
                    const TopDoMesPage = () => {
                        const [novoTopDoMes, setNovoTopDoMes] = useState({
                            tipo: 'staff', participa_de: '', nome_destaque: '', id_destaque: '', 
                            foto_url: '', nome_indicador: '', id_indicador: '', motivo: ''
                        });
                        const [mostrarFormulario, setMostrarFormulario] = useState(false);
                        const [filtro, setFiltro] = useState('todos');
                        const [fotoUpload, setFotoUpload] = useState(null);
                        
                        // Lista local de Top do Mês
                        const [topDoMesList, setTopDoMesList] = useState(() => {
                            const stored = localStorage.getItem('metax_top_do_mes');
                            return stored ? JSON.parse(stored) : [];
                        });
                        
                        // Atualizar localStorage quando a lista mudar
                        useEffect(() => {
                            localStorage.setItem('metax_top_do_mes', JSON.stringify(topDoMesList));
                        }, [topDoMesList]);

                        // Função para verificar vencimentos automaticamente
                        const verificarVencimentos = () => {
                            const hoje = new Date();
                            const vencidos = topDoMesList.filter(item => {
                                if (item.status !== 'ativo') return false;
                                const dataVencimento = new Date(item.data_proxima_avaliacao);
                                return dataVencimento <= hoje;
                            });

                            if (vencidos.length > 0) {
                                // Marcar como "pendente_reavaliacao"
                                vencidos.forEach(item => {
                                    setTopDoMesList(prevState => 
                                        prevState.map(t => 
                                            t.id === item.id 
                                                ? { ...t, status: 'pendente_reavaliacao' }
                                                : t
                                        )
                                    );
                                });
                            }
                            return vencidos;
                        };

                        // Verificar vencimentos ao carregar a página (apenas uma vez)
                        useEffect(() => {
                            verificarVencimentos();
                        }, []); // Array vazio para executar apenas uma vez

                        // Handle upload de foto
                        const handleFotoUpload = (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                if (file.size > 5 * 1024 * 1024) { // 5MB
                                    alert('⚠️ Arquivo muito grande! Máximo 5MB.');
                                    return;
                                }
                                setFotoUpload(file);
                                // Simular URL da foto (em produção, seria upload real)
                                const fakeUrl = `foto_${Date.now()}_${file.name}`;
                                setNovoTopDoMes({ ...novoTopDoMes, foto_url: fakeUrl });
                            }
                        };

                        const handleSubmitTopDoMes = async (e) => {
                            e.preventDefault();
                            
                            if (!novoTopDoMes.participa_de || !novoTopDoMes.nome_destaque || !novoTopDoMes.id_destaque || 
                                !novoTopDoMes.nome_indicador || !novoTopDoMes.id_indicador || !novoTopDoMes.motivo) {
                                alert('⚠️ Preencha todos os campos obrigatórios!');
                                return;
                            }

                            const hoje = new Date();
                            const proximaAvaliacao = new Date(hoje);
                            proximaAvaliacao.setMonth(proximaAvaliacao.getMonth() + 1);

                            const topDoMesData = {
                                ...novoTopDoMes,
                                id: Date.now().toString(),
                                autorId: currentUser.id,
                                autorNome: currentUser.nome,
                                autorCargo: currentUser.cargo,
                                status: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? 'ativo' : 'aguardando_aprovacao',
                                data_inicio: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? hoje.toISOString() : null,
                                data_proxima_avaliacao: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? proximaAvaliacao.toISOString() : null,
                                aprovador: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? currentUser.nome : null,
                                dataAprovacao: (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') ? hoje.toISOString() : null,
                                createdAt: hoje.toISOString(),
                                type: 'top_do_mes'
                            };

                            try {
                                // Adicionar ao estado local primeiro
                                setTopDoMesList([...topDoMesList, topDoMesData]);
                                
                                // Salvar no localStorage como backup
                                const stored = JSON.parse(localStorage.getItem('metax_top_do_mes') || '[]');
                                stored.push(topDoMesData);
                                localStorage.setItem('metax_top_do_mes', JSON.stringify(stored));
                                
                                // Tentar salvar no Supabase (não bloqueante)
                                try {
                                    await saveToSupabase('top_do_mes', topDoMesData);
                                } catch (supabaseError) {
                                    console.log('Salvamento no Supabase falhou, usando localStorage:', supabaseError);
                                }
                                
                                // Reset form
                                setNovoTopDoMes({
                                    tipo: 'staff', participa_de: '', nome_destaque: '', id_destaque: '', 
                                    foto_url: '', nome_indicador: '', id_indicador: '', motivo: ''
                                });
                                setFotoUpload(null);
                                setMostrarFormulario(false);
                                if (currentUser.cargo === 'CEO' || currentUser.cargo === 'Diretor') {
                                    alert(`✅ Top do Mês aprovado automaticamente! Válido até ${proximaAvaliacao.toLocaleDateString('pt-BR')}`);
                                } else {
                                    alert('✅ Top do Mês enviado para aprovação!');
                                }
                            } catch (error) {
                                console.error('Erro ao salvar:', error);
                                alert('❌ Erro ao salvar. Tente novamente.');
                            }
                        };

                        // Filtrar itens
                        const itensFiltrados = topDoMesList.filter(item => {
                            if (filtro === 'todos') return true;
                            if (filtro === 'meus') return item.autorId === currentUser.id;
                            if (filtro === 'vencidos') return item.status === 'pendente_reavaliacao';
                            return item.status === filtro;
                        });

                        // Contadores para estatísticas
                        const contadores = {
                            ativos: topDoMesList.filter(t => t.status === 'ativo').length,
                            pendentes: topDoMesList.filter(t => t.status === 'aguardando_aprovacao').length,
                            vencidos: topDoMesList.filter(t => t.status === 'pendente_reavaliacao').length,
                            meus: topDoMesList.filter(t => t.autorId === currentUser.id).length
                        };

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '40px' } },
                                        h('h2', { 
                                            style: { 
                                                fontSize: '2.8rem', 
                                                fontWeight: '900', 
                                                background: 'linear-gradient(45deg, #ffd700, #fff)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent',
                                                backgroundClip: 'text',
                                                margin: 0,
                                                textShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '🏆 Sistema Top do Mês'),
                                        h('button', {
                                            onClick: () => setMostrarFormulario(!mostrarFormulario),
                                            style: {
                                                background: 'linear-gradient(45deg, #ffd700, #228B22)',
                                                color: '#000',
                                                padding: '16px 32px',
                                                border: '3px solid #ffd700',
                                                borderRadius: '15px',
                                                cursor: 'pointer',
                                                fontWeight: '900',
                                                fontSize: '1.1rem',
                                                textTransform: 'uppercase',
                                                boxShadow: '0 0 25px rgba(255, 215, 0, 0.5)'
                                            }
                                        }, mostrarFormulario ? '❌ Cancelar' : '➕ Nova Indicação')
                                    ),

                                    // Estatísticas em cards
                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '20px', marginBottom: '40px' } },
                                        [
                                            { titulo: 'Top Ativos', valor: contadores.ativos, cor: '#228B22', icon: '🏆' },
                                            { titulo: 'Aguardando Aprovação', valor: contadores.pendentes, cor: '#ffd700', icon: '⏳' },
                                            { titulo: 'Vencidos', valor: contadores.vencidos, cor: '#DC143C', icon: '⚠️' },
                                            { titulo: 'Minhas Indicações', valor: contadores.meus, cor: '#4169E1', icon: '👤' }
                                        ].map((stat, index) =>
                                            h('div', {
                                                key: index,
                                                style: {
                                                    background: 'rgba(0,0,0,0.8)',
                                                    backdropFilter: 'blur(10px)',
                                                    border: `3px solid ${stat.cor}`,
                                                    borderRadius: '15px',
                                                    padding: '25px',
                                                    textAlign: 'center',
                                                    boxShadow: `0 0 20px ${stat.cor}40`
                                                }
                                            },
                                                h('div', { style: { fontSize: '2.5rem', marginBottom: '10px' } }, stat.icon),
                                                h('h3', { style: { color: stat.cor, fontSize: '1.1rem', marginBottom: '8px', fontWeight: '700' } }, stat.titulo),
                                                h('p', { style: { fontSize: '2rem', fontWeight: '900', color: '#fff', margin: 0 } }, stat.valor)
                                            )
                                        )
                                    ),

                                    // Filtros
                                    h('div', { style: { display: 'flex', gap: '15px', marginBottom: '30px', flexWrap: 'wrap' } },
                                        ['todos', 'ativo', 'aguardando_aprovacao', 'pendente_reavaliacao', 'meus', 'vencidos'].map(f => 
                                            h('button', {
                                                key: f,
                                                onClick: () => setFiltro(f),
                                                style: {
                                                    padding: '10px 20px',
                                                    background: filtro === f ? 'linear-gradient(45deg, #ffd700, #228B22)' : 'transparent',
                                                    color: filtro === f ? '#000' : '#ffd700',
                                                    border: '2px solid #ffd700',
                                                    borderRadius: '10px',
                                                    cursor: 'pointer',
                                                    fontWeight: '700',
                                                    textTransform: 'uppercase',
                                                    fontSize: '0.9rem'
                                                }
                                            }, f === 'todos' ? 'Todos' : f === 'meus' ? 'Meus' : f === 'vencidos' ? 'Vencidos' : f.replace(/_/g, ' '))
                                        )
                                    ),

                                    // Formulário de nova indicação
                                    mostrarFormulario && h('div', {
                                        style: {
                                            background: 'rgba(0,0,0,0.8)',
                                            backdropFilter: 'blur(10px)',
                                            border: '3px solid #ffd700',
                                            borderRadius: '20px',
                                            padding: '40px',
                                            marginBottom: '40px',
                                            boxShadow: '0 0 40px rgba(255, 215, 0, 0.4)'
                                        }
                                    },
                                        h('h3', { 
                                            style: { 
                                                color: '#ffd700', 
                                                fontSize: '1.8rem', 
                                                marginBottom: '30px', 
                                                fontWeight: '800',
                                                textShadow: '0 0 15px rgba(255, 215, 0, 0.5)'
                                            } 
                                        }, '🏆 Nova Indicação Top do Mês'),
                                        h('form', { onSubmit: handleSubmitTopDoMes },
                                            // Primeira linha: Tipo e Participa de
                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '25px' } },
                                                h('div', null,
                                                    h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Tipo *'),
                                                    h('div', { style: { display: 'flex', gap: '20px' } },
                                                        ['staff', 'roleplay'].map(tipo =>
                                                            h('label', {
                                                                key: tipo,
                                                                style: { display: 'flex', alignItems: 'center', gap: '8px', color: '#fff', cursor: 'pointer', fontSize: '1.1rem', fontWeight: '600' }
                                                            },
                                                                h('input', {
                                                                    type: 'radio',
                                                                    name: 'tipo',
                                                                    value: tipo,
                                                                    checked: novoTopDoMes.tipo === tipo,
                                                                    onChange: (e) => setNovoTopDoMes({ ...novoTopDoMes, tipo: e.target.value }),
                                                                    style: { transform: 'scale(1.2)' }
                                                                }),
                                                                tipo === 'staff' ? '👤 Staff' : '🎭 Roleplay'
                                                            )
                                                        )
                                                    )
                                                ),
                                                h('div', null,
                                                    h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Participa de *'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: novoTopDoMes.participa_de,
                                                        onChange: (e) => setNovoTopDoMes({ ...novoTopDoMes, participa_de: e.target.value }),
                                                        placeholder: 'Ex: Corregedoria, Igreja, Hospital...',
                                                        style: {
                                                            width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500'
                                                        },
                                                        required: true
                                                    })
                                                )
                                            ),
                                            // Segunda linha: Dados do destaque
                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '25px' } },
                                                h('div', null,
                                                    h('label', { style: { display: 'block', color: '#228B22', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Nome do Destaque *'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: novoTopDoMes.nome_destaque,
                                                        onChange: (e) => setNovoTopDoMes({ ...novoTopDoMes, nome_destaque: e.target.value }),
                                                        placeholder: 'Nome completo da pessoa',
                                                        style: {
                                                            width: '100%', padding: '16px', border: '2px solid #228B22', borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500'
                                                        },
                                                        required: true
                                                    })
                                                ),
                                                h('div', null,
                                                    h('label', { style: { display: 'block', color: '#228B22', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'ID do Destaque *'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: novoTopDoMes.id_destaque,
                                                        onChange: (e) => setNovoTopDoMes({ ...novoTopDoMes, id_destaque: e.target.value }),
                                                        placeholder: 'ID da pessoa',
                                                        style: {
                                                            width: '100%', padding: '16px', border: '2px solid #228B22', borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500'
                                                        },
                                                        required: true
                                                    })
                                                )
                                            ),
                                            // Terceira linha: Upload de foto
                                            h('div', { style: { marginBottom: '25px' } },
                                                h('label', { style: { display: 'block', color: '#4169E1', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Foto do Destaque (Opcional)'),
                                                h('input', {
                                                    type: 'file',
                                                    accept: 'image/*',
                                                    onChange: handleFotoUpload,
                                                    style: {
                                                        width: '100%', padding: '16px', border: '2px solid #4169E1', borderRadius: '12px',
                                                        background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px'
                                                    }
                                                }),
                                                fotoUpload && h('p', { style: { color: '#4169E1', marginTop: '8px', fontSize: '0.9rem' } }, `📸 Arquivo selecionado: ${fotoUpload.name}`)
                                            ),
                                            // Quarta linha: Dados de quem indicou
                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '25px', marginBottom: '25px' } },
                                                h('div', null,
                                                    h('label', { style: { display: 'block', color: '#DC143C', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Nome de Quem Indicou *'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: novoTopDoMes.nome_indicador,
                                                        onChange: (e) => setNovoTopDoMes({ ...novoTopDoMes, nome_indicador: e.target.value }),
                                                        placeholder: 'Seu nome ou de quem indicou',
                                                        style: {
                                                            width: '100%', padding: '16px', border: '2px solid #DC143C', borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500'
                                                        },
                                                        required: true
                                                    })
                                                ),
                                                h('div', null,
                                                    h('label', { style: { display: 'block', color: '#DC143C', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'ID de Quem Indicou *'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: novoTopDoMes.id_indicador,
                                                        onChange: (e) => setNovoTopDoMes({ ...novoTopDoMes, id_indicador: e.target.value }),
                                                        placeholder: 'ID de quem indicou',
                                                        style: {
                                                            width: '100%', padding: '16px', border: '2px solid #DC143C', borderRadius: '12px',
                                                            background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500'
                                                        },
                                                        required: true
                                                    })
                                                )
                                            ),
                                            // Quinta linha: Motivo
                                            h('div', { style: { marginBottom: '25px' } },
                                                h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '10px', fontWeight: '700', fontSize: '1.1rem' } }, 'Motivo / Observações *'),
                                                h('textarea', {
                                                    value: novoTopDoMes.motivo,
                                                    onChange: (e) => setNovoTopDoMes({ ...novoTopDoMes, motivo: e.target.value }),
                                                    placeholder: 'Descreva o motivo da indicação, trabalho exemplar, dedicação...',
                                                    style: {
                                                        width: '100%', padding: '16px', border: '2px solid #ffd700', borderRadius: '12px',
                                                        background: 'rgba(0,0,0,0.7)', color: '#fff', fontSize: '16px', fontWeight: '500',
                                                        minHeight: '120px', resize: 'vertical'
                                                    },
                                                    required: true
                                                })
                                            ),
                                            // Botões
                                            h('div', { style: { display: 'flex', gap: '20px' } },
                                                h('button', {
                                                    type: 'submit',
                                                    style: {
                                                        flex: 1, background: 'linear-gradient(45deg, #228B22, #ffd700)', color: '#000',
                                                        padding: '16px', border: '2px solid #228B22', borderRadius: '12px',
                                                        cursor: 'pointer', fontWeight: '900', fontSize: '1.1rem', textTransform: 'uppercase'
                                                    }
                                                }, '🏆 Enviar Indicação'),
                                                h('button', {
                                                    type: 'button',
                                                    onClick: () => setMostrarFormulario(false),
                                                    style: {
                                                        background: 'transparent', color: '#ffd700', padding: '16px 32px',
                                                        border: '2px solid #ffd700', borderRadius: '12px',
                                                        cursor: 'pointer', fontWeight: '700', fontSize: '1.1rem'
                                                    }
                                                }, 'Cancelar')
                                            )
                                        )
                                    ),

                                    // Lista de Top do Mês
                                    h('div', { style: { display: 'grid', gap: '25px' } },
                                        itensFiltrados.length > 0 ? itensFiltrados.map((item, index) =>
                                            h('div', {
                                                key: index,
                                                style: {
                                                    background: item.status === 'ativo' 
                                                        ? 'linear-gradient(135deg, rgba(34, 139, 34, 0.2), rgba(255, 215, 0, 0.1))'
                                                        : item.status === 'pendente_reavaliacao'
                                                        ? 'linear-gradient(135deg, rgba(220, 20, 60, 0.2), rgba(255, 0, 0, 0.1))'
                                                        : 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(0, 0, 0, 0.3))',
                                                    backdropFilter: 'blur(10px)',
                                                    border: `3px solid ${item.status === 'ativo' ? '#228B22' : item.status === 'pendente_reavaliacao' ? '#DC143C' : '#ffd700'}`,
                                                    borderRadius: '20px',
                                                    padding: '30px',
                                                    boxShadow: item.status === 'ativo' 
                                                        ? '0 0 30px rgba(34, 139, 34, 0.4)'
                                                        : item.status === 'pendente_reavaliacao'
                                                        ? '0 0 30px rgba(220, 20, 60, 0.4)'
                                                        : '0 0 30px rgba(255, 215, 0, 0.4)'
                                                }
                                            },
                                                h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '20px' } },
                                                    h('h4', { 
                                                        style: { 
                                                            color: '#ffd700', 
                                                            fontSize: '1.5rem', 
                                                            margin: 0, 
                                                            fontWeight: '800'
                                                        } 
                                                    }, `🏆 ${item.nome_destaque} - ${item.participa_de.toUpperCase()}`),
                                                    h('span', {
                                                        style: {
                                                            background: item.status === 'ativo' 
                                                                ? 'linear-gradient(45deg, #228B22, #32CD32)'
                                                                : item.status === 'pendente_reavaliacao'
                                                                ? 'linear-gradient(45deg, #DC143C, #FF6347)'
                                                                : 'linear-gradient(45deg, #ffd700, #FFA500)',
                                                            color: item.status === 'ativo' ? '#fff' : '#000',
                                                            padding: '8px 16px',
                                                            borderRadius: '20px',
                                                            fontWeight: '700',
                                                            fontSize: '0.9rem',
                                                            textTransform: 'uppercase'
                                                        }
                                                    }, 
                                                    item.status === 'ativo' ? '🏆 ATIVO' 
                                                        : item.status === 'pendente_reavaliacao' ? '⚠️ VENCIDO'
                                                        : item.status === 'aguardando_aprovacao' ? '⏳ AGUARDANDO'
                                                        : '❌ INATIVO'
                                                    )
                                                ),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', color: '#fff', marginBottom: '15px' } },
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Tipo: '), item.tipo === 'staff' ? 'Staff' : 'Roleplay'),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#228B22' } }, 'ID Destaque: '), item.id_destaque),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#DC143C' } }, 'Indicado por: '), `${item.nome_indicador} (ID: ${item.id_indicador})`),
                                                    item.data_inicio && h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#4169E1' } }, 'Início: '), new Date(item.data_inicio).toLocaleDateString('pt-BR')),
                                                    item.data_proxima_avaliacao && h('p', { style: { margin: 0 } }, h('strong', { style: { color: item.status === 'pendente_reavaliacao' ? '#DC143C' : '#9370DB' } }, 'Próxima Avaliação: '), new Date(item.data_proxima_avaliacao).toLocaleDateString('pt-BR')),
                                                    h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#ffd700' } }, 'Criado em: '), new Date(item.createdAt).toLocaleDateString('pt-BR'))
                                                ),
                                                item.foto_url && h('div', { style: { marginBottom: '15px' } },
                                                    h('strong', { style: { color: '#4169E1' } }, 'Foto: '),
                                                    h('span', { style: { color: '#fff' } }, item.foto_url)
                                                ),
                                                h('div', { style: { padding: '15px', background: 'rgba(0,0,0,0.3)', borderRadius: '10px' } },
                                                    h('strong', { style: { color: '#ffd700' } }, 'Motivo: '),
                                                    h('span', { style: { color: '#fff' } }, item.motivo)
                                                ),
                                                h(AprovadoresInfo, { item: item }),
                                                h(HistoricoAprovacao, { item: item })
                                            )
                                        ) : h('div', {
                                            style: {
                                                textAlign: 'center', padding: '60px', background: 'rgba(0,0,0,0.3)',
                                                borderRadius: '20px', border: '2px dashed #ffd700'
                                            }
                                        },
                                            h('p', { 
                                                style: { 
                                                    color: '#ffd700', 
                                                    fontSize: '1.5rem', 
                                                    margin: 0, 
                                                    fontWeight: '700'
                                                } 
                                            }, '🏆 Nenhum Top do Mês encontrado para o filtro selecionado')
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página de Feedback da Prefeitura/Política
                    const FeedbackPrefeituraPage = () => {
                        try {
                            console.log('🏛️ Iniciando FeedbackPrefeituraPage...');
                            console.log('📊 Dados disponíveis:', {
                                feedbacksPrefeitura: feedbacksPrefeitura?.length || 0,
                                currentUser: currentUser?.nome,
                                cargo: currentUser?.cargo
                            });
                            
                            console.log('🔍 Verificando dependências...', {
                                React: typeof React,
                                useState: typeof React.useState,
                                useEffect: typeof React.useEffect,
                                feedbacksPrefeitura: Array.isArray(feedbacksPrefeitura),
                                currentUser: !!currentUser
                            });
                        console.log('🪝 Inicializando useState activeTab...');
                        const [activeTab, setActiveTab] = useState('criar');
                        console.log('✅ activeTab inicializado');
                        console.log('🪝 Inicializando formFeedback...');
                        const [formFeedback, setFormFeedback] = React.useState({
                            usuario_solicitante: '',
                            nome_solicitante: '',
                            id_feedbacker: '',
                            categoria: '',
                            subcategoria: '',
                            nivel_complexidade: 'complexo',
                            origem: '',
                            descricao: '',
                            anexo_url: '',
                            resposta_aprovador: '',
                            status: 'pendente'
                        });
                        
                        // Preencher dados do usuário depois da inicialização
                        React.useEffect(() => {
                            if (currentUser?.id && !formFeedback.usuario_solicitante) {
                                setFormFeedback(prev => ({
                                    ...prev,
                                    usuario_solicitante: currentUser.id,
                                    nome_solicitante: currentUser.nome || ''
                                }));
                            }
                        }, [currentUser]);
                        const [erro, setErro] = React.useState('');
                        const [enviando, setEnviando] = React.useState(false);
                        
                        // Verificar se pode aprovar feedbacks
                        const podeAprovar = ['CEO', 'Diretor', 'Diretoria', 'Alta Cúpula', 'Resp. Comunidade'].includes(currentUser?.cargo);
                        
                        // Filtrar apenas feedbacks COMPLEXOS (que precisam de aprovação CEO/Alta Cúpula)
                        const feedbacksComplexos = feedbacksPrefeitura.filter(f => 
                            f.nivel_complexidade === 'complexo' && 
                            (f.status === 'pendente' || f.status === 'em_analise')
                        );
                        
                        // Debug logs
                        console.log('📊 FEEDBACK DEBUG:', {
                            totalFeedbacks: feedbacksPrefeitura.length,
                            feedbacksComplexos: feedbacksComplexos.length,
                            podeAprovar,
                            cargoAtual: currentUser?.cargo,
                            allFeedbacks: feedbacksPrefeitura,
                            complexosPendentes: feedbacksComplexos
                        });
                        
                        // Categorias de feedback com critério de complexidade
                        const categorias = {
                            'economia': {
                                label: '💰 Economia',
                                subcategorias: {
                                    'sistema_financeiro': { label: 'Sistema Financeiro', complexo: true },
                                    'banco_central': { label: 'Banco Central', complexo: true },
                                    'ajuste_precos': { label: 'Ajuste de Preços', complexo: false },
                                    'novos_jobs': { label: 'Novos Empregos', complexo: true }
                                }
                            },
                            'infraestrutura': {
                                label: '🏗️ Infraestrutura', 
                                subcategorias: {
                                    'mudanca_estrutural': { label: 'Mudança Estrutural Grande', complexo: true },
                                    'renovacao_area': { label: 'Renovação de Área Completa', complexo: true },
                                    'decoracao_simples': { label: 'Decoração Simples', complexo: false },
                                    'bugs_visuais': { label: 'Bugs Visuais', complexo: false }
                                }
                            },
                            'roleplay': {
                                label: '🎭 Roleplay',
                                subcategorias: {
                                    'mudanca_governo': { label: 'Mudança de Governo', complexo: true },
                                    'leis_federais': { label: 'Leis Federais', complexo: true },
                                    'conflitos_menores': { label: 'Conflitos Menores', complexo: false },
                                    'regras_basicas': { label: 'Regras Básicas', complexo: false }
                                }
                            },
                            'eventos': {
                                label: '🎪 Eventos/Cultura',
                                subcategorias: {
                                    'evento_server_wide': { label: 'Evento para Todo Servidor', complexo: true },
                                    'shows_grandes': { label: 'Shows/Competições Grandes', complexo: true },
                                    'evento_local': { label: 'Evento Local', complexo: false },
                                    'calendario_mensal': { label: 'Calendário Mensal', complexo: false }
                                }
                            },
                            'politica': {
                                label: '🏛️ Política/Prefeitura',
                                subcategorias: {
                                    'mudanca_prefeito': { label: 'Mudança de Prefeito', complexo: true },
                                    'politicas_servidor': { label: 'Políticas que Afetam Todo Servidor', complexo: true },
                                    'leis_municipais': { label: 'Leis Municipais', complexo: false },
                                    'cargos_ic': { label: 'Cargos In-Character', complexo: false }
                                }
                            }
                        };

                        async function criarFeedback(e) {
                            e.preventDefault();
                            console.log('🔄 Iniciando criação de feedback...');
                            console.log('📝 Dados do formulário:', formFeedback);
                            
                            setEnviando(true);
                            setErro('');
                            
                            if (!formFeedback.id_feedbacker || !formFeedback.categoria || !formFeedback.subcategoria || !formFeedback.descricao || !formFeedback.origem) {
                                console.log('❌ Campos faltando:', {
                                    id_feedbacker: !!formFeedback.id_feedbacker,
                                    categoria: !!formFeedback.categoria,
                                    subcategoria: !!formFeedback.subcategoria,
                                    descricao: !!formFeedback.descricao,
                                    origem: !!formFeedback.origem
                                });
                                setErro('⚠️ Preencha todos os campos obrigatórios (incluindo ID de quem deu o feedback)!');
                                setEnviando(false);
                                return;
                            }
                            
                            // Verificar se precisa de anexo (Discord)
                            if (formFeedback.origem === 'discord' && !formFeedback.anexo_url) {
                                setErro('⚠️ Feedbacks do Discord precisam de anexo (link da imagem)!');
                                setEnviando(false);
                                return;
                            }
                            
                            // Determinar automaticamente se é complexo
                            const subcatInfo = categorias[formFeedback.categoria]?.subcategorias[formFeedback.subcategoria];
                            const isComplexo = subcatInfo?.complexo || false;
                            
                            if (!isComplexo) {
                                setErro('⚠️ Este tipo de feedback deve ser resolvido no Discord pelo staff! Não precisa vir para este sistema.');
                                setEnviando(false);
                                return;
                            }
                            
                            const novoFeedback = {
                                ...formFeedback,
                                nivel_complexidade: 'complexo', // sempre complexo neste sistema
                                status: 'pendente'
                            };

                            try {
                                console.log('🚀 Enviando feedback para Supabase:', novoFeedback);
                                
                                const result = await saveToSupabase('feedbacks_prefeitura', novoFeedback);
                                console.log('✅ Resultado do Supabase:', result);
                                
                                // Atualizar lista local imediatamente
                                setFeedbacksPrefeitura([...feedbacksPrefeitura, novoFeedback]);
                                
                                // Recarregar do Supabase
                                refetchFeedbacks();
                                
                                const mensagem = MODO_TESTE 
                                    ? `🧪 TESTE REALIZADO COM SUCESSO!
                                
👤 Feedbacker: ${formFeedback.id_feedbacker}
📋 Tipo: ${categorias[formFeedback.categoria].label} > ${subcatInfo.label}
🎯 Nível: COMPLEXO (requer aprovação máxima)
⚠️ ATENÇÃO: Este foi apenas um TESTE - nenhum dado foi enviado ao servidor real.`
                                    : `✅ FEEDBACK ENVIADO COM SUCESSO!
                                
👤 Feedbacker: ${formFeedback.id_feedbacker}
📋 Tipo: ${categorias[formFeedback.categoria].label} > ${subcatInfo.label}
🎯 Nível: COMPLEXO (requer aprovação máxima)
⏳ Status: Pendente de análise

Sua solicitação está na fila para análise da alta administração.`;
                                
                                alert(mensagem);
                                
                                setFormFeedback({
                                    usuario_solicitante: currentUser?.id || '',
                                    nome_solicitante: currentUser?.nome || '',
                                    id_feedbacker: '',
                                    categoria: '',
                                    subcategoria: '',
                                    nivel_complexidade: 'complexo',
                                    origem: '',
                                    descricao: '',
                                    anexo_url: '',
                                    resposta_aprovador: '',
                                    status: 'pendente'
                                });
                                setErro('');
                                setActiveTab('lista');
                                
                            } catch (error) {
                                console.error('❌ Erro ao enviar feedback:', error);
                                setErro(`❌ Erro ao enviar feedback: ${error.message}`);
                            } finally {
                                setEnviando(false);
                            }
                        }

                        return h('div', { style: { padding: '24px', maxWidth: '1200px', margin: '0 auto' } },
                            // Botão de voltar
                            h('div', { style: { marginBottom: '20px' } },
                                h('button', {
                                    onClick: () => setCurrentPage('home'),
                                    style: {
                                        background: 'linear-gradient(135deg, #333, #555)',
                                        color: '#ffd700',
                                        border: '2px solid #ffd700',
                                        borderRadius: '10px',
                                        padding: '12px 24px',
                                        fontSize: '1rem',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease',
                                        boxShadow: '0 4px 15px rgba(255, 215, 0, 0.3)'
                                    },
                                    onMouseEnter: (e) => {
                                        e.target.style.background = 'linear-gradient(135deg, #ffd700, #ffed4e)';
                                        e.target.style.color = '#000';
                                    },
                                    onMouseLeave: (e) => {
                                        e.target.style.background = 'linear-gradient(135deg, #333, #555)';
                                        e.target.style.color = '#ffd700';
                                    }
                                }, '⬅️ Voltar ao Menu Principal')
                            ),
                            // Banner de modo de teste
                            h('div', { 
                                style: { 
                                    background: 'linear-gradient(135deg, #ff4444, #cc0000)',
                                    color: '#fff',
                                    padding: '16px',
                                    borderRadius: '10px',
                                    textAlign: 'center',
                                    marginBottom: '20px',
                                    border: '2px solid #ff6666',
                                    fontWeight: '700',
                                    fontSize: '1.1rem',
                                    boxShadow: '0 4px 15px rgba(255, 68, 68, 0.4)'
                                } 
                            }, '🧪 MODO DE TESTE ATIVO - Os dados NÃO são enviados para o servidor real'),
                            h('div', { style: { marginBottom: '32px', textAlign: 'center' } },
                                h('h2', { 
                                    style: { 
                                        fontSize: '2.5rem', 
                                        fontWeight: '900', 
                                        background: 'linear-gradient(45deg, #ffd700, #fff)',
                                        WebkitBackgroundClip: 'text',
                                        WebkitTextFillColor: 'transparent',
                                        backgroundClip: 'text',
                                        textShadow: '0 0 20px rgba(255, 215, 0, 0.5)',
                                        marginBottom: '16px'
                                    } 
                                }, '🏛️ Prefeitura / Política - Feedback'),
                                h('div', { style: { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '12px' } },
                                    h('p', { 
                                        style: { 
                                            color: '#ffd700', 
                                            fontSize: '1.2rem', 
                                            fontWeight: '600',
                                            background: 'rgba(255, 215, 0, 0.1)',
                                            padding: '12px 24px',
                                            borderRadius: '10px',
                                            border: '2px solid #ffd700',
                                            display: 'inline-block',
                                            margin: 0
                                        } 
                                    }, '⚠️ SOMENTE FEEDBACKS COMPLEXOS - Feedbacks simples são resolvidos no Discord'),

                                    // Debug info
                                    h('div', { 
                                        style: { 
                                            background: 'rgba(255, 0, 0, 0.1)', 
                                            border: '1px solid #ff6b6b',
                                            padding: '12px 20px', 
                                            borderRadius: '8px', 
                                            color: '#ff6b6b',
                                            fontSize: '0.9rem',
                                            fontWeight: '600'
                                        } 
                                    }, `🔍 DEBUG: ${feedbacksPrefeitura.length} feedbacks carregados | ${feedbacksComplexos.length} complexos pendentes | Pode aprovar: ${podeAprovar ? 'SIM' : 'NÃO'}`)
                                ),
                            ),

                            // Navegação das abas
                            h('div', { style: { display: 'flex', marginBottom: '32px', gap: '8px', justifyContent: 'center' } },
                                [
                                    { id: 'criar', label: '📝 Novo Feedback', icon: '📝' },
                                    { id: 'lista', label: '📋 Meus Feedbacks', icon: '📋' },
                                    ...(podeAprovar ? [{ id: 'pendentes', label: '⏳ Pendentes de Aprovação', icon: '⏳' }] : [])
                                ].map(tab =>
                                    h('button', {
                                        key: tab.id,
                                        onClick: () => setActiveTab(tab.id),
                                        style: {
                                            padding: '16px 24px',
                                            background: activeTab === tab.id ? 'linear-gradient(45deg, #ffd700, #228B22)' : 'rgba(255, 215, 0, 0.1)',
                                            color: activeTab === tab.id ? '#000' : '#ffd700',
                                            border: '2px solid #ffd700',
                                            borderRadius: '12px',
                                            cursor: 'pointer',
                                            fontWeight: '700',
                                            fontSize: '1rem',
                                            transition: 'all 0.3s ease',
                                            textTransform: 'uppercase'
                                        }
                                    }, tab.label)
                                )
                            ),

                            // Conteúdo das abas
                            (() => {
                                switch(activeTab) {
                                    case 'criar':
                                        return h('div', { style: { background: 'rgba(0,0,0,0.8)', padding: '32px', borderRadius: '15px', border: '2px solid #ffd700' } },
                                            h('form', { onSubmit: criarFeedback },
                                                erro && h('div', { 
                                                    style: { 
                                                        background: 'rgba(220, 20, 60, 0.2)', 
                                                        color: '#ff6b6b', 
                                                        padding: '16px', 
                                                        borderRadius: '10px', 
                                                        marginBottom: '24px',
                                                        border: '2px solid #ff6b6b'
                                                    } 
                                                }, erro),

                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '24px', marginBottom: '24px' } },
                                                    h('div', {},
                                                        h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, '🆔 ID de quem deu o Feedback'),
                                                        h('input', {
                                                            type: 'text',
                                                            value: formFeedback.id_feedbacker,
                                                            onChange: (e) => setFormFeedback({...formFeedback, id_feedbacker: e.target.value}),
                                                            placeholder: 'ID do jogador que deu o feedback',
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '10px',
                                                                fontSize: '16px'
                                                            },
                                                            required: true
                                                        })
                                                    ),

                                                    h('div', {},
                                                        h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, '🎯 Origem do Feedback'),
                                                        h('select', {
                                                            value: formFeedback.origem,
                                                            onChange: (e) => setFormFeedback({...formFeedback, origem: e.target.value}),
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '10px',
                                                                fontSize: '16px'
                                                            },
                                                            required: true
                                                        },
                                                            h('option', { value: '' }, 'Selecione a origem...'),
                                                            h('option', { value: 'discord' }, '💬 Discord (precisa anexo)'),
                                                            h('option', { value: 'ingame' }, '🎮 In-Game (não precisa anexo)')
                                                        )
                                                    ),

                                                ),

                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '24px', marginBottom: '24px' } },
                                                    h('div', {},
                                                        h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, '📂 Categoria Principal'),
                                                        h('select', {
                                                            value: formFeedback.categoria,
                                                            onChange: (e) => {
                                                                setFormFeedback({...formFeedback, categoria: e.target.value, subcategoria: ''});
                                                            },
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '10px',
                                                                fontSize: '16px'
                                                            },
                                                            required: true
                                                        },
                                                            h('option', { value: '' }, 'Selecione a categoria...'),
                                                            Object.keys(categorias).map(key =>
                                                                h('option', { key, value: key }, categorias[key].label)
                                                            )
                                                        )
                                                    ),

                                                    formFeedback.categoria && h('div', {},
                                                        h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, '🎯 Subcategoria'),
                                                        h('select', {
                                                            value: formFeedback.subcategoria,
                                                            onChange: (e) => setFormFeedback({...formFeedback, subcategoria: e.target.value}),
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '10px',
                                                                fontSize: '16px'
                                                            },
                                                            required: true
                                                        },
                                                            h('option', { value: '' }, 'Selecione a subcategoria...'),
                                                            Object.keys(categorias[formFeedback.categoria]?.subcategorias || {}).map(key => {
                                                                const subcat = categorias[formFeedback.categoria].subcategorias[key];
                                                                return h('option', { 
                                                                    key, 
                                                                    value: key,
                                                                    style: { color: subcat.complexo ? '#ffd700' : '#999' }
                                                                }, `${subcat.label} ${subcat.complexo ? '(COMPLEXO ✅)' : '(SIMPLES - Discord ❌)'}`);
                                                            })
                                                        )
                                                    )
                                                ),

                                                h('div', { style: { marginBottom: '24px' } },
                                                    h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, '📝 Descrição do Feedback'),
                                                    h('textarea', {
                                                        value: formFeedback.descricao,
                                                        onChange: (e) => setFormFeedback({...formFeedback, descricao: e.target.value}),
                                                        placeholder: 'Descreva detalhadamente seu feedback...',
                                                        rows: 6,
                                                        style: {
                                                            width: '100%',
                                                            padding: '16px',
                                                            background: 'rgba(0,0,0,0.7)',
                                                            color: '#fff',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '10px',
                                                            fontSize: '16px',
                                                            resize: 'vertical'
                                                        },
                                                        required: true
                                                    })
                                                ),

                                                formFeedback.origem === 'discord' && h('div', { style: { marginBottom: '24px' } },
                                                    h('label', { style: { display: 'block', color: '#ffd700', marginBottom: '8px', fontWeight: '700' } }, '📎 Anexo (Print do Discord)'),
                                                    h('div', { style: { display: 'grid', gap: '12px' } },
                                                        h('input', {
                                                            type: 'file',
                                                            accept: 'image/*',
                                                            onChange: (e) => {
                                                                const file = e.target.files[0];
                                                                if (file) {
                                                                    const reader = new FileReader();
                                                                    reader.onload = (event) => {
                                                                        setFormFeedback({
                                                                            ...formFeedback, 
                                                                            anexo_url: event.target.result
                                                                        });
                                                                    };
                                                                    reader.readAsDataURL(file);
                                                                }
                                                            },
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '10px',
                                                                fontSize: '16px'
                                                            },
                                                            required: formFeedback.origem === 'discord'
                                                        }),
                                                        h('input', {
                                                            type: 'url',
                                                            value: formFeedback.anexo_url,
                                                            onChange: (e) => setFormFeedback({...formFeedback, anexo_url: e.target.value}),
                                                            placeholder: 'OU cole o link da imagem: https://...',
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                background: 'rgba(0,0,0,0.7)',
                                                                color: '#fff',
                                                                border: '2px solid #32CD32',
                                                                borderRadius: '10px',
                                                                fontSize: '16px'
                                                            }
                                                        }),
                                                        formFeedback.anexo_url && h('div', {
                                                            style: {
                                                                background: 'rgba(255, 215, 0, 0.1)',
                                                                padding: '12px',
                                                                borderRadius: '8px',
                                                                border: '1px solid #ffd700',
                                                                textAlign: 'center'
                                                            }
                                                        },
                                                            h('p', { style: { color: '#ffd700', margin: '0 0 8px 0', fontSize: '0.9rem' } }, '📷 Preview da Imagem:'),
                                                            h('img', {
                                                                src: formFeedback.anexo_url,
                                                                alt: 'Preview',
                                                                style: {
                                                                    maxWidth: '100%',
                                                                    maxHeight: '200px',
                                                                    borderRadius: '8px',
                                                                    border: '2px solid #ffd700'
                                                                },
                                                                onError: (e) => {
                                                                    e.target.style.display = 'none';
                                                                    e.target.nextSibling.style.display = 'block';
                                                                }
                                                            }),
                                                            h('p', { 
                                                                style: { 
                                                                    color: '#ff6b6b', 
                                                                    margin: '8px 0 0 0', 
                                                                    fontSize: '0.8rem',
                                                                    display: 'none'
                                                                } 
                                                            }, '❌ Erro ao carregar imagem - verifique o link')
                                                        )
                                                    )
                                                ),

                                                // Alerta sobre complexidade
                                                formFeedback.subcategoria && h('div', { 
                                                    style: { 
                                                        background: categorias[formFeedback.categoria]?.subcategorias[formFeedback.subcategoria]?.complexo ? 'rgba(34, 139, 34, 0.2)' : 'rgba(220, 20, 60, 0.2)',
                                                        color: categorias[formFeedback.categoria]?.subcategorias[formFeedback.subcategoria]?.complexo ? '#32CD32' : '#ff6b6b',
                                                        padding: '16px', 
                                                        borderRadius: '10px', 
                                                        marginBottom: '24px',
                                                        border: `2px solid ${categorias[formFeedback.categoria]?.subcategorias[formFeedback.subcategoria]?.complexo ? '#32CD32' : '#ff6b6b'}`,
                                                        textAlign: 'center',
                                                        fontWeight: '700'
                                                    } 
                                                },
                                                    categorias[formFeedback.categoria]?.subcategorias[formFeedback.subcategoria]?.complexo 
                                                        ? '✅ FEEDBACK COMPLEXO - Será enviado para aprovação da alta administração'
                                                        : '❌ FEEDBACK SIMPLES - Este tipo deve ser resolvido no Discord pelo staff'
                                                ),

                                                h('div', { style: { display: 'flex', gap: '16px' } },
                                                    h('button', {
                                                        type: 'submit',
                                                        disabled: enviando,
                                                        style: {
                                                            flex: 1,
                                                            padding: '20px',
                                                            background: enviando ? 'linear-gradient(45deg, #888, #555)' : 'linear-gradient(45deg, #ffd700, #228B22)',
                                                            color: enviando ? '#ccc' : '#000',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '12px',
                                                            fontSize: '1.2rem',
                                                            fontWeight: '900',
                                                            cursor: enviando ? 'not-allowed' : 'pointer',
                                                            textTransform: 'uppercase',
                                                            letterSpacing: '1px',
                                                            opacity: enviando ? 0.7 : 1
                                                        }
                                                    }, enviando ? '⏳ Enviando...' : '🚀 Enviar Feedback Complexo'),

                                                    h('button', {
                                                        type: 'button',
                                                        onClick: async () => {
                                                            try {
                                                                console.log('🧪 Testando conexão Supabase feedbacks...');
                                                                const testFeedback = {
                                                                    id: 'teste_' + Date.now(),
                                                                    usuario_solicitante: currentUser?.id || 'teste',
                                                                    nome_solicitante: currentUser?.nome || 'Teste',
                                                                    id_feedbacker: 'player123',
                                                                    categoria: 'economia',
                                                                    subcategoria: 'sistema_financeiro',
                                                                    nivel_complexidade: 'complexo',
                                                                    origem: 'discord',
                                                                    descricao: 'Teste de conexão com Supabase',
                                                                    anexo_url: 'https://via.placeholder.com/300x200',
                                                                    status: 'pendente'
                                                                };
                                                                
                                                                console.log('📤 Enviando feedback teste:', testFeedback);
                                                                const result = await saveToSupabase('feedbacks_prefeitura', testFeedback);
                                                                console.log('✅ Resultado:', result);
                                                                
                                                                alert('✅ TESTE SUPABASE OK!\n\nFeedback teste criado com sucesso. Verifique a aba "Pendentes" se você tem permissão.');
                                                                refetchFeedbacks();
                                                            } catch (error) {
                                                                console.error('❌ Erro no teste:', error);
                                                                alert(`❌ ERRO NO TESTE:\n\n${error.message}`);
                                                            }
                                                        },
                                                        style: {
                                                            padding: '20px',
                                                            background: 'linear-gradient(45deg, #e74c3c, #c0392b)',
                                                            color: '#fff',
                                                            border: '2px solid #e74c3c',
                                                            borderRadius: '12px',
                                                            fontSize: '1rem',
                                                            fontWeight: '700',
                                                            cursor: 'pointer',
                                                            minWidth: '150px'
                                                        }
                                                    }, '🧪 Testar DB')
                                                )
                                            )
                                        );

                                    case 'lista':
                                        const meusFeedbacks = feedbacksPrefeitura.filter(f => f.usuario_solicitante === currentUser?.id);
                                        return h('div', { style: { background: 'rgba(0,0,0,0.8)', padding: '32px', borderRadius: '15px', border: '2px solid #ffd700' } },
                                            h('h3', { style: { color: '#ffd700', marginBottom: '24px', fontSize: '1.8rem', fontWeight: '700' } }, '📋 Meus Feedbacks'),
                                            
                                            meusFeedbacks.length === 0 ? h('div', { 
                                                style: { 
                                                    textAlign: 'center', 
                                                    padding: '40px',
                                                    color: '#ffd700',
                                                    fontSize: '1.2rem',
                                                    fontWeight: '600'
                                                } 
                                            }, '📝 Você ainda não enviou nenhum feedback complexo.') :
                                            
                                            h('div', { style: { display: 'grid', gap: '20px' } },
                                                meusFeedbacks.map(feedback =>
                                                    h('div', {
                                                        key: feedback.id,
                                                        style: {
                                                            background: 'rgba(255, 215, 0, 0.1)',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '12px',
                                                            padding: '20px'
                                                        }
                                                    },
                                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' } },
                                                            h('div', {},
                                                                h('h4', { style: { color: '#ffd700', margin: 0, fontSize: '1.2rem' } }, 
                                                                    `${categorias[feedback.categoria]?.label || feedback.categoria} > ${categorias[feedback.categoria]?.subcategorias[feedback.subcategoria]?.label || feedback.subcategoria}`),
                                                                h('p', { style: { color: '#228B22', margin: '4px 0', fontSize: '0.9rem' } }, 
                                                                    `📅 ${new Date(feedback.created_at).toLocaleDateString('pt-BR')} • 🎯 ${feedback.origem}`)
                                                            ),
                                                            h('span', { 
                                                                style: { 
                                                                    padding: '8px 16px',
                                                                    borderRadius: '20px',
                                                                    fontSize: '0.8rem',
                                                                    fontWeight: '700',
                                                                    background: feedback.status === 'pendente' ? 'rgba(255, 165, 0, 0.2)' : 
                                                                               feedback.status === 'aprovado' ? 'rgba(34, 139, 34, 0.2)' :
                                                                               feedback.status === 'negado' ? 'rgba(220, 20, 60, 0.2)' : 'rgba(128, 128, 128, 0.2)',
                                                                    color: feedback.status === 'pendente' ? '#FFA500' : 
                                                                           feedback.status === 'aprovado' ? '#32CD32' :
                                                                           feedback.status === 'negado' ? '#ff6b6b' : '#999'
                                                                } 
                                                            }, 
                                                                feedback.status === 'pendente' ? '⏳ Pendente' :
                                                                feedback.status === 'aprovado' ? '✅ Aprovado' :
                                                                feedback.status === 'negado' ? '❌ Negado' : '❓ Desconhecido'
                                                            )
                                                        ),
                                                        h('p', { style: { color: '#fff', margin: '12px 0', lineHeight: '1.5' } }, feedback.descricao),
                                                        
                                                        feedback.anexo_url && h('div', { style: { marginTop: '12px' } },
                                                            h('a', { 
                                                                href: feedback.anexo_url, 
                                                                target: '_blank',
                                                                style: { color: '#32CD32', textDecoration: 'underline' } 
                                                            }, '📎 Ver Anexo')
                                                        ),

                                                        (feedback.status === 'aprovado' || feedback.status === 'negado') && feedback.resposta_aprovador && 
                                                        h('div', { 
                                                            style: { 
                                                                marginTop: '16px',
                                                                padding: '16px',
                                                                background: feedback.status === 'aprovado' ? 'rgba(34, 139, 34, 0.1)' : 'rgba(220, 20, 60, 0.1)',
                                                                borderRadius: '8px',
                                                                borderLeft: `4px solid ${feedback.status === 'aprovado' ? '#32CD32' : '#ff6b6b'}`
                                                            }
                                                        },
                                                            h('h5', { 
                                                                style: { 
                                                                    color: feedback.status === 'aprovado' ? '#32CD32' : '#ff6b6b', 
                                                                    margin: '0 0 8px 0',
                                                                    fontSize: '1rem',
                                                                    fontWeight: '700'
                                                                } 
                                                            }, `${feedback.status === 'aprovado' ? '✅' : '❌'} Resposta da Administração:`),
                                                            h('p', { style: { color: '#fff', margin: 0, lineHeight: '1.4' } }, feedback.resposta_aprovador),
                                                            feedback.aprovador_nome && h('p', { 
                                                                style: { 
                                                                    color: '#ffd700', 
                                                                    margin: '8px 0 0 0', 
                                                                    fontSize: '0.9rem',
                                                                    fontStyle: 'italic'
                                                                } 
                                                            }, `👤 ${feedback.aprovador_nome} (${feedback.aprovador_cargo})`)
                                                        )
                                                    )
                                                )
                                            )
                                        );

                                    case 'pendentes':
                                        if (!podeAprovar) return null;
                                        
                                        return h('div', { style: { background: 'rgba(0,0,0,0.8)', padding: '32px', borderRadius: '15px', border: '2px solid #ffd700' } },
                                            h('h3', { style: { color: '#ffd700', marginBottom: '24px', fontSize: '1.8rem', fontWeight: '700' } }, '⏳ Feedbacks Complexos Pendentes'),
                                            
                                            feedbacksComplexos.length === 0 ? h('div', { 
                                                style: { 
                                                    textAlign: 'center', 
                                                    padding: '40px',
                                                    color: '#32CD32',
                                                    fontSize: '1.2rem',
                                                    fontWeight: '600'
                                                } 
                                            }, '✅ Não há feedbacks complexos pendentes de aprovação.') :
                                            
                                            h('div', { style: { display: 'grid', gap: '24px' } },
                                                feedbacksComplexos.map(feedback =>
                                                    h('div', {
                                                        key: feedback.id,
                                                        style: {
                                                            background: 'rgba(255, 165, 0, 0.1)',
                                                            border: '2px solid #FFA500',
                                                            borderRadius: '12px',
                                                            padding: '24px'
                                                        }
                                                    },
                                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '16px' } },
                                                            h('div', {},
                                                                h('h4', { style: { color: '#FFA500', margin: 0, fontSize: '1.3rem', fontWeight: '700' } }, 
                                                                    `${categorias[feedback.categoria]?.label || feedback.categoria} > ${categorias[feedback.categoria]?.subcategorias[feedback.subcategoria]?.label || feedback.subcategoria}`),
                                                                h('p', { style: { color: '#ffd700', margin: '4px 0', fontSize: '1rem' } }, 
                                                                    `👤 ${feedback.nome_solicitante} (ID: ${feedback.usuario_solicitante})`),
                                                                h('p', { style: { color: '#228B22', margin: '4px 0', fontSize: '0.9rem' } }, 
                                                                    `📅 ${new Date(feedback.created_at).toLocaleDateString('pt-BR')} • 🎯 ${feedback.origem.toUpperCase()}`)
                                                            ),
                                                            h('span', { 
                                                                style: { 
                                                                    padding: '8px 16px',
                                                                    borderRadius: '20px',
                                                                    fontSize: '0.9rem',
                                                                    fontWeight: '700',
                                                                    background: 'rgba(255, 215, 0, 0.2)',
                                                                    color: '#ffd700',
                                                                    border: '2px solid #ffd700'
                                                                } 
                                                            }, '🚨 COMPLEXO')
                                                        ),



                                                        h('div', { 
                                                            style: { 
                                                                background: 'rgba(255, 255, 255, 0.05)',
                                                                padding: '16px',
                                                                borderRadius: '8px',
                                                                margin: '16px 0'
                                                            }
                                                        },
                                                            h('h5', { style: { color: '#ffd700', margin: '0 0 8px 0' } }, '📝 Descrição:'),
                                                            h('p', { style: { color: '#fff', margin: 0, lineHeight: '1.5', fontSize: '1rem' } }, feedback.descricao)
                                                        ),

                                                        feedback.anexo_url && h('div', { style: { margin: '16px 0' } },
                                                            h('a', { 
                                                                href: feedback.anexo_url, 
                                                                target: '_blank',
                                                                style: { 
                                                                    color: '#32CD32', 
                                                                    textDecoration: 'underline',
                                                                    fontSize: '1rem',
                                                                    fontWeight: '600'
                                                                } 
                                                            }, '📎 Ver Anexo do Discord')
                                                        ),

                                                        h('div', { style: { display: 'flex', gap: '16px', marginTop: '20px' } },
                                                            h('button', {
                                                                onClick: async () => {
                                                                    if (!feedback || !feedback.id) {
                                                                        alert('❌ Erro: Feedback inválido');
                                                                        return;
                                                                    }
                                                                    
                                                                    const resposta = prompt('✅ APROVAR FEEDBACK\n\nDigite sua resposta/justificativa:');
                                                                    if (resposta && resposta.trim()) {
                                                                        try {
                                                                            console.log('📤 Aprovando feedback:', feedback.id);
                                                                            await saveToSupabase('feedbacks_prefeitura', {
                                                                                id: feedback.id,
                                                                                status: 'aprovado',
                                                                                resposta_aprovador: resposta,
                                                                                aprovador_nome: currentUser.nome,
                                                                                aprovador_cargo: currentUser.cargo,
                                                                                data_resposta: new Date().toISOString()
                                                                            }, true);
                                                                            refetchFeedbacks();
                                                                            alert('✅ Feedback aprovado com sucesso!');
                                                                        } catch (error) {
                                                                            console.error('❌ Erro ao aprovar feedback:', error);
                                                                            alert(`❌ Erro ao aprovar feedback: ${error.message || 'Erro desconhecido'}`);
                                                                        }
                                                                    }
                                                                },
                                                                style: {
                                                                    flex: 1,
                                                                    padding: '12px 20px',
                                                                    background: 'linear-gradient(45deg, #32CD32, #228B22)',
                                                                    color: '#000',
                                                                    border: '2px solid #32CD32',
                                                                    borderRadius: '10px',
                                                                    fontSize: '1rem',
                                                                    fontWeight: '700',
                                                                    cursor: 'pointer'
                                                                }
                                                            }, '✅ Aprovar'),

                                                            h('button', {
                                                                onClick: async () => {
                                                                    if (!feedback || !feedback.id) {
                                                                        alert('❌ Erro: Feedback inválido');
                                                                        return;
                                                                    }
                                                                    
                                                                    const resposta = prompt('❌ NEGAR FEEDBACK\n\nDigite o motivo da negação:');
                                                                    if (resposta && resposta.trim()) {
                                                                        try {
                                                                            console.log('📤 Negando feedback:', feedback.id);
                                                                            await saveToSupabase('feedbacks_prefeitura', {
                                                                                id: feedback.id,
                                                                                status: 'negado',
                                                                                resposta_aprovador: resposta,
                                                                                aprovador_nome: currentUser.nome,
                                                                                aprovador_cargo: currentUser.cargo,
                                                                                data_resposta: new Date().toISOString()
                                                                            }, true);
                                                                            refetchFeedbacks();
                                                                            alert('❌ Feedback negado com sucesso!');
                                                                        } catch (error) {
                                                                            console.error('❌ Erro ao negar feedback:', error);
                                                                            alert(`❌ Erro ao negar feedback: ${error.message || 'Erro desconhecido'}`);
                                                                        }
                                                                    }
                                                                },
                                                                style: {
                                                                    flex: 1,
                                                                    padding: '12px 20px',
                                                                    background: 'linear-gradient(45deg, #ff6b6b, #DC143C)',
                                                                    color: '#fff',
                                                                    border: '2px solid #ff6b6b',
                                                                    borderRadius: '10px',
                                                                    fontSize: '1rem',
                                                                    fontWeight: '700',
                                                                    cursor: 'pointer'
                                                                }
                                                            }, '❌ Negar')
                                                        )
                                                    )
                                                )
                                            )
                                        );
                                    
                                    default:
                                        return null;
                                }
                            })()
                        );
                        
                        } catch (error) {
                            console.error('🚨 ERRO CRÍTICO na FeedbackPrefeituraPage:', error);
                            return h('div', { 
                                style: { 
                                    padding: '40px', 
                                    textAlign: 'center',
                                    background: 'rgba(220, 20, 60, 0.1)',
                                    border: '2px solid #ff6b6b',
                                    borderRadius: '15px',
                                    margin: '20px'
                                } 
                            },
                                h('h2', { style: { color: '#ff6b6b', marginBottom: '16px' } }, '❌ Erro na Página de Feedback'),
                                h('p', { style: { color: '#fff', marginBottom: '16px' } }, `Erro: ${error.message}`),
                                h('button', {
                                    onClick: () => window.location.reload(),
                                    style: {
                                        padding: '12px 24px',
                                        background: '#ffd700',
                                        color: '#000',
                                        border: 'none',
                                        borderRadius: '8px',
                                        fontWeight: '700',
                                        cursor: 'pointer'
                                    }
                                }, '🔄 Recarregar Página')
                            );
                        }
                    };

                    // Página de Administração (somente CEO/Diretor)
                    const AdminPage = () => {
                        const [activeTab, setActiveTab] = useState('usuarios');
                        
                        // Estado local para Top do Mês na administração
                        const [topDoMesAdmin, setTopDoMesAdmin] = useState(() => {
                            const stored = localStorage.getItem('metax_top_do_mes');
                            return stored ? JSON.parse(stored) : [];
                        });
                        
                        // Sincronizar com localStorage quando mudar
                        useEffect(() => {
                            localStorage.setItem('metax_top_do_mes', JSON.stringify(topDoMesAdmin));
                        }, [topDoMesAdmin]);

                        const handleAprovarUsuario = async (userId) => {
                            const userToApprove = users.find(u => u.id === userId && u.status === 'pendente');
                            if (userToApprove) {
                                try {
                                    // Atualizar no Supabase
                                    await saveToSupabase('usuarios', { ...userToApprove, status: 'aprovado' }, true);
                                    
                                    // Atualizar estado local
                                    setUsers(users.map(u => 
                                        u.id === userId ? { ...u, status: 'aprovado' } : u
                                    ));
                                    
                                    alert(`✅ Usuário ${userToApprove.nome} aprovado com sucesso!`);
                                    refetchUsers(); // Recarregar dados do Supabase
                                } catch (error) {
                                    console.error('Erro ao aprovar usuário:', error);
                                    alert('❌ Erro ao aprovar usuário. Tente novamente.');
                                }
                            }
                        };

                        const handleReprovarUsuario = async (userId) => {
                            const userToReject = users.find(u => u.id === userId && u.status === 'pendente');
                            if (userToReject) {
                                try {
                                    // Remover do Supabase
                                    await supabase.from('usuarios').delete().eq('id', userId);
                                    
                                    // Remover do estado local
                                    setUsers(users.filter(u => u.id !== userId));
                                    
                                    alert(`❌ Usuário ${userToReject.nome} rejeitado!`);
                                    refetchUsers(); // Recarregar dados do Supabase
                                } catch (error) {
                                    console.error('Erro ao reprovar usuário:', error);
                                    alert('❌ Erro ao reprovar usuário. Tente novamente.');
                                }
                            }
                        };

                        const handleExcluirUsuario = async (userId) => {
                            const userToDelete = users.find(u => u.id === userId && u.status === 'aprovado');
                            if (userToDelete) {
                                // Não permitir excluir usuários padrão do sistema
                                if (['admin001', '7'].includes(userId)) {
                                    alert('⚠️ Não é possível excluir usuários padrão do sistema!');
                                    return;
                                }

                                try {
                                    // Remover do Supabase
                                    await supabase.from('usuarios').delete().eq('id', userId);
                                    
                                    // Remover do estado local
                                    setUsers(users.filter(u => u.id !== userId));
                                    
                                    alert(`🗑️ Usuário ${userToDelete.nome} excluído permanentemente!`);
                                    refetchUsers(); // Recarregar dados do Supabase
                                } catch (error) {
                                    console.error('Erro ao excluir usuário:', error);
                                    alert('❌ Erro ao excluir usuário. Tente novamente.');
                                }
                            }
                        };





                        const handleAprovarItem = (lista, setLista, itemId, statusAprovado) => {
                            setLista(lista.map(item => 
                                item.id === itemId || (item.createdAt && item.createdAt === itemId)
                                    ? { ...item, status: statusAprovado, aprovador: currentUser.nome, dataAprovacao: new Date().toISOString() }
                                    : item
                            ));
                            alert(`✅ Item ${statusAprovado}!`);
                        };

                        const handleReprovarItem = (lista, setLista, itemId, statusReprovado) => {
                            setLista(lista.map(item => 
                                item.id === itemId || (item.createdAt && item.createdAt === itemId)
                                    ? { ...item, status: statusReprovado, aprovador: currentUser.nome, dataAprovacao: new Date().toISOString() }
                                    : item
                            ));
                            alert(`❌ Item ${statusReprovado}!`);
                        };

                        return h('div', { style: { minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { 
                                        style: { 
                                            fontSize: '2.8rem', 
                                            fontWeight: '900', 
                                            background: 'linear-gradient(45deg, #ffd700, #fff)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            backgroundClip: 'text',
                                            marginBottom: '40px',
                                            textShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                                        } 
                                    }, '⚙️ Administração do Sistema'),

                                    // Tabs de navegação
                                    h('div', { style: { display: 'flex', gap: '20px', marginBottom: '40px' } },
                                        ['usuarios', 'checklists', 'auditorias', 'financeiro', 'topdomes'].map(tab =>
                                            h('button', {
                                                key: tab,
                                                onClick: () => setActiveTab(tab),
                                                style: {
                                                    padding: '12px 24px',
                                                    background: activeTab === tab ? 'linear-gradient(45deg, #ffd700, #228B22)' : 'transparent',
                                                    color: activeTab === tab ? '#000' : '#ffd700',
                                                    border: '2px solid #ffd700',
                                                    borderRadius: '12px',
                                                    cursor: 'pointer',
                                                    fontWeight: '700',
                                                    textTransform: 'uppercase',
                                                    transition: 'all 0.3s ease'
                                                }
                                            }, tab.charAt(0).toUpperCase() + tab.slice(1))
                                        )
                                    ),

                                    // Conteúdo das tabs
                                    activeTab === 'usuarios' && h('div', null,
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.8rem', marginBottom: '30px', fontWeight: '800' } }, '👥 Gerenciar Usuários'),
                                        
                                        // Usuários pendentes
                                        pendingUsers.length > 0 && h('div', { style: { marginBottom: '40px' } },
                                            h('h4', { style: { color: '#ffd700', fontSize: '1.4rem', marginBottom: '20px' } }, '⏳ Usuários Pendentes de Aprovação'),
                                            h('div', { style: { display: 'grid', gap: '20px' } },
                                                pendingUsers.map(user =>
                                                    h('div', {
                                                        key: user.id,
                                                        style: {
                                                            background: 'rgba(255, 215, 0, 0.1)',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '15px',
                                                            padding: '25px',
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center'
                                                        }
                                                    },
                                                        h('div', null,
                                                            h('h5', { style: { color: '#ffd700', fontSize: '1.2rem', margin: '0 0 5px 0' } }, user.nome),
                                                            h('p', { style: { color: '#fff', margin: '0 0 5px 0' } }, `ID: ${user.id} | Cargo: ${user.cargo}`),
                                                            h('p', { style: { color: '#228B22', margin: 0, fontSize: '0.9rem' } }, `Registrado em: ${new Date(user.createdAt).toLocaleDateString('pt-BR')}`)
                                                        ),
                                                        h('div', { style: { display: 'flex', gap: '15px' } },
                                                            h('button', {
                                                                onClick: () => handleAprovarUsuario(user.id),
                                                                style: {
                                                                    background: 'linear-gradient(45deg, #228B22, #32CD32)',
                                                                    color: '#fff',
                                                                    padding: '10px 20px',
                                                                    border: 'none',
                                                                    borderRadius: '8px',
                                                                    cursor: 'pointer',
                                                                    fontWeight: '700'
                                                                }
                                                            }, '✅ Aprovar'),
                                                            h('button', {
                                                                onClick: () => handleReprovarUsuario(user.id),
                                                                style: {
                                                                    background: 'linear-gradient(45deg, #DC143C, #FF6347)',
                                                                    color: '#fff',
                                                                    padding: '10px 20px',
                                                                    border: 'none',
                                                                    borderRadius: '8px',
                                                                    cursor: 'pointer',
                                                                    fontWeight: '700'
                                                                }
                                                            }, '❌ Reprovar')
                                                        )
                                                    )
                                                )
                                            )
                                        ),

                                        // Usuários aprovados
                                        h('div', null,
                                            h('h4', { style: { color: '#228B22', fontSize: '1.4rem', marginBottom: '20px' } }, '✅ Usuários Aprovados'),
                                            h('div', { style: { display: 'grid', gap: '15px' } },
                                                users.map(user =>
                                                    h('div', {
                                                        key: user.id,
                                                        style: {
                                                            background: 'rgba(34, 139, 34, 0.1)',
                                                            border: '2px solid #228B22',
                                                            borderRadius: '15px',
                                                            padding: '20px'
                                                        }
                                                    },
                                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center' } },
                                                            h('div', null,
                                                                h('h5', { style: { color: '#228B22', fontSize: '1.1rem', margin: '0 0 5px 0' } }, user.nome),
                                                                h('p', { style: { color: '#fff', margin: 0 } }, `ID: ${user.id} | ${user.cargo}`)
                                                            ),
                                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '15px' } },
                                                                h('span', { 
                                                                    style: { 
                                                                        background: '#228B22', 
                                                                        color: '#fff', 
                                                                        padding: '4px 12px', 
                                                                        borderRadius: '15px', 
                                                                        fontSize: '0.8rem',
                                                                        fontWeight: '700'
                                                                    } 
                                                                }, 'ATIVO'),
                                                                // Não permitir excluir usuários padrão (Admin Sistema e Daniel)
                                                                !['admin001', '7'].includes(user.id) && h('button', {
                                                                    onClick: () => {
                                                                        if (confirm(`⚠️ Tem certeza que deseja EXCLUIR permanentemente o usuário ${user.nome}?\n\nEsta ação não pode ser desfeita!`)) {
                                                                            handleExcluirUsuario(user.id);
                                                                        }
                                                                    },
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #8B0000, #DC143C)',
                                                                        color: '#fff',
                                                                        padding: '6px 12px',
                                                                        border: 'none',
                                                                        borderRadius: '8px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '700',
                                                                        fontSize: '0.8rem',
                                                                        textTransform: 'uppercase'
                                                                    }
                                                                }, '🗑️ Excluir')
                                                            )
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    ),

                                    activeTab === 'checklists' && h('div', null,
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.8rem', marginBottom: '30px', fontWeight: '800' } }, '✅ Gerenciar Checklists'),
                                        checklists.filter(c => c.status === 'aguardando_aprovacao').length > 0 ? 
                                            h('div', { style: { display: 'grid', gap: '20px' } },
                                                checklists.filter(c => c.status === 'aguardando_aprovacao').map(checklist =>
                                                    h('div', {
                                                        key: checklist.createdAt,
                                                        style: {
                                                            background: 'rgba(255, 215, 0, 0.1)',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '15px',
                                                            padding: '25px'
                                                        }
                                                    },
                                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '15px' } },
                                                            h('h5', { style: { color: '#ffd700', fontSize: '1.3rem', margin: 0 } }, `Checklist #${checklist.id}`),
                                                            h('div', { style: { display: 'flex', gap: '15px' } },
                                                                h('button', {
                                                                    onClick: () => handleAprovarItem(checklists, setChecklists, checklist.createdAt, 'aprovado'),
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #228B22, #32CD32)',
                                                                        color: '#fff',
                                                                        padding: '8px 16px',
                                                                        border: 'none',
                                                                        borderRadius: '8px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '700'
                                                                    }
                                                                }, '✅ Aprovar'),
                                                                h('button', {
                                                                    onClick: () => handleReprovarItem(checklists, setChecklists, checklist.createdAt, 'reprovado'),
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #DC143C, #FF6347)',
                                                                        color: '#fff',
                                                                        padding: '8px 16px',
                                                                        border: 'none',
                                                                        borderRadius: '8px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '700'
                                                                    }
                                                                }, '❌ Reprovar')
                                                            )
                                                        ),
                                                        h('div', { style: { color: '#fff', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px' } },
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Servidor: '), checklist.servidor),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Funcionário: '), checklist.funcionario),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Nota: '), `${checklist.nota}/100`),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Tipo: '), checklist.tipo === 'staff' ? 'Staff' : `RP - ${checklist.orgRP?.toUpperCase() || 'Geral'}`),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Autor: '), `${checklist.autorNome} (${checklist.autorCargo})`)
                                                        ),
                                                        checklist.observacao && h('div', { style: { marginTop: '15px', padding: '12px', background: 'rgba(0,0,0,0.3)', borderRadius: '8px' } },
                                                            h('strong', { style: { color: '#ffd700' } }, 'Observação: '),
                                                            h('span', { style: { color: '#fff' } }, checklist.observacao)
                                                        )
                                                    )
                                                )
                                            ) : h('p', { style: { color: '#ffd700', textAlign: 'center', fontSize: '1.2rem' } }, '✅ Nenhum checklist pendente')
                                    ),

                                    activeTab === 'auditorias' && h('div', null,
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.8rem', marginBottom: '30px', fontWeight: '800' } }, '🔍 Gerenciar Auditorias'),
                                        auditorias.filter(a => a.status === 'aguardando_aprovacao').length > 0 ? 
                                            h('div', { style: { display: 'grid', gap: '20px' } },
                                                auditorias.filter(a => a.status === 'aguardando_aprovacao').map(auditoria =>
                                                    h('div', {
                                                        key: auditoria.createdAt,
                                                        style: {
                                                            background: 'rgba(255, 215, 0, 0.1)',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '15px',
                                                            padding: '25px'
                                                        }
                                                    },
                                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '15px' } },
                                                            h('h5', { style: { color: '#ffd700', fontSize: '1.3rem', margin: 0 } }, `Auditoria #${auditoria.id}`),
                                                            h('div', { style: { display: 'flex', gap: '15px' } },
                                                                h('button', {
                                                                    onClick: () => handleAprovarItem(auditorias, setAuditorias, auditoria.createdAt, 'aprovada'),
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #228B22, #32CD32)',
                                                                        color: '#fff',
                                                                        padding: '8px 16px',
                                                                        border: 'none',
                                                                        borderRadius: '8px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '700'
                                                                    }
                                                                }, '✅ Aprovar'),
                                                                h('button', {
                                                                    onClick: () => handleReprovarItem(auditorias, setAuditorias, auditoria.createdAt, 'reprovada'),
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #DC143C, #FF6347)',
                                                                        color: '#fff',
                                                                        padding: '8px 16px',
                                                                        border: 'none',
                                                                        borderRadius: '8px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '700'
                                                                    }
                                                                }, '❌ Reprovar')
                                                            )
                                                        ),
                                                        h('div', { style: { color: '#fff', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px' } },
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Servidor: '), auditoria.servidor),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Funcionário: '), auditoria.funcionario),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Nota: '), `${auditoria.nota}/${auditoria.notaMaxima || 140}`),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Tipo: '), auditoria.tipo === 'staff' ? `Staff - ${auditoria.pastaStaff?.toUpperCase() || 'Geral'}` : `RP - ${auditoria.orgRP?.toUpperCase() || 'Geral'}`),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Autor: '), `${auditoria.autorNome} (${auditoria.autorCargo})`)
                                                        ),
                                                        auditoria.observacao && h('div', { style: { marginTop: '15px', padding: '12px', background: 'rgba(0,0,0,0.3)', borderRadius: '8px' } },
                                                            h('strong', { style: { color: '#ffd700' } }, 'Observação: '),
                                                            h('span', { style: { color: '#fff' } }, auditoria.observacao)
                                                        )
                                                    )
                                                )
                                            ) : h('p', { style: { color: '#ffd700', textAlign: 'center', fontSize: '1.2rem' } }, '✅ Nenhuma auditoria pendente')
                                    ),

                                    activeTab === 'financeiro' && h('div', null,
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.8rem', marginBottom: '30px', fontWeight: '800' } }, '💸 Gerenciar Financeiro'),
                                        solicitacoesFinanceiras.filter(s => s.status === 'aguardando_aprovacao').length > 0 ? 
                                            h('div', { style: { display: 'grid', gap: '20px' } },
                                                solicitacoesFinanceiras.filter(s => s.status === 'aguardando_aprovacao').map(solicitacao =>
                                                    h('div', {
                                                        key: solicitacao.createdAt,
                                                        style: {
                                                            background: 'rgba(255, 215, 0, 0.1)',
                                                            border: '2px solid #ffd700',
                                                            borderRadius: '15px',
                                                            padding: '25px'
                                                        }
                                                    },
                                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '15px' } },
                                                            h('h5', { style: { color: '#ffd700', fontSize: '1.3rem', margin: 0 } }, solicitacao.descricao),
                                                            h('div', { style: { display: 'flex', gap: '15px' } },
                                                                h('button', {
                                                                    onClick: () => handleAprovarItem(solicitacoesFinanceiras, setSolicitacoesFinanceiras, solicitacao.createdAt, 'aprovada'),
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #228B22, #32CD32)',
                                                                        color: '#fff',
                                                                        padding: '8px 16px',
                                                                        border: 'none',
                                                                        borderRadius: '8px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '700'
                                                                    }
                                                                }, '✅ Aprovar'),
                                                                h('button', {
                                                                    onClick: () => handleReprovarItem(solicitacoesFinanceiras, setSolicitacoesFinanceiras, solicitacao.createdAt, 'reprovada'),
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #DC143C, #FF6347)',
                                                                        color: '#fff',
                                                                        padding: '8px 16px',
                                                                        border: 'none',
                                                                        borderRadius: '8px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '700'
                                                                    }
                                                                }, '❌ Reprovar')
                                                            )
                                                        ),
                                                        h('div', { style: { color: '#fff', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px' } },
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Tipo: '), solicitacao.tipo.toUpperCase()),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Valor: '), `R$ ${parseFloat(solicitacao.valor).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`),
                                                            solicitacao.idCorrupto && h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#DC143C' } }, 'ID Corrupto: '), solicitacao.idCorrupto),
                                                            solicitacao.nomeCorrupto && h('p', { style: { margin: 0 } }, h('strong', { style: { color: '#DC143C' } }, 'Nome Corrupto: '), solicitacao.nomeCorrupto),
                                                            h('p', { style: { margin: 0 } }, h('strong', null, 'Autor: '), `${solicitacao.autorNome} (${solicitacao.autorCargo})`)
                                                        ),
                                                        h('div', { style: { marginTop: '15px', padding: '12px', background: 'rgba(0,0,0,0.3)', borderRadius: '8px' } },
                                                            h('strong', { style: { color: '#ffd700' } }, 'Justificativa: '),
                                                            h('span', { style: { color: '#fff' } }, solicitacao.justificativa)
                                                        )
                                                    )
                                                )
                                            ) : h('p', { style: { color: '#ffd700', textAlign: 'center', fontSize: '1.2rem' } }, '✅ Nenhuma solicitação financeira pendente')
                                    ),

                                    activeTab === 'topdomes' && h('div', null,
                                        h('h3', { style: { color: '#ffd700', fontSize: '1.8rem', marginBottom: '30px', fontWeight: '800' } }, '🏆 Gerenciar Top do Mês'),
                                        
                                        // Seção de vencimentos pendentes (ALERTAS ESPECIAIS)
                                        (() => {
                                            const vencimentos = topDoMesAdmin.filter(t => t.status === 'pendente_reavaliacao');
                                            if (vencimentos.length === 0) return null;
                                            
                                            return h('div', { style: { marginBottom: '40px' } },
                                                h('h4', { 
                                                    style: { 
                                                        color: '#DC143C', 
                                                        fontSize: '1.4rem', 
                                                        marginBottom: '20px',
                                                        textShadow: '0 0 10px rgba(220, 20, 60, 0.5)'
                                                    } 
                                                }, '⚠️ Top do Mês com Prazo Vencido - REQUER AÇÃO IMEDIATA'),
                                                h('div', { style: { display: 'grid', gap: '20px' } },
                                                    vencimentos.map(item =>
                                                        h('div', {
                                                            key: item.id,
                                                            style: {
                                                                background: 'linear-gradient(135deg, rgba(220, 20, 60, 0.3), rgba(255, 0, 0, 0.2))',
                                                                border: '3px solid #DC143C',
                                                                borderRadius: '15px',
                                                                padding: '25px',
                                                                boxShadow: '0 0 20px rgba(220, 20, 60, 0.4)',
                                                                animation: 'pulse 2s infinite'
                                                            }
                                                        },
                                                            h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' } },
                                                                h('div', null,
                                                                    h('h5', { style: { color: '#ffd700', fontSize: '1.3rem', margin: '0 0 5px 0' } }, 
                                                                        `🏆 ${item.nome_destaque} - ${item.participa_de.toUpperCase()}`
                                                                    ),
                                                                    h('p', { style: { color: '#DC143C', margin: '5px 0', fontWeight: '700' } }, 
                                                                        `⏰ VENCEU EM: ${new Date(item.data_proxima_avaliacao).toLocaleDateString('pt-BR')}`
                                                                    ),
                                                                    h('p', { style: { color: '#fff', margin: 0 } }, 
                                                                        `Indicado por: ${item.nome_indicador} | Motivo: ${item.motivo}`
                                                                    )
                                                                ),
                                                                h('button', {
                                                                    onClick: () => {
                                                                        if (confirm(`Deseja marcar o Top do Mês de ${item.nome_destaque} como "Novo Top do Mês necessário"?\n\nIsso permitirá que uma nova indicação seja feita para ${item.participa_de}.`)) {
                                                                            // Marcar como inativo para permitir nova indicação
                                                                            const updatedItem = { ...item, status: 'inativo', dataFinalizacao: new Date().toISOString() };
                                                                            const updatedList = topDoMesAdmin.map(t => t.id === item.id ? updatedItem : t);
                                                                            setTopDoMesAdmin(updatedList);
                                                                            alert(`✅ ${item.nome_destaque} marcado como finalizado. Nova indicação pode ser feita para ${item.participa_de}!`);
                                                                        }
                                                                    },
                                                                    style: {
                                                                        background: 'linear-gradient(45deg, #ffd700, #228B22)',
                                                                        color: '#000',
                                                                        padding: '12px 24px',
                                                                        border: 'none',
                                                                        borderRadius: '10px',
                                                                        cursor: 'pointer',
                                                                        fontWeight: '900',
                                                                        textTransform: 'uppercase',
                                                                        boxShadow: '0 0 15px rgba(255, 215, 0, 0.5)'
                                                                    }
                                                                }, '✅ CRIAR NOVO TOP DO MÊS')
                                                            )
                                                        )
                                                    )
                                                )
                                            );
                                        })(),
                                        
                                        // Pendentes de aprovação  
                                        (() => {
                                            return topDoMesAdmin.filter(t => t.status === 'aguardando_aprovacao').length > 0 ? 
                                                h('div', { style: { marginBottom: '40px' } },
                                                    h('h4', { style: { color: '#ffd700', fontSize: '1.4rem', marginBottom: '20px' } }, '⏳ Aguardando Aprovação'),
                                                    h('div', { style: { display: 'grid', gap: '20px' } },
                                                        topDoMesAdmin.filter(t => t.status === 'aguardando_aprovacao').map(topItem =>
                                                        h('div', {
                                                            key: topItem.id,
                                                            style: {
                                                                background: 'rgba(255, 215, 0, 0.1)',
                                                                border: '2px solid #ffd700',
                                                                borderRadius: '15px',
                                                                padding: '25px'
                                                            }
                                                        },
                                                            h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '15px' } },
                                                                h('h5', { style: { color: '#ffd700', fontSize: '1.3rem', margin: 0 } }, 
                                                                    `🏆 ${topItem.nome_destaque} - ${topItem.participa_de.toUpperCase()}`
                                                                ),
                                                                h('div', { style: { display: 'flex', gap: '15px' } },
                                                                    h('button', {
                                                                        onClick: () => {
                                                                            const hoje = new Date();
                                                                            const proximaAvaliacao = new Date(hoje);
                                                                            proximaAvaliacao.setMonth(proximaAvaliacao.getMonth() + 1);
                                                                            
                                                                            const itemAprovado = {
                                                                                ...topItem,
                                                                                status: 'ativo',
                                                                                data_inicio: hoje.toISOString(),
                                                                                data_proxima_avaliacao: proximaAvaliacao.toISOString(),
                                                                                aprovador: currentUser.nome,
                                                                                dataAprovacao: hoje.toISOString()
                                                                            };
                                                                            
                                                                            const updatedList = topDoMesAdmin.map(t => t.id === topItem.id ? itemAprovado : t);
                                                                            setTopDoMesAdmin(updatedList);
                                                                            alert(`✅ Top do Mês ${topItem.nome_destaque} aprovado! Válido até ${proximaAvaliacao.toLocaleDateString('pt-BR')}`);
                                                                        },
                                                                        style: {
                                                                            background: 'linear-gradient(45deg, #228B22, #32CD32)',
                                                                            color: '#fff',
                                                                            padding: '8px 16px',
                                                                            border: 'none',
                                                                            borderRadius: '8px',
                                                                            cursor: 'pointer',
                                                                            fontWeight: '700'
                                                                        }
                                                                    }, '✅ Aprovar'),
                                                                    h('button', {
                                                                        onClick: () => {
                                                                            const justificativa = prompt('Digite a justificativa da reprovação:');
                                                                            if (justificativa) {
                                                                                const itemReprovado = {
                                                                                    ...topItem,
                                                                                    status: 'reprovado',
                                                                                    justificativa_reprovacao: justificativa,
                                                                                    reprovador: currentUser.nome,
                                                                                    dataReprovacao: new Date().toISOString()
                                                                                };
                                                                                const updatedListReproved = topDoMesAdmin.map(t => t.id === topItem.id ? itemReprovado : t);
                                                                                setTopDoMesAdmin(updatedListReproved);
                                                                                alert(`❌ Top do Mês ${topItem.nome_destaque} reprovado!`);
                                                                            }
                                                                        },
                                                                        style: {
                                                                            background: 'linear-gradient(45deg, #DC143C, #FF6347)',
                                                                            color: '#fff',
                                                                            padding: '8px 16px',
                                                                            border: 'none',
                                                                            borderRadius: '8px',
                                                                            cursor: 'pointer',
                                                                            fontWeight: '700'
                                                                        }
                                                                    }, '❌ Reprovar')
                                                                )
                                                            ),
                                                            h('div', { style: { color: '#fff', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px' } },
                                                                h('p', { style: { margin: 0 } }, h('strong', null, 'Tipo: '), topItem.tipo === 'staff' ? 'Staff' : 'Roleplay'),
                                                                h('p', { style: { margin: 0 } }, h('strong', null, 'ID Destaque: '), topItem.id_destaque),
                                                                h('p', { style: { margin: 0 } }, h('strong', null, 'Indicado por: '), `${topItem.nome_indicador} (${topItem.id_indicador})`),
                                                                h('p', { style: { margin: 0 } }, h('strong', null, 'Autor Sistema: '), `${topItem.autorNome} (${topItem.autorCargo})`),
                                                                h('p', { style: { margin: 0 } }, h('strong', null, 'Data Criação: '), new Date(topItem.createdAt).toLocaleDateString('pt-BR'))
                                                            ),
                                                            topItem.foto_url && h('div', { style: { marginTop: '10px' } },
                                                                h('strong', { style: { color: '#4169E1' } }, 'Foto: '),
                                                                h('span', { style: { color: '#fff' } }, topItem.foto_url)
                                                            ),
                                                            h('div', { style: { marginTop: '15px', padding: '12px', background: 'rgba(0,0,0,0.3)', borderRadius: '8px' } },
                                                                h('strong', { style: { color: '#ffd700' } }, 'Motivo: '),
                                                                h('span', { style: { color: '#fff' } }, topItem.motivo)
                                                            )
                                                        )
                                                    )
                                                )
                                                ) : null;
                                        })(),
                                        
                                        // Estatísticas gerais
                                        (() => {
                                            return h('div', { style: { marginTop: '40px' } },
                                                h('h4', { style: { color: '#228B22', fontSize: '1.4rem', marginBottom: '20px' } }, '📊 Estatísticas Gerais'),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px' } },
                                                    [
                                                        { label: '🏆 Total Ativos', valor: topDoMesAdmin.filter(t => t.status === 'ativo').length, cor: '#228B22' },
                                                        { label: '⏳ Aguardando Aprovação', valor: topDoMesAdmin.filter(t => t.status === 'aguardando_aprovacao').length, cor: '#ffd700' },
                                                        { label: '⚠️ Vencidos', valor: topDoMesAdmin.filter(t => t.status === 'pendente_reavaliacao').length, cor: '#DC143C' },
                                                        { label: '📊 Total Staff', valor: topDoMesAdmin.filter(t => t.tipo === 'staff').length, cor: '#4169E1' },
                                                        { label: '🎭 Total Roleplay', valor: topDoMesAdmin.filter(t => t.tipo === 'roleplay').length, cor: '#9370DB' },
                                                        { label: '📈 Total Geral', valor: topDoMesAdmin.length, cor: '#ffd700' }
                                                    ].map((stat, index) =>
                                                    h('div', {
                                                        key: index,
                                                        style: {
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            padding: '15px',
                                                            background: `rgba(${stat.cor === '#228B22' ? '34, 139, 34' : stat.cor === '#ffd700' ? '255, 215, 0' : stat.cor === '#DC143C' ? '220, 20, 60' : stat.cor === '#4169E1' ? '65, 105, 225' : stat.cor === '#9370DB' ? '147, 112, 219' : '255, 215, 0'}, 0.1)`,
                                                            borderRadius: '10px',
                                                            color: '#fff',
                                                            border: `2px solid ${stat.cor}`
                                                        }
                                                    },
                                                        h('span', null, stat.label),
                                                        h('strong', { style: { color: stat.cor } }, stat.valor)
                                                    )
                                                    )
                                                )
                                            );
                                        })(),
                                        
                                        // Mensagem quando não há pendências
                                        (() => {
                                            return topDoMesAdmin.filter(t => t.status === 'aguardando_aprovacao' || t.status === 'pendente_reavaliacao').length === 0 && 
                                                h('div', { 
                                                    style: { 
                                                        textAlign: 'center', 
                                                        padding: '40px', 
                                                        background: 'rgba(34, 139, 34, 0.1)',
                                                        borderRadius: '15px',
                                                        border: '2px solid #228B22',
                                                        marginTop: '20px'
                                                    } 
                                                },
                                                    h('p', { 
                                                        style: { 
                                                            color: '#228B22', 
                                                            fontSize: '1.3rem', 
                                                            margin: 0, 
                                                            fontWeight: '700'
                                                        } 
                                                    }, '✅ Não há Top do Mês pendente de ação administrativa')
                                                );
                                        })()
                                    )
                                )
                            )
                        );
                    };

                    // Se não logado, mostrar login
                    if (!currentUser) {
                        return h(LoginPage);
                    }

                    // Roteamento completo
                    switch (currentView) {
                        case 'checklist':
                            return h(ChecklistPage);
                        case 'auditoria':
                            return h(AuditoriaPage);
                        case 'topdomes':
                            return h(TopDoMesPage);
                        case 'painel':
                            return h(PainelCidadePage);
                        case 'financeiro':
                            return h(FinanceiroPage);
                        case 'legislativo':
                            return h(LegislativoPage);
                        case 'feedback':
                            return h(FeedbackPrefeituraPage);

                        case 'admin':
                            return (currentUser?.cargo === 'CEO' || currentUser?.cargo === 'Diretor') 
                                ? h(AdminPage) 
                                : h(DashboardPage);
                        case 'dashboard':
                        default:
                            return h(DashboardPage);
                    }
                };

                // Renderizar aplicação
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    const root = ReactDOM.createRoot(rootElement);
                    root.render(h(MetaXSystem));
                    console.log('✅ MetaX v6.0 - Sistema Tecnológico carregado com sucesso!');
                    console.log('🎨 Nova identidade visual: Preto, Dourado, Verde Escuro e Branco');
                    console.log('🔥 Sistema completo com todas as perguntas específicas implementadas!');
                } else {
                    throw new Error('Elemento root não encontrado');
                }

            } catch (error) {
                console.error('❌ Erro ao carregar MetaX:', error);
                document.getElementById('root').innerHTML = `
                    <div style="
                        min-height: 100vh;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
                        color: #ffd700;
                        font-family: system-ui;
                        text-align: center;
                        padding: 2rem;
                    ">
                        <div style="
                            background: rgba(0,0,0,0.8);
                            backdrop-filter: blur(10px);
                            border-radius: 1rem;
                            padding: 2rem;
                            border: 2px solid #ffd700;
                            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
                        ">
                            <h1 style="font-size: 4rem; margin-bottom: 1rem;">⚠️</h1>
                            <h2 style="font-size: 1.8rem; margin-bottom: 1rem; color: #ffd700;">Erro no Sistema MetaX</h2>
                            <p style="margin-bottom: 1.5rem; opacity: 0.9; color: #fff;">${error.message}</p>
                            <button onclick="location.reload()" style="
                                background: linear-gradient(45deg, #ffd700, #228B22);
                                color: #000;
                                border: none;
                                padding: 1rem 2rem;
                                border-radius: 0.5rem;
                                font-weight: bold;
                                cursor: pointer;
                                font-size: 1rem;
                                text-transform: uppercase;
                            ">
                                🔄 Recarregar Sistema
                            </button>
                        </div>
                    </div>
                `;
            }
        }, 8000); // 8 segundos para carregamento tecnológico
    </script>
</body>
</html>
