import React, { useState, useEffect } from 'react';

// Substituto para useStoredState (funciona igual ao do Hatch)
const useStoredState = (key, initialValue) => {
  const [value, setValue] = useState(() => {
    try {
      const item = localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch {
      return initialValue;
    }
  });

  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(value));
  }, [key, value]);

  return [value, setValue];
};

// Importações dos ícones Lucide (adaptadas para versão independente)
const { 
  User, Settings, FileText, CheckSquare, BarChart3, Users, 
  Clock, Shield, ChevronDown, Save, Eye, UserCheck, 
  AlertCircle, CheckCircle, Calendar, Hash 
} = lucide;

// Dados iniciais e configurações
const CARGOS = [
  'CEO',
  'Diretor', 
  'Alta Cúpula',
  'ADM Staff',
  'RESP Comunidade',
  'Mentoria',
  'Staff Geral'
];

const EQUIPES_STAFF = [
  'Alta Cúpula', 'ADM Staff', 'RESP Comunidade', 'Mentoria',
  'Equipe Legal', 'Equipe Org', 'Social Media (SM)', 'Wall Street',
  'Streamline', 'Tolerância Zero', 'Comercial', 'Anti-Hack',
  'Ticketing', 'Eventos'
];

const SETORES_RP = [
  'Jurídico / Prefeitura', 'Igreja', 'Jornal', 'Hospital', 'Bombeiros',
  'Mecânica', 'Empresários', 'Facção', 'Máfia', 'Polícia'
];

const SUBSETORES_POLICIA = [
  'PRF', 'Federal', 'Civil', 'Militar', 'Prisão', 'BOPE', 'MPF', 'Segurança Jurídica'
];

const TURNOS = ['Manhã', 'Tarde', 'Noite'];

// Componente principal
const MetaXAuditSystem = () => {
  const [currentUser, setCurrentUser] = useStoredState('currentUser', null);
  const [users, setUsers] = useStoredState('users', [
    {
      id: 'admin001',
      nome: 'Administrador Sistema',
      senha: 'admin123',
      cargo: 'CEO',
      status: 'aprovado',
      createdAt: new Date().toISOString()
    }
  ]);
  const [pendingUsers, setPendingUsers] = useStoredState('pendingUsers', []);
  const [checklists, setChecklists] = useStoredState('checklists', []);
  const [auditorias, setAuditorias] = useStoredState('auditorias', []);
  const [currentView, setCurrentView] = useStoredState('currentView', 'login');
  const [notifications, setNotifications] = useStoredState('notifications', []);

  // Verificar permissões
  const canValidateChecklist = (user) => {
    return ['CEO', 'Diretor', 'Alta Cúpula'].includes(user?.cargo);
  };

  const canValidateAuditoria = (user) => {
    return ['CEO', 'Diretor'].includes(user?.cargo);
  };

  const canApproveUsers = (user) => {
    return ['CEO', 'Diretor'].includes(user?.cargo);
  };

  // Componente de Login
  const LoginForm = () => {
    const [loginData, setLoginData] = useState({ id: '', senha: '' });
    const [registerData, setRegisterData] = useState({
      nome: '', id: '', senha: '', cargo: 'Staff Geral'
    });
    const [isRegister, setIsRegister] = useState(false);

    const handleLogin = () => {
      const user = users.find(u => u.id === loginData.id && u.senha === loginData.senha && u.status === 'aprovado');
      if (user) {
        setCurrentUser(user);
        setCurrentView('dashboard');
      } else {
        alert('ID ou senha incorretos, ou usuário ainda não aprovado!');
      }
    };

    const handleRegister = () => {
      if (!registerData.nome || !registerData.id || !registerData.senha) {
        alert('Preencha todos os campos!');
        return;
      }

      const existingUser = [...users, ...pendingUsers].find(u => u.id === registerData.id);
      if (existingUser) {
        alert('ID já existe!');
        return;
      }

      const newUser = {
        ...registerData,
        status: 'pendente',
        createdAt: new Date().toISOString()
      };

      setPendingUsers([...pendingUsers, newUser]);
      alert('Cadastro enviado para aprovação!');
      setIsRegister(false);
      setRegisterData({ nome: '', id: '', senha: '', cargo: 'Staff Geral' });
    };

    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4">
        <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-8 w-full max-w-md border border-white/20">
          <div className="text-center mb-8">
            <h1 className="text-3xl font-bold text-white mb-2">MetaX</h1>
            <p className="text-purple-200">Sistema de Auditoria - Ilusion RP</p>
          </div>

          {!isRegister ? (
            <div className="space-y-4">
              <div>
                <label className="block text-white/80 mb-2">ID do Usuário</label>
                <input
                  type="text"
                  value={loginData.id}
                  onChange={(e) => setLoginData({...loginData, id: e.target.value})}
                  className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50"
                  placeholder="Digite seu ID"
                />
              </div>
              <div>
                <label className="block text-white/80 mb-2">Senha</label>
                <input
                  type="password"
                  value={loginData.senha}
                  onChange={(e) => setLoginData({...loginData, senha: e.target.value})}
                  className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50"
                  placeholder="Digite sua senha"
                />
              </div>
              <button
                onClick={handleLogin}
                className="w-full bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-lg font-semibold transition-colors"
              >
                Entrar
              </button>
              <button
                onClick={() => setIsRegister(true)}
                className="w-full bg-transparent border border-white/30 text-white p-3 rounded-lg font-semibold hover:bg-white/10 transition-colors"
              >
                Criar Conta
              </button>
            </div>
          ) : (
            <div className="space-y-4">
              <div>
                <label className="block text-white/80 mb-2">Nome Completo</label>
                <input
                  type="text"
                  value={registerData.nome}
                  onChange={(e) => setRegisterData({...registerData, nome: e.target.value})}
                  className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50"
                />
              </div>
              <div>
                <label className="block text-white/80 mb-2">ID</label>
                <input
                  type="text"
                  value={registerData.id}
                  onChange={(e) => setRegisterData({...registerData, id: e.target.value})}
                  className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50"
                />
              </div>
              <div>
                <label className="block text-white/80 mb-2">Senha</label>
                <input
                  type="password"
                  value={registerData.senha}
                  onChange={(e) => setRegisterData({...registerData, senha: e.target.value})}
                  className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50"
                />
              </div>
              <div>
                <label className="block text-white/80 mb-2">Cargo</label>
                <select
                  value={registerData.cargo}
                  onChange={(e) => setRegisterData({...registerData, cargo: e.target.value})}
                  className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white"
                >
                  {CARGOS.map(cargo => (
                    <option key={cargo} value={cargo} className="text-black">{cargo}</option>
                  ))}
                </select>
              </div>
              <button
                onClick={handleRegister}
                className="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg font-semibold transition-colors"
              >
                Cadastrar
              </button>
              <button
                onClick={() => setIsRegister(false)}
                className="w-full bg-transparent border border-white/30 text-white p-3 rounded-lg font-semibold hover:bg-white/10 transition-colors"
              >
                Voltar ao Login
              </button>
            </div>
          )}
        </div>
      </div>
    );
  };

  // Header do sistema
  const Header = () => (
    <div className="bg-white shadow-lg border-b-4 border-purple-500">
      <div className="max-w-7xl mx-auto px-4 py-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-4">
            <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-2 rounded-lg">
              <Shield className="w-8 h-8 text-white" />
            </div>
            <div>
              <h1 className="text-2xl font-bold text-gray-800">MetaX - Ilusion RP</h1>
              <p className="text-gray-600">Sistema de Auditoria</p>
            </div>
          </div>
          <div className="flex items-center space-x-4">
            <div className="text-right">
              <p className="font-semibold text-gray-800">{currentUser?.nome}</p>
              <p className="text-sm text-gray-600">{currentUser?.cargo}</p>
            </div>
            <button
              onClick={() => {
                setCurrentUser(null);
                setCurrentView('login');
              }}
              className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors"
            >
              Sair
            </button>
          </div>
        </div>
      </div>
    </div>
  );

  // Menu lateral
  const Sidebar = () => {
    const menuItems = [
      { id: 'dashboard', label: 'Dashboard', icon: BarChart3 },
      { id: 'checklist', label: 'Checklist', icon: CheckSquare },
      { id: 'auditoria', label: 'Auditoria', icon: FileText },
      { id: 'painel-cidade', label: 'Painel da Cidade', icon: Users },
      ...(canApproveUsers(currentUser) ? [{ id: 'admin', label: 'Administração', icon: Settings }] : [])
    ];

    return (
      <div className="bg-gray-900 text-white w-64 min-h-screen">
        <div className="p-4">
          {menuItems.map(item => {
            const Icon = item.icon;
            return (
              <button
                key={item.id}
                onClick={() => setCurrentView(item.id)}
                className={`w-full flex items-center space-x-3 p-3 rounded-lg mb-2 transition-colors ${
                  currentView === item.id ? 'bg-purple-600' : 'hover:bg-gray-800'
                }`}
              >
                <Icon className="w-5 h-5" />
                <span>{item.label}</span>
              </button>
            );
          })}
        </div>
      </div>
    );
  };

  // Dashboard
  const Dashboard = () => {
    const myChecklists = checklists.filter(c => c.autorId === currentUser.id);
    const myAuditorias = auditorias.filter(a => a.autorId === currentUser.id);
    const pendingApprovals = [
      ...checklists.filter(c => c.status === 'aguardando_aprovacao' && canValidateChecklist(currentUser)),
      ...auditorias.filter(a => a.status === 'aguardando_aprovacao' && canValidateAuditoria(currentUser))
    ];

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Dashboard</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div className="bg-blue-500 text-white p-6 rounded-xl">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-blue-100">Meus Checklists</p>
                <p className="text-3xl font-bold">{myChecklists.length}</p>
              </div>
              <CheckSquare className="w-12 h-12 text-blue-200" />
            </div>
          </div>
          
          <div className="bg-green-500 text-white p-6 rounded-xl">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-green-100">Minhas Auditorias</p>
                <p className="text-3xl font-bold">{myAuditorias.length}</p>
              </div>
              <FileText className="w-12 h-12 text-green-200" />
            </div>
          </div>
          
          <div className="bg-orange-500 text-white p-6 rounded-xl">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-orange-100">Pendente Aprovação</p>
                <p className="text-3xl font-bold">{pendingApprovals.length}</p>
              </div>
              <Clock className="w-12 h-12 text-orange-200" />
            </div>
          </div>
        </div>

        {pendingApprovals.length > 0 && (
          <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Pendente sua aprovação</h3>
            <div className="space-y-3">
              {pendingApprovals.map(item => (
                <div key={item.id} className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                  <div>
                    <p className="font-semibold">{item.tipo || 'Auditoria'} - {item.equipe || item.setor}</p>
                    <p className="text-sm text-gray-600">Por: {users.find(u => u.id === item.autorId)?.nome}</p>
                  </div>
                  <div className="flex space-x-2">
                    <button 
                      onClick={() => {
                        if (item.tipo) {
                          setCurrentView('checklist-view');
                        } else {
                          setCurrentView('auditoria-view');
                        }
                      }}
                      className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
                    >
                      Revisar
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Últimos Checklists</h3>
            <div className="space-y-3">
              {myChecklists.slice(-5).map(checklist => (
                <div key={checklist.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div>
                    <p className="font-semibold">{checklist.tipo} - {checklist.equipe}</p>
                    <p className="text-sm text-gray-600">{new Date(checklist.createdAt).toLocaleDateString('pt-BR')}</p>
                  </div>
                  <span className={`px-2 py-1 rounded text-xs font-semibold ${
                    checklist.status === 'aprovado' ? 'bg-green-100 text-green-800' :
                    checklist.status === 'aguardando_aprovacao' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-blue-100 text-blue-800'
                  }`}>
                    {checklist.status.replace('_', ' ').toUpperCase()}
                  </span>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Últimas Auditorias</h3>
            <div className="space-y-3">
              {myAuditorias.slice(-5).map(auditoria => (
                <div key={auditoria.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div>
                    <p className="font-semibold">{auditoria.tipo} - {auditoria.setor}</p>
                    <p className="text-sm text-gray-600">{new Date(auditoria.createdAt).toLocaleDateString('pt-BR')}</p>
                  </div>
                  <span className={`px-2 py-1 rounded text-xs font-semibold ${
                    auditoria.status === 'aprovada' ? 'bg-green-100 text-green-800' :
                    auditoria.status === 'aguardando_aprovacao' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-blue-100 text-blue-800'
                  }`}>
                    {auditoria.status.replace('_', ' ').toUpperCase()}
                  </span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Componente de Checklist
  const ChecklistComponent = () => {
    const [currentChecklist, setCurrentChecklist] = useState(null);
    const [formData, setFormData] = useState({});

    const startNewChecklist = (tipo) => {
      const newChecklist = {
        id: Date.now(),
        tipo,
        autorId: currentUser.id,
        status: 'em_andamento',
        createdAt: new Date().toISOString(),
        confirmacoesPainel: { manha: null, tarde: null, noite: null }
      };
      setCurrentChecklist(newChecklist);
      setFormData({});
    };

    const saveChecklist = () => {
      const updatedChecklist = {
        ...currentChecklist,
        ...formData,
        updatedAt: new Date().toISOString()
      };

      // Verificar se todas as confirmações de painel foram feitas (não nulos e não vazios)
      const confirmacoesCompletas = Object.values(updatedChecklist.confirmacoesPainel).every(val => val !== null && val !== '');
      
      if (confirmacoesCompletas && updatedChecklist.status === 'em_andamento') {
        updatedChecklist.status = 'aguardando_aprovacao';
        alert('Checklist enviado para aprovação! Todas as confirmações de painel foram preenchidas.');
      } else {
        alert('Checklist salvo como rascunho! Complete as confirmações de painel para enviar para aprovação.');
      }

      if (currentChecklist.id && checklists.find(c => c.id === currentChecklist.id)) {
        setChecklists(checklists.map(c => c.id === currentChecklist.id ? updatedChecklist : c));
      } else {
        setChecklists([...checklists, updatedChecklist]);
      }

      setCurrentChecklist(null);
      setFormData({});
    };

    if (currentChecklist) {
      return (
        <div className="p-6">
          <div className="bg-white rounded-xl shadow-lg p-6">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-800">
                {currentChecklist.tipo === 'staff' ? 'Checklist Staff (Discord)' : 'Checklist Roleplay (RP)'}
              </h2>
              <button
                onClick={() => setCurrentChecklist(null)}
                className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"
              >
                Cancelar
              </button>
            </div>

            <div className="space-y-6">
              {/* Seleção de equipe/setor */}
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  {currentChecklist.tipo === 'staff' ? 'Equipe' : 'Setor'}
                </label>
                <select
                  value={formData.equipe || formData.setor || ''}
                  onChange={(e) => setFormData({
                    ...formData, 
                    [currentChecklist.tipo === 'staff' ? 'equipe' : 'setor']: e.target.value
                  })}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                >
                  <option value="">Selecione...</option>
                  {(currentChecklist.tipo === 'staff' ? EQUIPES_STAFF : SETORES_RP).map(item => (
                    <option key={item} value={item}>{item}</option>
                  ))}
                </select>
              </div>

              {/* Subsetor para polícia */}
              {formData.setor === 'Polícia' && (
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">Subsetor</label>
                  <select
                    value={formData.subsetor || ''}
                    onChange={(e) => setFormData({...formData, subsetor: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                  >
                    <option value="">Selecione...</option>
                    {SUBSETORES_POLICIA.map(sub => (
                      <option key={sub} value={sub}>{sub}</option>
                    ))}
                  </select>
                </div>
              )}

              {/* Campos específicos para Staff */}
              {currentChecklist.tipo === 'staff' && (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">Quantas pessoas fazem parte da equipe?</label>
                    <input
                      type="number"
                      value={formData.totalPessoas || ''}
                      onChange={(e) => setFormData({...formData, totalPessoas: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">Quantas estão ativas?</label>
                    <input
                      type="number"
                      value={formData.pessoasAtivas || ''}
                      onChange={(e) => setFormData({...formData, pessoasAtivas: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">Quantas ficam no Discord?</label>
                    <input
                      type="number"
                      value={formData.pessoasDiscord || ''}
                      onChange={(e) => setFormData({...formData, pessoasDiscord: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">Quantas estão no jogo atendendo?</label>
                    <input
                      type="number"
                      value={formData.pessoasJogo || ''}
                      onChange={(e) => setFormData({...formData, pessoasJogo: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">Quantas metas a equipe já bateu até hoje?</label>
                    <input
                      type="number"
                      value={formData.metasBatidas || ''}
                      onChange={(e) => setFormData({...formData, metasBatidas: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">Desempenho geral da equipe</label>
                    <select
                      value={formData.desempenho || ''}
                      onChange={(e) => setFormData({...formData, desempenho: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    >
                      <option value="">Selecione...</option>
                      <option value="ruim">Ruim</option>
                      <option value="regular">Regular</option>
                      <option value="bom">Bom</option>
                      <option value="excelente">Excelente</option>
                    </select>
                  </div>
                </div>
              )}

              {/* Campos para RP */}
              {currentChecklist.tipo === 'rp' && (
                <div className="space-y-4">
                  {[
                    'Estrutura física está funcional?',
                    'Equipe ativa e presente?',
                    'Uso das funções no RP correto?',
                    'Comunicação externa funcionando?',
                    'Registros e documentos atualizados?'
                  ].map((pergunta, index) => (
                    <div key={index}>
                      <label className="block text-gray-700 font-semibold mb-2">{pergunta}</label>
                      <div className="flex space-x-4">
                        <label className="flex items-center">
                          <input
                            type="radio"
                            name={`pergunta_${index}`}
                            value="sim"
                            checked={formData[`pergunta_${index}`] === 'sim'}
                            onChange={(e) => setFormData({...formData, [`pergunta_${index}`]: e.target.value})}
                            className="mr-2"
                          />
                          Sim
                        </label>
                        <label className="flex items-center">
                          <input
                            type="radio"
                            name={`pergunta_${index}`}
                            value="nao"
                            checked={formData[`pergunta_${index}`] === 'nao'}
                            onChange={(e) => setFormData({...formData, [`pergunta_${index}`]: e.target.value})}
                            className="mr-2"
                          />
                          Não
                        </label>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {/* Confirmações de painel online */}
              <div className="bg-blue-50 p-6 rounded-lg border-2 border-blue-200">
                <h3 className="text-lg font-bold text-gray-800 mb-2">Confirmações do Painel Online</h3>
                <p className="text-sm text-blue-700 mb-4">
                  ⚠️ <strong>Obrigatório:</strong> Preencha os 3 turnos para enviar para aprovação
                </p>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {TURNOS.map(turno => {
                    const isCompleted = currentChecklist.confirmacoesPainel[turno.toLowerCase()] !== null && 
                                       currentChecklist.confirmacoesPainel[turno.toLowerCase()] !== '';
                    return (
                      <div key={turno}>
                        <label className="block text-gray-700 font-semibold mb-2 flex items-center">
                          {turno} - Pessoas Online
                          {isCompleted && <span className="ml-2 text-green-500">✓</span>}
                        </label>
                        <input
                          type="number"
                          min="0"
                          value={currentChecklist.confirmacoesPainel[turno.toLowerCase()] || ''}
                          onChange={(e) => {
                            const updatedConfirmacoes = {
                              ...currentChecklist.confirmacoesPainel,
                              [turno.toLowerCase()]: e.target.value
                            };
                            setCurrentChecklist({
                              ...currentChecklist,
                              confirmacoesPainel: updatedConfirmacoes
                            });
                          }}
                          className={`w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 ${
                            isCompleted ? 'border-green-300 bg-green-50' : 'border-gray-300'
                          }`}
                          placeholder="0"
                        />
                      </div>
                    );
                  })}
                </div>
                <div className="mt-4 text-center">
                  {Object.values(currentChecklist.confirmacoesPainel).every(val => val !== null && val !== '') ? (
                    <p className="text-green-600 font-semibold">✅ Todos os turnos preenchidos! Pronto para aprovação.</p>
                  ) : (
                    <p className="text-orange-600 font-semibold">
                      ⏳ Faltam {Object.values(currentChecklist.confirmacoesPainel).filter(val => val === null || val === '').length} turno(s)
                    </p>
                  )}
                </div>
              </div>

              <div className="flex justify-end space-x-4">
                <button
                  onClick={saveChecklist}
                  className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center space-x-2"
                >
                  <Save className="w-5 h-5" />
                  <span>
                    {Object.values(currentChecklist.confirmacoesPainel).every(val => val !== null && val !== '') 
                      ? 'Enviar para Aprovação' 
                      : 'Salvar Rascunho'}
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Checklist</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div className="bg-gradient-to-br from-blue-500 to-blue-700 text-white p-8 rounded-xl cursor-pointer hover:from-blue-600 hover:to-blue-800 transition-all transform hover:scale-105"
               onClick={() => startNewChecklist('staff')}>
            <div className="flex items-center justify-between mb-4">
              <Users className="w-12 h-12" />
              <ChevronDown className="w-6 h-6" />
            </div>
            <h3 className="text-2xl font-bold mb-2">Checklist Staff</h3>
            <p className="text-blue-100">Auditoria das equipes do Discord</p>
          </div>

          <div className="bg-gradient-to-br from-green-500 to-green-700 text-white p-8 rounded-xl cursor-pointer hover:from-green-600 hover:to-green-800 transition-all transform hover:scale-105"
               onClick={() => startNewChecklist('rp')}>
            <div className="flex items-center justify-between mb-4">
              <Shield className="w-12 h-12" />
              <ChevronDown className="w-6 h-6" />
            </div>
            <h3 className="text-2xl font-bold mb-2">Checklist Roleplay</h3>
            <p className="text-green-100">Auditoria dos setores RP</p>
          </div>
        </div>

        {/* Lista de checklists existentes */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4">Meus Checklists</h3>
          <div className="space-y-4">
            {checklists
              .filter(c => c.autorId === currentUser.id)
              .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
              .map(checklist => (
                <div key={checklist.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                  <div>
                    <p className="font-semibold text-gray-800">
                      {checklist.tipo === 'staff' ? 'Staff Discord' : 'Roleplay'} - {checklist.equipe || checklist.setor}
                    </p>
                    <p className="text-sm text-gray-600">
                      Criado em: {new Date(checklist.createdAt).toLocaleDateString('pt-BR')}
                    </p>
                    {checklist.subsetor && (
                      <p className="text-sm text-gray-600">Subsetor: {checklist.subsetor}</p>
                    )}
                  </div>
                  <div className="flex items-center space-x-4">
                    <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                      checklist.status === 'aprovado' ? 'bg-green-100 text-green-800' :
                      checklist.status === 'aguardando_aprovacao' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-blue-100 text-blue-800'
                    }`}>
                      {checklist.status.replace('_', ' ').toUpperCase()}
                    </span>
                    {checklist.status === 'em_andamento' && (
                      <button
                        onClick={() => {
                          setCurrentChecklist(checklist);
                          setFormData(checklist);
                        }}
                        className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
                      >
                        Continuar
                      </button>
                    )}
                  </div>
                </div>
              ))}
          </div>
        </div>
      </div>
    );
  };

  // Componente de Auditoria
  const AuditoriaComponent = () => {
    const [currentAuditoria, setCurrentAuditoria] = useState(null);
    const [formData, setFormData] = useState({});

    const startNewAuditoria = (tipo) => {
      const newAuditoria = {
        id: Date.now(),
        tipo,
        autorId: currentUser.id,
        status: 'em_andamento',
        createdAt: new Date().toISOString()
      };
      setCurrentAuditoria(newAuditoria);
      setFormData({});
    };

    const saveAuditoria = () => {
      if (!formData.relatorio || formData.relatorio.length < 100) {
        alert('O relatório deve ter pelo menos 100 caracteres!');
        return;
      }

      const updatedAuditoria = {
        ...currentAuditoria,
        ...formData,
        updatedAt: new Date().toISOString(),
        status: 'aguardando_aprovacao'
      };

      if (currentAuditoria.id && auditorias.find(a => a.id === currentAuditoria.id)) {
        setAuditorias(auditorias.map(a => a.id === currentAuditoria.id ? updatedAuditoria : a));
      } else {
        setAuditorias([...auditorias, updatedAuditoria]);
      }

      setCurrentAuditoria(null);
      setFormData({});
      alert('Auditoria salva com sucesso!');
    };

    if (currentAuditoria) {
      return (
        <div className="p-6">
          <div className="bg-white rounded-xl shadow-lg p-6">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-800">
                Auditoria {currentAuditoria.tipo === 'staff' ? 'Staff' : 'Roleplay'}
              </h2>
              <button
                onClick={() => setCurrentAuditoria(null)}
                className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"
              >
                Cancelar
              </button>
            </div>

            <div className="space-y-6">
              {/* Dados gerais */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">Setor Auditado</label>
                  <input
                    type="text"
                    value={formData.setor || ''}
                    onChange={(e) => setFormData({...formData, setor: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    placeholder="Nome do setor"
                  />
                </div>
                <div>
                  <label className="block text-gray-700 font-semibold mb-2">Turno</label>
                  <select
                    value={formData.turno || ''}
                    onChange={(e) => setFormData({...formData, turno: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                  >
                    <option value="">Selecione...</option>
                    {TURNOS.map(turno => (
                      <option key={turno} value={turno.toLowerCase()}>{turno}</option>
                    ))}
                  </select>
                </div>
              </div>

              {/* Campos específicos para auditoria Staff */}
              {currentAuditoria.tipo === 'staff' && (
                <div className="space-y-4">
                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">
                      Estrutura funcional?
                    </label>
                    <div className="flex space-x-4 mb-2">
                      <label className="flex items-center">
                        <input
                          type="radio"
                          name="estruturaFuncional"
                          value="sim"
                          checked={formData.estruturaFuncional === 'sim'}
                          onChange={(e) => setFormData({...formData, estruturaFuncional: e.target.value})}
                          className="mr-2"
                        />
                        Sim
                      </label>
                      <label className="flex items-center">
                        <input
                          type="radio"
                          name="estruturaFuncional"
                          value="nao"
                          checked={formData.estruturaFuncional === 'nao'}
                          onChange={(e) => setFormData({...formData, estruturaFuncional: e.target.value})}
                          className="mr-2"
                        />
                        Não
                      </label>
                    </div>
                    <textarea
                      value={formData.estruturaObservacoes || ''}
                      onChange={(e) => setFormData({...formData, estruturaObservacoes: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                      placeholder="Observações sobre a estrutura..."
                      rows="3"
                    />
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Membros Contratados</label>
                      <input
                        type="number"
                        value={formData.membrosContratados || ''}
                        onChange={(e) => setFormData({...formData, membrosContratados: e.target.value})}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                      />
                    </div>
                    <div>
                      <label className="block text-gray-700 font-semibold mb-2">Membros Online (48h)</label>
                      <input
                        type="number"
                        value={formData.membrosOnline48h || ''}
                        onChange={(e) => setFormData({...formData, membrosOnline48h: e.target.value})}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-gray-700 font-semibold mb-2">Lista de Membros e IDs</label>
                    <textarea
                      value={formData.listaMembros || ''}
                      onChange={(e) => setFormData({...formData, listaMembros: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                      placeholder="Liste os membros e seus IDs..."
                      rows="4"
                    />
                  </div>

                  {[
                    { key: 'cumprimentoConduta', label: 'Cumprimento de conduta e ética?' },
                    { key: 'pedidosDesligamento', label: 'Pedidos de desligamento?' },
                    { key: 'ausenciasNaoJustificadas', label: 'Ausências não justificadas?' },
                    { key: 'conflitosInternos', label: 'Conflitos internos?' },
                    { key: 'melhorias', label: 'Melhorias desde última auditoria?' },
                    { key: 'necessidadeReforco', label: 'Necessidade de reforço/contratação?' }
                  ].map(item => (
                    <div key={item.key}>
                      <label className="block text-gray-700 font-semibold mb-2">{item.label}</label>
                      <div className="flex space-x-4 mb-2">
                        <label className="flex items-center">
                          <input
                            type="radio"
                            name={item.key}
                            value="sim"
                            checked={formData[item.key] === 'sim'}
                            onChange={(e) => setFormData({...formData, [item.key]: e.target.value})}
                            className="mr-2"
                          />
                          Sim
                        </label>
                        <label className="flex items-center">
                          <input
                            type="radio"
                            name={item.key}
                            value="nao"
                            checked={formData[item.key] === 'nao'}
                            onChange={(e) => setFormData({...formData, [item.key]: e.target.value})}
                            className="mr-2"
                          />
                          Não
                        </label>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {/* Relatório do auditor */}
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  Relatório do Auditor (mínimo 100 caracteres)
                </label>
                <textarea
                  value={formData.relatorio || ''}
                  onChange={(e) => setFormData({...formData, relatorio: e.target.value})}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                  placeholder="Descreva detalhadamente os achados da auditoria..."
                  rows="6"
                />
                <p className="text-sm text-gray-600 mt-1">
                  {formData.relatorio?.length || 0} caracteres
                </p>
              </div>

              <div className="flex justify-end space-x-4">
                <button
                  onClick={saveAuditoria}
                  className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center space-x-2"
                >
                  <Save className="w-5 h-5" />
                  <span>Salvar Auditoria</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Auditoria</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div className="bg-gradient-to-br from-purple-500 to-purple-700 text-white p-8 rounded-xl cursor-pointer hover:from-purple-600 hover:to-purple-800 transition-all transform hover:scale-105"
               onClick={() => startNewAuditoria('staff')}>
            <div className="flex items-center justify-between mb-4">
              <Users className="w-12 h-12" />
              <ChevronDown className="w-6 h-6" />
            </div>
            <h3 className="text-2xl font-bold mb-2">Auditoria Staff</h3>
            <p className="text-purple-100">Auditoria detalhada das equipes</p>
          </div>

          <div className="bg-gradient-to-br from-indigo-500 to-indigo-700 text-white p-8 rounded-xl cursor-pointer hover:from-indigo-600 hover:to-indigo-800 transition-all transform hover:scale-105"
               onClick={() => startNewAuditoria('roleplay')}>
            <div className="flex items-center justify-between mb-4">
              <Shield className="w-12 h-12" />
              <ChevronDown className="w-6 h-6" />
            </div>
            <h3 className="text-2xl font-bold mb-2">Auditoria Roleplay</h3>
            <p className="text-indigo-100">Auditoria dos setores RP</p>
          </div>
        </div>

        {/* Lista de auditorias existentes */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4">Minhas Auditorias</h3>
          <div className="space-y-4">
            {auditorias
              .filter(a => a.autorId === currentUser.id)
              .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
              .map(auditoria => (
                <div key={auditoria.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                  <div>
                    <p className="font-semibold text-gray-800">
                      Auditoria {auditoria.tipo} - {auditoria.setor}
                    </p>
                    <p className="text-sm text-gray-600">
                      Criado em: {new Date(auditoria.createdAt).toLocaleDateString('pt-BR')}
                    </p>
                    <p className="text-sm text-gray-600">Turno: {auditoria.turno}</p>
                  </div>
                  <div className="flex items-center space-x-4">
                    <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                      auditoria.status === 'aprovada' ? 'bg-green-100 text-green-800' :
                      auditoria.status === 'aguardando_aprovacao' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-blue-100 text-blue-800'
                    }`}>
                      {auditoria.status.replace('_', ' ').toUpperCase()}
                    </span>
                    {auditoria.status === 'em_andamento' && (
                      <button
                        onClick={() => {
                          setCurrentAuditoria(auditoria);
                          setFormData(auditoria);
                        }}
                        className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
                      >
                        Continuar
                      </button>
                    )}
                  </div>
                </div>
              ))}
          </div>
        </div>
      </div>
    );
  };

  // Painel da Cidade
  const PainelCidade = () => {
    const checklistsAprovados = checklists.filter(c => c.status === 'aprovado');
    const auditoriasAprovadas = auditorias.filter(a => a.status === 'aprovada');
    
    const pontuacaoChecklist = Math.min(checklistsAprovados.length * 10, 50); // 10 pontos por checklist, máximo 50
    const pontuacaoAuditoria = Math.min(auditoriasAprovadas.length * 25, 100); // 25 pontos por auditoria, máximo 100
    const pontuacaoTotal = pontuacaoChecklist + pontuacaoAuditoria;
    
    const maxPontuacaoChecklist = 50;
    const maxPontuacaoAuditoria = 100;
    const maxPontuacaoTotal = 150;

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Painel Geral da Cidade</h2>
        
        <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
          <div className="text-center mb-8">
            <h3 className="text-2xl font-bold text-gray-800 mb-2">Ilusion RP</h3>
            <p className="text-gray-600">Pontuação Acumulada da Cidade</p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div className="text-center">
              <div className="bg-blue-100 p-6 rounded-xl mb-4">
                <CheckSquare className="w-12 h-12 text-blue-600 mx-auto mb-4" />
                <h4 className="text-lg font-bold text-gray-800 mb-2">Checklist</h4>
                <div className="text-3xl font-bold text-blue-600 mb-2">
                  {pontuacaoChecklist}/{maxPontuacaoChecklist}
                </div>
                <div className="w-full bg-gray-200 rounded-full h-3">
                  <div 
                    className="bg-blue-600 h-3 rounded-full transition-all duration-500"
                    style={{ width: `${(pontuacaoChecklist / maxPontuacaoChecklist) * 100}%` }}
                  ></div>
                </div>
                <p className="text-sm text-gray-600 mt-2">
                  {checklistsAprovados.length} checklists aprovados
                </p>
              </div>
            </div>

            <div className="text-center">
              <div className="bg-green-100 p-6 rounded-xl mb-4">
                <FileText className="w-12 h-12 text-green-600 mx-auto mb-4" />
                <h4 className="text-lg font-bold text-gray-800 mb-2">Auditoria</h4>
                <div className="text-3xl font-bold text-green-600 mb-2">
                  {pontuacaoAuditoria}/{maxPontuacaoAuditoria}
                </div>
                <div className="w-full bg-gray-200 rounded-full h-3">
                  <div 
                    className="bg-green-600 h-3 rounded-full transition-all duration-500"
                    style={{ width: `${(pontuacaoAuditoria / maxPontuacaoAuditoria) * 100}%` }}
                  ></div>
                </div>
                <p className="text-sm text-gray-600 mt-2">
                  {auditoriasAprovadas.length} auditorias aprovadas
                </p>
              </div>
            </div>

            <div className="text-center">
              <div className="bg-purple-100 p-6 rounded-xl mb-4">
                <BarChart3 className="w-12 h-12 text-purple-600 mx-auto mb-4" />
                <h4 className="text-lg font-bold text-gray-800 mb-2">Total</h4>
                <div className="text-3xl font-bold text-purple-600 mb-2">
                  {pontuacaoTotal}/{maxPontuacaoTotal}
                </div>
                <div className="w-full bg-gray-200 rounded-full h-3">
                  <div 
                    className="bg-purple-600 h-3 rounded-full transition-all duration-500"
                    style={{ width: `${(pontuacaoTotal / maxPontuacaoTotal) * 100}%` }}
                  ></div>
                </div>
                <p className="text-sm text-gray-600 mt-2">
                  Pontuação total acumulada
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* Estatísticas detalhadas */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Últimos Checklists Aprovados</h3>
            <div className="space-y-3">
              {checklistsAprovados.slice(-5).map(checklist => (
                <div key={checklist.id} className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                  <div>
                    <p className="font-semibold text-gray-800">
                      {checklist.tipo === 'staff' ? 'Staff' : 'RP'} - {checklist.equipe || checklist.setor}
                    </p>
                    <p className="text-sm text-gray-600">
                      {new Date(checklist.createdAt).toLocaleDateString('pt-BR')}
                    </p>
                  </div>
                  <span className="bg-green-500 text-white px-2 py-1 rounded text-sm font-semibold">
                    +10 pts
                  </span>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Últimas Auditorias Aprovadas</h3>
            <div className="space-y-3">
              {auditoriasAprovadas.slice(-5).map(auditoria => (
                <div key={auditoria.id} className="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                  <div>
                    <p className="font-semibold text-gray-800">
                      {auditoria.tipo} - {auditoria.setor}
                    </p>
                    <p className="text-sm text-gray-600">
                      {new Date(auditoria.createdAt).toLocaleDateString('pt-BR')}
                    </p>
                  </div>
                  <span className="bg-blue-500 text-white px-2 py-1 rounded text-sm font-semibold">
                    +25 pts
                  </span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Administração (para CEO e Diretor)
  const AdminPanel = () => {
    const approveUser = (userId) => {
      const user = pendingUsers.find(u => u.id === userId);
      if (user) {
        setUsers([...users, { ...user, status: 'aprovado' }]);
        setPendingUsers(pendingUsers.filter(u => u.id !== userId));
        alert('Usuário aprovado com sucesso!');
      }
    };

    const rejectUser = (userId) => {
      setPendingUsers(pendingUsers.filter(u => u.id !== userId));
      alert('Usuário rejeitado!');
    };

    const approveChecklist = (checklistId) => {
      setChecklists(checklists.map(c => 
        c.id === checklistId ? { ...c, status: 'aprovado', approvedBy: currentUser.id, approvedAt: new Date().toISOString() } : c
      ));
      alert('Checklist aprovado!');
    };

    const approveAuditoria = (auditoriaId) => {
      setAuditorias(auditorias.map(a => 
        a.id === auditoriaId ? { ...a, status: 'aprovada', approvedBy: currentUser.id, approvedAt: new Date().toISOString() } : a
      ));
      alert('Auditoria aprovada!');
    };

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Administração</h2>
        
        {/* Usuários pendentes */}
        {pendingUsers.length > 0 && (
          <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Usuários Pendentes de Aprovação</h3>
            <div className="space-y-4">
              {pendingUsers.map(user => (
                <div key={user.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                  <div>
                    <p className="font-semibold text-gray-800">{user.nome}</p>
                    <p className="text-sm text-gray-600">ID: {user.id} | Cargo: {user.cargo}</p>
                    <p className="text-xs text-gray-500">
                      Cadastrado em: {new Date(user.createdAt).toLocaleDateString('pt-BR')}
                    </p>
                  </div>
                  <div className="flex space-x-2">
                    <button
                      onClick={() => approveUser(user.id)}
                      className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                    >
                      <CheckCircle className="w-4 h-4" />
                      <span>Aprovar</span>
                    </button>
                    <button
                      onClick={() => rejectUser(user.id)}
                      className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                    >
                      <AlertCircle className="w-4 h-4" />
                      <span>Rejeitar</span>
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Checklists pendentes de aprovação */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Checklists para Aprovação</h3>
            <div className="space-y-4">
              {checklists
                .filter(c => c.status === 'aguardando_aprovacao')
                .map(checklist => (
                  <div key={checklist.id} className="p-4 border border-gray-200 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <p className="font-semibold text-gray-800">
                        {checklist.tipo === 'staff' ? 'Staff' : 'RP'} - {checklist.equipe || checklist.setor}
                      </p>
                      <span className="text-xs text-gray-500">
                        {new Date(checklist.createdAt).toLocaleDateString('pt-BR')}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-3">
                      Por: {users.find(u => u.id === checklist.autorId)?.nome}
                    </p>
                    <div className="flex space-x-2">
                      <button
                        onClick={() => approveChecklist(checklist.id)}
                        className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm"
                      >
                        Aprovar
                      </button>
                      <button className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                        Ver Detalhes
                      </button>
                    </div>
                  </div>
                ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Auditorias para Aprovação</h3>
            <div className="space-y-4">
              {auditorias
                .filter(a => a.status === 'aguardando_aprovacao')
                .map(auditoria => (
                  <div key={auditoria.id} className="p-4 border border-gray-200 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <p className="font-semibold text-gray-800">
                        {auditoria.tipo} - {auditoria.setor}
                      </p>
                      <span className="text-xs text-gray-500">
                        {new Date(auditoria.createdAt).toLocaleDateString('pt-BR')}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-3">
                      Por: {users.find(u => u.id === auditoria.autorId)?.nome}
                    </p>
                    <div className="flex space-x-2">
                      <button
                        onClick={() => approveAuditoria(auditoria.id)}
                        className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm"
                      >
                        Aprovar
                      </button>
                      <button className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                        Ver Detalhes
                      </button>
                    </div>
                  </div>
                ))}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Renderização principal
  if (!currentUser) {
    return <LoginForm />;
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <div className="flex">
        <Sidebar />
        <div className="flex-1">
          {currentView === 'dashboard' && <Dashboard />}
          {currentView === 'checklist' && <ChecklistComponent />}
          {currentView === 'auditoria' && <AuditoriaComponent />}
          {currentView === 'painel-cidade' && <PainelCidade />}
          {currentView === 'admin' && canApproveUsers(currentUser) && <AdminPanel />}
        </div>
      </div>
    </div>
  );
};

// Renderizar no DOM
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<MetaXAuditSystem />);
