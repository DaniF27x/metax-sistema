<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaX v5.0 - Sistema Auditor de FiveM</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: system-ui, -apple-system, sans-serif;
            background: #f8fafc;
        }
        #root { min-height: 100vh; }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">🚀 Carregando MetaX - Sistema Auditor Ilusion RP</div>
    </div>
    
    <script>
        console.log('🔥 Iniciando Sistema Auditoria MetaX...');
        
        // Aguardar carregamento completo do React
        setTimeout(() => {
            try {
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    throw new Error('React não carregado');
                }

                const { useState, useEffect, createElement: h } = React;
                
                // Hook personalizado para localStorage
                const useStoredState = (key, initialValue) => {
                    const [value, setValue] = useState(() => {
                        try {
                            const stored = localStorage.getItem('metax_' + key);
                            return stored ? JSON.parse(stored) : initialValue;
                        } catch {
                            return initialValue;
                        }
                    });

                    useEffect(() => {
                        try {
                            localStorage.setItem('metax_' + key, JSON.stringify(value));
                        } catch (e) {
                            console.warn('LocalStorage error:', e);
                        }
                    }, [key, value]);

                    return [value, setValue];
                };

                // Função para calcular duração formatada
                const calcularDuracaoFormatada = (diferencaMs) => {
                    const segundos = Math.floor(diferencaMs / 1000);
                    const minutos = Math.floor(segundos / 60);
                    const horas = Math.floor(minutos / 60);
                    const dias = Math.floor(horas / 24);
                    
                    if (dias > 0) {
                        const horasRestantes = horas % 24;
                        const minutosRestantes = minutos % 60;
                        return `${dias}d ${horasRestantes}h ${minutosRestantes}m`;
                    } else if (horas > 0) {
                        const minutosRestantes = minutos % 60;
                        return `${horas}h ${minutosRestantes}m`;
                    } else {
                        return `${minutos}m`;
                    }
                };

                // SISTEMA SIMPLIFICADO: Nota direta no final
                const validarNota = (nota, tipoFormulario) => {
                    const maxNota = tipoFormulario === 'checklist' ? 50 : 100;
                    const notaNum = parseFloat(nota);
                    
                    if (isNaN(notaNum) || notaNum < 0 || notaNum > maxNota) {
                        return { valida: false, erro: `Nota deve ser entre 0 e ${maxNota}` };
                    }
                    
                    return { valida: true, nota: notaNum };
                };

                // Componente principal do sistema
                const MetaXSystem = () => {
                    const [currentUser, setCurrentUser] = useStoredState('currentUser', null);
                    const [users, setUsers] = useStoredState('users', []);
                    const [pendingUsers, setPendingUsers] = useStoredState('pendingUsers', []);
                    const [checklists, setChecklists] = useStoredState('checklists', []);
                    const [auditorias, setAuditorias] = useStoredState('auditorias', []);
                    const [currentView, setCurrentView] = useStoredState('currentView', 'login');
                    // SISTEMA FINANCEIRO IMPLEMENTADO
                    const [solicitacoesFinanceiras, setSolicitacoesFinanceiras] = useStoredState('solicitacoesFinanceiras', []);

                    // Inicializar usuários padrão
                    useEffect(() => {
                        const defaultUsers = [
                            {
                                id: 'admin001',
                                nome: 'Admin Sistema',
                                senha: 'admin123',
                                cargo: 'CEO',
                                status: 'aprovado',
                                createdAt: new Date().toISOString()
                            },
                            {
                                id: '7',
                                nome: 'Daniel',
                                senha: '5609984',
                                cargo: 'Diretor',
                                status: 'aprovado',
                                createdAt: new Date().toISOString()
                            }
                        ];

                        if (users.length === 0) {
                            setUsers(defaultUsers);
                        }
                    }, []);

                    // Componente de Login
                    const LoginPage = () => {
                        const [formData, setFormData] = useState({ id: '', senha: '' });
                        const [isRegister, setIsRegister] = useState(false);
                        const [isResetPassword, setIsResetPassword] = useState(false);
                        const [registerData, setRegisterData] = useState({
                            nome: '', id: '', senha: '', cargo: 'Staff Geral'
                        });
                        const [resetData, setResetData] = useState({ id: '', novaSenha: '' });

                        const handleLogin = (e) => {
                            e.preventDefault();
                            
                            const user = users.find(u => 
                                String(u.id) === String(formData.id) && 
                                String(u.senha) === String(formData.senha) && 
                                u.status === 'aprovado'
                            );
                            
                            if (user) {
                                setCurrentUser(user);
                                setCurrentView('dashboard');
                                console.log('✅ Login realizado:', user.nome);
                            } else {
                                alert('❌ ID ou senha incorretos!');
                            }
                        };

                        const handleRegister = (e) => {
                            e.preventDefault();
                            
                            if (!registerData.nome || !registerData.id || !registerData.senha) {
                                alert('⚠️ Preencha todos os campos!');
                                return;
                            }

                            const userExists = [...users, ...pendingUsers].find(u => u.id === registerData.id);
                            if (userExists) {
                                alert('❌ ID já existe!');
                                return;
                            }

                            const newUser = {
                                ...registerData,
                                status: 'pendente',
                                createdAt: new Date().toISOString()
                            };

                            setPendingUsers([...pendingUsers, newUser]);
                            alert('✅ Cadastro enviado para aprovação!');
                            setIsRegister(false);
                            setRegisterData({ nome: '', id: '', senha: '', cargo: 'Staff Geral' });
                        };

                        const handlePasswordReset = (e) => {
                            e.preventDefault();
                            
                            if (!resetData.id || !resetData.novaSenha) {
                                alert('⚠️ Preencha todos os campos!');
                                return;
                            }

                            const userExists = users.find(u => u.id === resetData.id && u.status === 'aprovado');
                            if (!userExists) {
                                alert('❌ ID não encontrado ou usuário não aprovado!');
                                return;
                            }

                            // Simulação de reset de senha (atualizar diretamente)
                            setUsers(users.map(u => 
                                u.id === resetData.id ? { ...u, senha: resetData.novaSenha } : u
                            ));
                            
                            alert('✅ Senha alterada com sucesso!');
                            setIsResetPassword(false);
                            setResetData({ id: '', novaSenha: '' });
                        };

                        const inputStyle = {
                            width: '100%',
                            padding: '12px',
                            border: '1px solid rgba(255,255,255,0.3)',
                            borderRadius: '8px',
                            background: 'rgba(255,255,255,0.1)',
                            color: 'white',
                            fontSize: '16px'
                        };

                        const buttonStyle = {
                            width: '100%',
                            padding: '12px',
                            borderRadius: '8px',
                            border: 'none',
                            fontSize: '16px',
                            fontWeight: 'bold',
                            cursor: 'pointer',
                            marginBottom: '8px'
                        };

                        return h('div', {
                            style: {
                                minHeight: '100vh',
                                background: 'linear-gradient(135deg, #dc2626 0%, #ef4444 100%)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                padding: '20px'
                            }
                        },
                            h('div', {
                                style: {
                                    background: 'rgba(255,255,255,0.1)',
                                    backdropFilter: 'blur(10px)',
                                    borderRadius: '16px',
                                    padding: '40px',
                                    width: '100%',
                                    maxWidth: '400px',
                                    border: '1px solid rgba(255,255,255,0.2)'
                                }
                            },
                                // Header
                                h('div', { style: { textAlign: 'center', marginBottom: '30px' } },
                                    h('h1', { style: { color: 'white', fontSize: '2.5rem', marginBottom: '8px', fontWeight: 'bold' } }, '🔥 MetaX'),
                                    h('p', { style: { color: '#fca5a5', fontSize: '1.1rem' } }, 'Sistema Auditor - Ilusion RP')
                                ),

                                // Formulários
                                !isRegister && !isResetPassword ? (
                                    // Login Form
                                    h('form', { onSubmit: handleLogin },
                                        h('div', { style: { marginBottom: '20px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '8px', fontWeight: '500' } }, 'ID do Usuário'),
                                            h('input', {
                                                type: 'text',
                                                value: formData.id,
                                                onChange: (e) => setFormData({ ...formData, id: e.target.value }),
                                                placeholder: 'Digite seu ID',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '20px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '8px', fontWeight: '500' } }, 'Senha'),
                                            h('input', {
                                                type: 'password',
                                                value: formData.senha,
                                                onChange: (e) => setFormData({ ...formData, senha: e.target.value }),
                                                placeholder: 'Digite sua senha',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('button', {
                                            type: 'submit',
                                            style: { ...buttonStyle, background: '#dc2626', color: 'white' }
                                        }, 'Entrar'),
                                        h('button', {
                                            type: 'button',
                                            onClick: () => setIsRegister(true),
                                            style: { ...buttonStyle, background: 'transparent', color: 'white', border: '1px solid rgba(255,255,255,0.3)' }
                                        }, 'Criar Conta'),
                                        h('button', {
                                            type: 'button',
                                            onClick: () => setIsResetPassword(true),
                                            style: { ...buttonStyle, background: 'transparent', color: 'white', border: '1px solid rgba(255,255,255,0.3)', marginTop: '8px' }
                                        }, '🔐 Esqueci minha Senha')
                                    )
                                ) : isRegister ? (
                                    // Register Form
                                    h('form', { onSubmit: handleRegister },
                                        h('div', { style: { marginBottom: '16px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '6px', fontWeight: '500' } }, 'Nome Completo'),
                                            h('input', {
                                                type: 'text',
                                                value: registerData.nome,
                                                onChange: (e) => setRegisterData({ ...registerData, nome: e.target.value }),
                                                placeholder: 'Seu nome completo',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '16px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '6px', fontWeight: '500' } }, 'ID'),
                                            h('input', {
                                                type: 'text',
                                                value: registerData.id,
                                                onChange: (e) => setRegisterData({ ...registerData, id: e.target.value }),
                                                placeholder: 'Escolha um ID único',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '16px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '6px', fontWeight: '500' } }, 'Senha'),
                                            h('input', {
                                                type: 'password',
                                                value: registerData.senha,
                                                onChange: (e) => setRegisterData({ ...registerData, senha: e.target.value }),
                                                placeholder: 'Crie uma senha',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '20px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '6px', fontWeight: '500' } }, 'Cargo'),
                                            h('select', {
                                                value: registerData.cargo,
                                                onChange: (e) => setRegisterData({ ...registerData, cargo: e.target.value }),
                                                style: { ...inputStyle, color: 'black' },
                                                required: true
                                            },
                                                ['CEO', 'Diretor', 'Alta Cúpula', 'ADM Staff', 'RESP Comunidade', 'Mentoria', 'Staff Geral'].map(cargo =>
                                                    h('option', { key: cargo, value: cargo }, cargo)
                                                )
                                            )
                                        ),
                                        h('button', {
                                            type: 'submit',
                                            style: { ...buttonStyle, background: '#10b981', color: 'white' }
                                        }, 'Cadastrar'),
                                        h('button', {
                                            type: 'button',
                                            onClick: () => setIsRegister(false),
                                            style: { ...buttonStyle, background: 'transparent', color: 'white', border: '1px solid rgba(255,255,255,0.3)' }
                                        }, 'Voltar ao Login')
                                    )
                                ) : (
                                    // Reset Password Form
                                    h('form', { onSubmit: handlePasswordReset },
                                        h('div', { style: { marginBottom: '16px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '6px', fontWeight: '500' } }, 'ID do Usuário'),
                                            h('input', {
                                                type: 'text',
                                                value: resetData.id,
                                                onChange: (e) => setResetData({ ...resetData, id: e.target.value }),
                                                placeholder: 'Digite seu ID',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('div', { style: { marginBottom: '20px' } },
                                            h('label', { style: { display: 'block', color: 'rgba(255,255,255,0.9)', marginBottom: '6px', fontWeight: '500' } }, 'Nova Senha'),
                                            h('input', {
                                                type: 'password',
                                                value: resetData.novaSenha,
                                                onChange: (e) => setResetData({ ...resetData, novaSenha: e.target.value }),
                                                placeholder: 'Digite a nova senha',
                                                style: inputStyle,
                                                required: true
                                            })
                                        ),
                                        h('button', {
                                            type: 'submit',
                                            style: { ...buttonStyle, background: '#f59e0b', color: 'white' }
                                        }, '🔐 Solicitar Reset'),
                                        h('button', {
                                            type: 'button',
                                            onClick: () => setIsResetPassword(false),
                                            style: { ...buttonStyle, background: 'transparent', color: 'white', border: '1px solid rgba(255,255,255,0.3)' }
                                        }, 'Voltar ao Login')
                                    )
                                )
                            )
                        );
                    };

                    // Header do sistema
                    const Header = () => h('header', {
                        style: {
                            background: 'white',
                            borderBottom: '4px solid #dc2626',
                            boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                        }
                    },
                        h('div', {
                            style: {
                                maxWidth: '1200px',
                                margin: '0 auto',
                                padding: '16px 20px',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center'
                            }
                        },
                            h('div', null,
                                h('h1', { style: { fontSize: '1.8rem', fontWeight: 'bold', color: '#1f2937', margin: 0 } }, '🔥 MetaX - Ilusion RP'),
                                h('p', { style: { fontSize: '0.9rem', color: '#dc2626', margin: '4px 0 0 0', fontWeight: '600' } }, 'Sistema Auditoria & Financeiro')
                            ),
                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '16px' } },
                                h('div', { style: { textAlign: 'right' } },
                                    h('p', { style: { fontWeight: '600', color: '#1f2937', margin: 0, fontSize: '1rem' } }, currentUser?.nome || 'Usuário'),
                                    h('p', { style: { fontSize: '0.8rem', color: '#6b7280', margin: 0 } }, `${currentUser?.cargo} | ID: ${currentUser?.id}`)
                                ),
                                h('button', {
                                    onClick: () => {
                                        setCurrentUser(null);
                                        setCurrentView('login');
                                    },
                                    style: {
                                        background: '#ef4444',
                                        color: 'white',
                                        padding: '8px 16px',
                                        border: 'none',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontWeight: '500'
                                    }
                                }, 'Sair')
                            )
                        )
                    );

                    // Navegação lateral
                    const Sidebar = () => h('nav', {
                        style: {
                            background: '#1f2937',
                            color: 'white',
                            width: '250px',
                            minHeight: 'calc(100vh - 80px)',
                            padding: '20px 0'
                        }
                    },
                        h('div', { style: { padding: '0 20px' } },
                            [
                                { id: 'dashboard', label: '📊 Dashboard', icon: '📊' },
                                { id: 'checklist', label: '✅ Checklist', icon: '✅' },
                                { id: 'auditoria', label: '🔍 Auditoria', icon: '🔍' },
                                { id: 'painel', label: '🏙️ Painel da Cidade', icon: '🏙️' },
                                { id: 'financeiro', label: '💸 Painel Financeiro', icon: '💸' },
                                ...(currentUser?.cargo === 'CEO' || currentUser?.cargo === 'Diretor' 
                                    ? [{ id: 'admin', label: '⚙️ Administração', icon: '⚙️' }] 
                                    : [])
                            ].map(item =>
                                h('button', {
                                    key: item.id,
                                    onClick: () => setCurrentView(item.id),
                                    style: {
                                        width: '100%',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '12px',
                                        padding: '12px 16px',
                                        background: currentView === item.id ? '#dc2626' : 'transparent',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        marginBottom: '8px',
                                        fontSize: '1rem',
                                        textAlign: 'left'
                                    }
                                }, item.label)
                            )
                        )
                    );

                    // Dashboard
                    const DashboardPage = () => {
                        // Calcular métricas avançadas
                        const meusChecklists = checklists.filter(c => c.autorId === currentUser?.id);
                        const minhasAuditorias = auditorias.filter(a => a.autorId === currentUser?.id);
                        const meusPendentes = [...checklists, ...auditorias].filter(item => 
                            item.status === 'aguardando_aprovacao' && item.autorId === currentUser?.id
                        );
                        
                        const meusAprovados = [...checklists, ...auditorias].filter(item => 
                            (item.status === 'aprovado' || item.status === 'aprovada') && item.autorId === currentUser?.id
                        );
                        
                        const totalItens = meusChecklists.length + minhasAuditorias.length;
                        const taxaAprovacao = totalItens > 0 ? Math.round((meusAprovados.length / totalItens) * 100) : 0;
                        
                        // Atividade das últimas 24h
                        const agora = new Date();
                        const ha24h = new Date(agora.getTime() - 24 * 60 * 60 * 1000);
                        const atividadeRecente = [...checklists, ...auditorias].filter(item => 
                            item.autorId === currentUser?.id && new Date(item.createdAt) > ha24h
                        );
                        
                        // Próximas ações necessárias
                        const itensEmAndamento = [...checklists, ...auditorias].filter(item => 
                            item.autorId === currentUser?.id && (item.status === 'em_andamento' || item.status === 'rascunho')
                        );
                        
                        return h('div', { style: { minHeight: '100vh', background: '#f8fafc' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '32px' } }, 
                                        `🎯 Dashboard - ${currentUser?.nome}`
                                    ),
                                    
                                    // Cards de estatísticas principais
                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '24px', marginBottom: '32px' } },
                                        h('div', { style: { background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: 'white', padding: '28px', borderRadius: '16px', position: 'relative', overflow: 'hidden' } },
                                            h('div', { style: { position: 'absolute', top: '-20px', right: '-20px', fontSize: '8rem', opacity: 0.1 } }, '✅'),
                                            h('div', { style: { fontSize: '3.5rem', marginBottom: '12px' } }, '✅'),
                                            h('h3', { style: { fontSize: '1.3rem', marginBottom: '8px', opacity: 0.95, fontWeight: '600' } }, 'Meus Checklists'),
                                            h('p', { style: { fontSize: '3rem', fontWeight: 'bold', margin: '0 0 8px 0' } }, meusChecklists.length),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '0.9rem' } }, 
                                                    `${meusChecklists.filter(c => c.status === 'aprovado').length} aprovados • ${meusChecklists.filter(c => c.status === 'aguardando_aprovacao').length} pendentes`
                                                )
                                            )
                                        ),
                                        h('div', { style: { background: 'linear-gradient(135deg, #10b981, #059669)', color: 'white', padding: '28px', borderRadius: '16px', position: 'relative', overflow: 'hidden' } },
                                            h('div', { style: { position: 'absolute', top: '-20px', right: '-20px', fontSize: '8rem', opacity: 0.1 } }, '🔍'),
                                            h('div', { style: { fontSize: '3.5rem', marginBottom: '12px' } }, '🔍'),
                                            h('h3', { style: { fontSize: '1.3rem', marginBottom: '8px', opacity: 0.95, fontWeight: '600' } }, 'Minhas Auditorias'),
                                            h('p', { style: { fontSize: '3rem', fontWeight: 'bold', margin: '0 0 8px 0' } }, minhasAuditorias.length),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '0.9rem' } }, 
                                                    `${minhasAuditorias.filter(a => a.status === 'aprovada').length} aprovadas • ${minhasAuditorias.filter(a => a.status === 'aguardando_aprovacao').length} pendentes`
                                                )
                                            )
                                        ),
                                        h('div', { style: { background: 'linear-gradient(135deg, #f59e0b, #d97706)', color: 'white', padding: '28px', borderRadius: '16px', position: 'relative', overflow: 'hidden' } },
                                            h('div', { style: { position: 'absolute', top: '-20px', right: '-20px', fontSize: '8rem', opacity: 0.1 } }, '⏳'),
                                            h('div', { style: { fontSize: '3.5rem', marginBottom: '12px' } }, '⏳'),
                                            h('h3', { style: { fontSize: '1.3rem', marginBottom: '8px', opacity: 0.95, fontWeight: '600' } }, 'Aguardando Aprovação'),
                                            h('p', { style: { fontSize: '3rem', fontWeight: 'bold', margin: '0 0 8px 0' } }, meusPendentes.length),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '0.9rem' } }, 
                                                    meusPendentes.length > 0 ? 'Aguarde a revisão' : 'Tudo aprovado! 🎉'
                                                )
                                            )
                                        ),
                                        h('div', { style: { background: 'linear-gradient(135deg, #8b5cf6, #7c3aed)', color: 'white', padding: '28px', borderRadius: '16px', position: 'relative', overflow: 'hidden' } },
                                            h('div', { style: { position: 'absolute', top: '-20px', right: '-20px', fontSize: '8rem', opacity: 0.1 } }, '📊'),
                                            h('div', { style: { fontSize: '3.5rem', marginBottom: '12px' } }, '📊'),
                                            h('h3', { style: { fontSize: '1.3rem', marginBottom: '8px', opacity: 0.95, fontWeight: '600' } }, 'Taxa de Aprovação'),
                                            h('p', { style: { fontSize: '3rem', fontWeight: 'bold', margin: '0 0 8px 0' } }, `${taxaAprovacao}%`),
                                            h('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', opacity: 0.9 } },
                                                h('span', { style: { fontSize: '0.9rem' } }, 
                                                    `${meusAprovados.length} de ${totalItens} aprovados`
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página de Checklist
                    const ChecklistPage = () => {
                        const [currentChecklistState, setCurrentChecklistState] = useState(null);
                        const [checklistFormState, setChecklistFormState] = useState({});

                        const startNewChecklist = (tipo) => {
                            const newChecklist = {
                                id: Date.now(),
                                tipo,
                                autorId: currentUser.id,
                                status: 'em_andamento',
                                createdAt: new Date().toISOString(),
                                confirmacoesPainel: { manha: '', tarde: '', noite: '' }
                            };
                            setCurrentChecklistState(newChecklist);
                            setChecklistFormState({});
                        };

                        const saveChecklistData = () => {
                            if (!checklistFormState.equipe && !checklistFormState.setor) {
                                alert('⚠️ Selecione uma equipe ou setor!');
                                return;
                            }

                            // Validar nota final
                            if (!checklistFormState.notaFinal) {
                                alert('⚠️ Digite a nota final do checklist (0 a 50)!');
                                return;
                            }

                            const validacao = validarNota(checklistFormState.notaFinal, 'checklist');
                            if (!validacao.valida) {
                                alert(`⚠️ ${validacao.erro}!`);
                                return;
                            }

                            const updatedChecklist = {
                                ...currentChecklistState,
                                ...checklistFormState,
                                notaFinal: validacao.nota,
                                updatedAt: new Date().toISOString()
                            };

                            // Verificar confirmações de painel
                            const confirmacoesCompletas = Object.values(updatedChecklist.confirmacoesPainel).every(val => val !== '' && val !== null);
                            
                            if (confirmacoesCompletas && validacao.valida) {
                                updatedChecklist.status = 'aguardando_aprovacao';
                                alert(`✅ Checklist enviado para aprovação!\n📊 Nota final: ${validacao.nota}/50 pontos`);
                            } else {
                                alert('💾 Checklist salvo como rascunho! Complete tudo para envio.');
                            }

                            const existingIndex = checklists.findIndex(c => c.id === currentChecklistState.id);
                            if (existingIndex >= 0) {
                                setChecklists(checklists.map(c => c.id === currentChecklistState.id ? updatedChecklist : c));
                            } else {
                                setChecklists([...checklists, updatedChecklist]);
                            }

                            setCurrentChecklistState(null);
                            setChecklistFormState({});
                        };

                        // Se está editando um checklist específico, mostrar formulário
                        if (currentChecklistState) {
                        return h('div', { style: { minHeight: '100vh', background: '#f8fafc' } },
                                h(Header),
                                h('div', { style: { display: 'flex' } },
                                    h(Sidebar),
                                    h('main', { style: { flex: 1, padding: '40px', maxWidth: '1400px', margin: '0 auto' } },
                                        h('div', { style: { background: 'white', borderRadius: '16px', padding: '32px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)' } },
                                            h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '32px' } },
                                                h('h2', { style: { fontSize: '2.4rem', fontWeight: 'bold', color: '#1f2937', margin: 0 } }, 
                                                    currentChecklistState.tipo === 'staff' ? '✅ CHECKLIST STAFF' : '🎭 CHECKLIST ROLEPLAY'
                                                ),
                                                h('button', {
                                                    onClick: () => setCurrentChecklistState(null),
                                                    style: {
                                                        background: '#6b7280',
                                                        color: 'white',
                                                        padding: '12px 24px',
                                                        border: 'none',
                                                        borderRadius: '8px',
                                                        cursor: 'pointer',
                                                        fontWeight: '600'
                                                    }
                                                }, '❌ Cancelar')
                                            ),
                                            
                                            h('div', { style: { display: 'grid', gap: '32px' } },
                                                // Seção básica
                                                h('div', { style: { background: 'linear-gradient(135deg, #3b82f6, #1e40af)', padding: '32px', borderRadius: '16px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '24px' } }, '📋 DADOS BÁSICOS'),
                                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '24px' } },
                                                        h('div', null,
                                                            h('label', { style: { display: 'block', fontWeight: '700', color: 'white', marginBottom: '8px' } }, 
                                                                currentChecklistState.tipo === 'staff' ? '🏢 Equipe Staff' : '🏛️ Setor RP'
                                                            ),
                                                            h('select', {
                                                                value: checklistFormState[currentChecklistState.tipo === 'staff' ? 'equipe' : 'setor'] || '',
                                                                onChange: (e) => setChecklistFormState({
                                                                    ...checklistFormState,
                                                                    [currentChecklistState.tipo === 'staff' ? 'equipe' : 'setor']: e.target.value
                                                                }),
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '14px',
                                                                    border: '2px solid white',
                                                                    borderRadius: '8px',
                                                                    fontSize: '1rem',
                                                                    background: 'white',
                                                                    color: '#1f2937',
                                                                    fontWeight: '500'
                                                                }
                                                            },
                                                                h('option', { value: '' }, 'Selecione...'),
                                                                (currentChecklistState.tipo === 'staff' 
                                                                    ? ['Alta Cúpula', 'ADM Staff', 'RESP Comunidade', 'Mentoria', 'Equipe Legal', 'Social Media', 'Comercial', 'Ticketing', 'Eventos']
                                                                    : ['Jurídico', 'Prefeitura', 'Igreja', 'Jornal', 'Hospital', 'Bombeiros', 'Mecânica', 'Empresários', 'Facção', 'Máfia', 'Polícia']
                                                                ).map(item => h('option', { key: item, value: item }, item))
                                                            )
                                                        ),
                                                        // Subsetor para polícia no checklist
                                                        checklistFormState.setor === 'Polícia' && h('div', null,
                                                            h('label', { style: { display: 'block', fontWeight: '700', color: 'white', marginBottom: '8px' } }, '🚔 Subsetor da Polícia'),
                                                            h('select', {
                                                                value: checklistFormState.subsetor || '',
                                                                onChange: (e) => setChecklistFormState({...checklistFormState, subsetor: e.target.value}),
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '14px',
                                                                    border: '2px solid white',
                                                                    borderRadius: '8px',
                                                                    fontSize: '1rem',
                                                                    background: 'white',
                                                                    color: '#1f2937',
                                                                    fontWeight: '500'
                                                                }
                                                            },
                                                                h('option', { value: '' }, 'Selecione o subsetor...'),
                                                                ['PRF', 'Federal', 'Civil', 'Militar', 'Prisão', 'BOPE', 'MPF', 'Segurança Jurídica'].map(sub => 
                                                                    h('option', { key: sub, value: sub }, sub)
                                                                )
                                                            )
                                                        )
                                                    )
                                                ),
                                                
                                                // Perguntas do Checklist COMPLETAS RESTAURADAS
                                                h('div', { style: { background: 'linear-gradient(135deg, #10b981, #059669)', padding: '32px', borderRadius: '16px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '24px' } }, 
                                                        `📋 SISTEMA COMPLETO DE PERGUNTAS ${currentChecklistState.tipo === 'staff' ? 'STAFF' : 'ROLEPLAY'}`
                                                    ),
                                                    h('p', { style: { fontSize: '1rem', marginBottom: '24px', opacity: 0.9 } }, '✅ TODAS AS PERGUNTAS RESTAURADAS - Responda SIM/NÃO'),
                                                    h('div', { style: { display: 'grid', gap: '16px' } },
                                                        (() => {
                                                            let perguntasChecklist = [];
                                                            
                                                            if (currentChecklistState.tipo === 'staff') {
                                                                perguntasChecklist = [
                                                                    'A equipe possui organização adequada no Discord?',
                                                                    'Os membros estão ativos e participativos nas atividades?',
                                                                    'As responsabilidades são bem distribuídas entre membros?',
                                                                    'Há comunicação eficiente dentro da equipe?',
                                                                    'Os prazos de tarefas são cumpridos adequadamente?',
                                                                    'A liderança está presente e atuante?',
                                                                    'Há colaboração efetiva entre diferentes setores?',
                                                                    'As metas estabelecidas estão sendo alcançadas?',
                                                                    'A qualidade do trabalho está satisfatória?',
                                                                    'Há proatividade na resolução de problemas?'
                                                                ];
                                                            } else {
                                                                // Perguntas baseadas no setor RP específico - COMPLETAS
                                                                if (checklistFormState.setor === 'Polícia') {
                                                                    perguntasChecklist = [
                                                                        'Os policiais estão seguindo os protocolos estabelecidos?',
                                                                        'As abordagens estão sendo feitas de forma realista?',
                                                                        'Há cooperação efetiva entre os subsetores policiais?',
                                                                        'Os equipamentos estão sendo utilizados adequadamente?',
                                                                        'O RP policial está sendo executado corretamente?',
                                                                        'As prisões são justificadas e bem documentadas?',
                                                                        'Há respeito aos direitos dos cidadãos?',
                                                                        'O comportamento policial está adequado ao cargo?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Hospital') {
                                                                    perguntasChecklist = [
                                                                        'Os atendimentos médicos são realizados de forma realista?',
                                                                        'Os preços dos tratamentos estão adequados?',
                                                                        'Há profissionais médicos suficientes para a demanda?',
                                                                        'O RP médico está sendo bem executado?',
                                                                        'Os protocolos hospitalares são seguidos?',
                                                                        'Há disponibilidade de medicamentos necessários?',
                                                                        'O atendimento de emergência é eficiente?',
                                                                        'A estrutura hospitalar está funcionando?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Mecânica') {
                                                                    perguntasChecklist = [
                                                                        'Os reparos são realizados de forma realista?',
                                                                        'Os preços dos serviços estão adequados ao mercado?',
                                                                        'Há mecânicos disponíveis nos horários necessários?',
                                                                        'O RP de conserto está sendo bem executado?',
                                                                        'Os materiais necessários estão disponíveis?',
                                                                        'O tempo de reparo é razoável?',
                                                                        'Há variedade de serviços oferecidos?',
                                                                        'O atendimento ao cliente é satisfatório?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Jurídico') {
                                                                    perguntasChecklist = [
                                                                        'Os processos judiciais são conduzidos adequadamente?',
                                                                        'Os advogados conhecem as leis da cidade?',
                                                                        'As audiências são realizadas de forma realista?',
                                                                        'Há juízes disponíveis quando necessário?',
                                                                        'O sistema jurídico funciona eficientemente?',
                                                                        'Os direitos dos cidadãos são respeitados?',
                                                                        'Há transparência nos processos?',
                                                                        'A justiça é aplicada de forma imparcial?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Prefeitura') {
                                                                    perguntasChecklist = [
                                                                        'As decisões administrativas são bem fundamentadas?',
                                                                        'Há transparência nas ações da prefeitura?',
                                                                        'Os serviços públicos funcionam adequadamente?',
                                                                        'O prefeito está ativo e presente?',
                                                                        'As políticas públicas beneficiam a cidade?',
                                                                        'Há participação popular nas decisões?',
                                                                        'Os recursos públicos são bem utilizados?',
                                                                        'A comunicação com a população é eficiente?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Empresários') {
                                                                    perguntasChecklist = [
                                                                        'Os negócios estão sendo conduzidos de forma realista?',
                                                                        'Há variedade de empresas funcionando na cidade?',
                                                                        'Os preços praticados são justos e equilibrados?',
                                                                        'As empresas geram empregos para a população?',
                                                                        'Há inovação no setor empresarial?',
                                                                        'A concorrência é saudável entre empresas?',
                                                                        'Os produtos/serviços atendem a demanda?',
                                                                        'Há responsabilidade social empresarial?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Facção') {
                                                                    perguntasChecklist = [
                                                                        'As atividades criminosas são conduzidas de forma realista?',
                                                                        'Há organização hierárquica bem definida?',
                                                                        'Os confrontos são bem executados e têm motivo?',
                                                                        'As guerras entre facções têm justificativas válidas?',
                                                                        'O RP criminal está adequado ao servidor?',
                                                                        'Há respeito aos limites estabelecidos?',
                                                                        'As atividades não prejudicam novatos?',
                                                                        'Existe código de conduta interno respeitado?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Máfia') {
                                                                    perguntasChecklist = [
                                                                        'As operações mafiosas são sofisticadas e realistas?',
                                                                        'Há discrição nas atividades ilegais?',
                                                                        'A hierarquia mafiosa é respeitada?',
                                                                        'Os negócios de fachada funcionam adequadamente?',
                                                                        'O RP mafioso está sendo bem interpretado?',
                                                                        'Há código de honra respeitado?',
                                                                        'As atividades são bem planejadas?',
                                                                        'Existe controle territorial estabelecido?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Igreja') {
                                                                    perguntasChecklist = [
                                                                        'Os cultos são realizados regularmente?',
                                                                        'Há participação ativa da comunidade?',
                                                                        'O RP religioso está sendo bem executado?',
                                                                        'A igreja oferece apoio à comunidade?',
                                                                        'Há respeito às diferentes crenças?',
                                                                        'As atividades beneficentes funcionam?',
                                                                        'O espaço é bem utilizado para eventos?',
                                                                        'Há orientação espiritual disponível?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Jornal') {
                                                                    perguntasChecklist = [
                                                                        'As notícias são publicadas regularmente?',
                                                                        'O conteúdo jornalístico é de qualidade?',
                                                                        'Há imparcialidade nas reportagens?',
                                                                        'O jornal cobre eventos importantes da cidade?',
                                                                        'A equipe jornalística está ativa?',
                                                                        'Há variedade nos tipos de conteúdo?',
                                                                        'As informações são verificadas antes da publicação?',
                                                                        'Existe interação com a comunidade?'
                                                                    ];
                                                                } else if (checklistFormState.setor === 'Bombeiros') {
                                                                    perguntasChecklist = [
                                                                        'Os resgates são executados de forma adequada?',
                                                                        'Há bombeiros suficientes para atender a demanda?',
                                                                        'Os equipamentos estão funcionando corretamente?',
                                                                        'O tempo de resposta às emergências é adequado?',
                                                                        'O RP de emergência está realista?',
                                                                        'Há treinamento adequado da equipe?',
                                                                        'As operações de combate a incêndio são eficientes?',
                                                                        'Existe prevenção e educação sobre segurança?'
                                                                    ];
                                                                } else {
                                                                    // Perguntas gerais para outros setores RP
                                                                    perguntasChecklist = [
                                                                        'O setor está funcionando de forma adequada?',
                                                                        'Os membros estão ativos e engajados?',
                                                                        'Há qualidade no roleplay executado?',
                                                                        'As responsabilidades são bem cumpridas?',
                                                                        'O setor contribui positivamente para a cidade?',
                                                                        'Há organização interna eficiente?',
                                                                        'Os serviços oferecidos atendem a demanda?',
                                                                        'Existe cooperação com outros setores?'
                                                                    ];
                                                                }
                                                            }

                                                            return perguntasChecklist.map((pergunta, index) => 
                                                                h('div', { key: `checklist_${index}`, style: { background: 'rgba(255,255,255,0.1)', padding: '16px', borderRadius: '8px' } },
                                                                    h('p', { style: { fontSize: '1rem', marginBottom: '12px', fontWeight: '600' } }, `${index + 1}. ${pergunta}`),
                                                                    h('div', { style: { display: 'flex', gap: '16px' } },
                                                                        h('label', { style: { display: 'flex', alignItems: 'center', gap: '6px', cursor: 'pointer' } },
                                                                            h('input', {
                                                                                type: 'radio',
                                                                                name: `checklist_pergunta_${index}`,
                                                                                value: 'sim',
                                                                                checked: checklistFormState[`checklist_pergunta_${index}`] === 'sim',
                                                                                onChange: (e) => setChecklistFormState({
                                                                                    ...checklistFormState,
                                                                                    [`checklist_pergunta_${index}`]: e.target.value
                                                                                }),
                                                                                style: { marginRight: '4px' }
                                                                            }),
                                                                            '✅ SIM'
                                                                        ),
                                                                        h('label', { style: { display: 'flex', alignItems: 'center', gap: '6px', cursor: 'pointer' } },
                                                                            h('input', {
                                                                                type: 'radio',
                                                                                name: `checklist_pergunta_${index}`,
                                                                                value: 'nao',
                                                                                checked: checklistFormState[`checklist_pergunta_${index}`] === 'nao',
                                                                                onChange: (e) => setChecklistFormState({
                                                                                    ...checklistFormState,
                                                                                    [`checklist_pergunta_${index}`]: e.target.value
                                                                                }),
                                                                                style: { marginRight: '4px' }
                                                                            }),
                                                                            '❌ NÃO'
                                                                        )
                                                                    )
                                                                )
                                                            );
                                                        })()
                                                    )
                                                ),

                                                // Confirmações de painel
                                                h('div', { style: { background: 'linear-gradient(135deg, #dc2626, #b91c1c)', padding: '32px', borderRadius: '16px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '24px' } }, '📊 PAINEL ONLINE (OBRIGATÓRIO)'),
                                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '24px' } },
                                                        ['manha', 'tarde', 'noite'].map(turno => {
                                                            const labels = { manha: '🌅 Manhã', tarde: '☀️ Tarde', noite: '🌙 Noite' };
                                                            const isCompleted = currentChecklistState.confirmacoesPainel[turno] !== '';
                                                            return h('div', { key: turno },
                                                                h('label', { style: { display: 'block', fontWeight: '700', color: 'white', marginBottom: '8px' } }, labels[turno]),
                                                                h('input', {
                                                                    type: 'number',
                                                                    min: '0',
                                                                    value: currentChecklistState.confirmacoesPainel[turno] || '',
                                                                    onChange: (e) => {
                                                                        setCurrentChecklistState({
                                                                            ...currentChecklistState,
                                                                            confirmacoesPainel: {
                                                                                ...currentChecklistState.confirmacoesPainel,
                                                                                [turno]: e.target.value
                                                                            }
                                                                        });
                                                                    },
                                                                    style: {
                                                                        width: '100%',
                                                                        padding: '14px',
                                                                        border: `2px solid ${isCompleted ? '#10b981' : 'white'}`,
                                                                        borderRadius: '8px',
                                                                        fontSize: '1rem',
                                                                        background: isCompleted ? '#f0fdf4' : 'white',
                                                                        color: '#1f2937',
                                                                        fontWeight: '500',
                                                                        textAlign: 'center'
                                                                    },
                                                                    placeholder: '0'
                                                                })
                                                            );
                                                        })
                                                    )
                                                ),

                                                // SEÇÃO DE NOTA FINAL
                                                h('div', { style: { background: 'linear-gradient(135deg, #7c3aed, #5b21b6)', padding: '32px', borderRadius: '16px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '20px', textAlign: 'center' } }, '📊 NOTA FINAL DO CHECKLIST'),
                                                    h('div', { style: { maxWidth: '400px', margin: '0 auto' } },
                                                        h('p', { style: { fontSize: '1.1rem', marginBottom: '16px', textAlign: 'center', opacity: 0.9 } }, 
                                                            '⭐ Dê uma nota de 0 a 50 para este checklist baseado na sua análise geral'
                                                        ),
                                                        h('input', {
                                                            type: 'number',
                                                            min: '0',
                                                            max: '50',
                                                            step: '0.1',
                                                            value: checklistFormState.notaFinal || '',
                                                            onChange: (e) => setChecklistFormState({...checklistFormState, notaFinal: e.target.value}),
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                border: '3px solid white',
                                                                borderRadius: '12px',
                                                                fontSize: '1.5rem',
                                                                background: 'white',
                                                                color: '#1f2937',
                                                                fontWeight: '700',
                                                                textAlign: 'center'
                                                            },
                                                            placeholder: 'Ex: 42.5'
                                                        })
                                                    )
                                                ),

                                                // Botões de ação
                                                h('div', { style: { display: 'flex', justifyContent: 'center', gap: '24px', padding: '32px' } },
                                                    h('button', {
                                                        onClick: saveChecklistData,
                                                        style: {
                                                            background: (Object.values(currentChecklistState.confirmacoesPainel).every(val => val !== '') && checklistFormState.notaFinal) ? '#16a34a' : '#f59e0b',
                                                            color: 'white',
                                                            padding: '18px 40px',
                                                            border: 'none',
                                                            borderRadius: '12px',
                                                            cursor: 'pointer',
                                                            fontWeight: '700',
                                                            fontSize: '1.2rem'
                                                        }
                                                    },
                                                        (Object.values(currentChecklistState.confirmacoesPainel).every(val => val !== '') && checklistFormState.notaFinal) ?
                                                            '📤 ENVIAR PARA APROVAÇÃO' : '✅ PREENCHA TUDO'
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            );
                        }

                        return h('div', { style: { minHeight: '100vh', background: '#f8fafc' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '32px' } }, '✅ Checklist'),
                                    
                                    // Cards para criar novos checklists
                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '24px', marginBottom: '40px' } },
                                        h('div', {
                                            onClick: () => startNewChecklist('staff'),
                                            style: {
                                                background: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',
                                                color: 'white',
                                                padding: '32px',
                                                borderRadius: '16px',
                                                cursor: 'pointer',
                                                textAlign: 'center'
                                            }
                                        },
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '👥'),
                                            h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '8px' } }, 'Checklist Staff'),
                                            h('p', { style: { opacity: 0.9, fontSize: '1.1rem' } }, 'Auditoria das equipes Discord - 50 pontos')
                                        ),
                                        h('div', {
                                            onClick: () => startNewChecklist('rp'),
                                            style: {
                                                background: 'linear-gradient(135deg, #10b981, #059669)',
                                                color: 'white',
                                                padding: '32px',
                                                borderRadius: '16px',
                                                cursor: 'pointer',
                                                textAlign: 'center'
                                            }
                                        },
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '🎭'),
                                            h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '8px' } }, 'Checklist Roleplay'),
                                            h('p', { style: { opacity: 0.9, fontSize: '1.1rem' } }, 'Auditoria dos setores RP - 50 pontos')
                                        )
                                    ),

                                    // Lista de checklists existentes
                                    h('div', { style: { background: 'white', borderRadius: '16px', padding: '32px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)' } },
                                        h('h3', { style: { fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '24px' } }, 'Meus Checklists'),
                                        checklists.filter(c => c.autorId === currentUser.id).length > 0 ? h('div', { style: { display: 'grid', gap: '16px' } },
                                            checklists
                                                .filter(c => c.autorId === currentUser.id)
                                                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                                                .slice(0, 10)
                                                .map(checklist => 
                                                    h('div', {
                                                        key: checklist.id,
                                                        style: {
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center',
                                                            padding: '24px',
                                                            border: '2px solid #e5e7eb',
                                                            borderRadius: '16px',
                                                            background: '#fafafa',
                                                            borderLeft: `6px solid ${checklist.status === 'aprovado' ? '#16a34a' : checklist.status === 'aguardando_aprovacao' ? '#f59e0b' : '#3b82f6'}`
                                                        }
                                                    },
                                                        h('div', { style: { flex: 1 } },
                                                            h('p', { style: { fontWeight: '700', color: '#1f2937', fontSize: '1.2rem', margin: '0 0 8px 0' } },
                                                                `${checklist.tipo === 'staff' ? 'STAFF' : 'ROLEPLAY'} - ${checklist.equipe || checklist.setor}`
                                                            ),
                                                            h('p', { style: { color: '#6b7280', fontSize: '0.9rem', margin: '4px 0' } },
                                                                `📅 Criado: ${new Date(checklist.createdAt).toLocaleDateString('pt-BR')}`
                                                            ),
                                                            checklist.subsetor && h('p', { style: { color: '#6b7280', fontSize: '0.9rem', margin: 0 } },
                                                                `🚔 Subsetor: ${checklist.subsetor}`
                                                            )
                                                        ),
                                                        h('div', { style: { display: 'flex', alignItems: 'center', gap: '16px' } },
                                                            h('span', {
                                                                style: {
                                                                    padding: '10px 20px',
                                                                    borderRadius: '25px',
                                                                    fontSize: '0.9rem',
                                                                    fontWeight: '700',
                                                                    ...(checklist.status === 'aprovado' ? {
                                                                        background: '#dcfce7',
                                                                        color: '#16a34a',
                                                                        border: '2px solid #16a34a'
                                                                    } : checklist.status === 'aguardando_aprovacao' ? {
                                                                        background: '#fef3c7',
                                                                        color: '#d97706',
                                                                        border: '2px solid #f59e0b'
                                                                    } : {
                                                                        background: '#dbeafe',
                                                                        color: '#2563eb',
                                                                        border: '2px solid #3b82f6'
                                                                    })
                                                                }
                                                            }, checklist.status === 'aprovado' ? '✅ APROVADO' : 
                                                               checklist.status === 'aguardando_aprovacao' ? '⏳ AGUARDANDO' : 
                                                               '📝 EM ANDAMENTO'),
                                                            checklist.status === 'em_andamento' && h('button', {
                                                                onClick: () => {
                                                                    setCurrentChecklistState(checklist);
                                                                    setChecklistFormState(checklist);
                                                                },
                                                                style: {
                                                                    background: '#3b82f6',
                                                                    color: 'white',
                                                                    padding: '12px 20px',
                                                                    border: 'none',
                                                                    borderRadius: '8px',
                                                                    cursor: 'pointer',
                                                                    fontWeight: '600'
                                                                }
                                                            }, '📝 Continuar')
                                                        )
                                                    )
                                                )
                                        ) : h('div', { style: { textAlign: 'center', padding: '40px', background: '#f8fafc', borderRadius: '12px', border: '2px dashed #d1d5db' } },
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '📋'),
                                            h('p', { style: { fontSize: '1.2rem', fontWeight: 'bold', color: '#6b7280', marginBottom: '8px' } }, 'Nenhum checklist criado ainda'),
                                            h('p', { style: { fontSize: '1rem', color: '#9ca3af' } }, 'Crie seu primeiro checklist usando os botões acima')
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página de Auditoria
                    const AuditoriaPage = () => {
                        const [currentAuditoriaState, setCurrentAuditoriaState] = useState(null);
                        const [auditoriaFormState, setAuditoriaFormState] = useState({});

                        const startNewAuditoria = (tipo) => {
                            const newAuditoria = {
                                id: Date.now(),
                                tipo,
                                autorId: currentUser.id,
                                status: 'em_andamento',
                                createdAt: new Date().toISOString(),
                                etapaAtual: 1
                            };
                            setCurrentAuditoriaState(newAuditoria);
                            setAuditoriaFormState({});
                        };

                        const saveAuditoriaData = () => {
                            if (!auditoriaFormState.setor || !auditoriaFormState.turno) {
                                alert('⚠️ Preencha todos os campos obrigatórios!');
                                return;
                            }

                            if (!auditoriaFormState.relatorioFinal || auditoriaFormState.relatorioFinal.length < 100) {
                                alert('⚠️ O relatório deve ter pelo menos 100 caracteres!');
                                return;
                            }

                            // Validar nota final
                            if (!auditoriaFormState.notaFinal) {
                                alert('⚠️ Digite a nota final da auditoria (0 a 100)!');
                                return;
                            }

                            const validacao = validarNota(auditoriaFormState.notaFinal, 'auditoria');
                            if (!validacao.valida) {
                                alert(`⚠️ ${validacao.erro}!`);
                                return;
                            }

                            const updatedAuditoria = {
                                ...currentAuditoriaState,
                                ...auditoriaFormState,
                                notaFinal: validacao.nota,
                                updatedAt: new Date().toISOString(),
                                status: 'aguardando_aprovacao'
                            };

                            const existingIndex = auditorias.findIndex(a => a.id === currentAuditoriaState.id);
                            if (existingIndex >= 0) {
                                setAuditorias(auditorias.map(a => a.id === currentAuditoriaState.id ? updatedAuditoria : a));
                            } else {
                                setAuditorias([...auditorias, updatedAuditoria]);
                            }

                            setCurrentAuditoriaState(null);
                            setAuditoriaFormState({});
                            alert(`✅ AUDITORIA COMPLETA enviada para aprovação!\n📊 Nota final: ${validacao.nota}/100 pontos`);
                        };

                        if (currentAuditoriaState) {
                            return h('div', { style: { minHeight: '100vh', background: '#f8fafc' } },
                                h(Header),
                                h('div', { style: { display: 'flex' } },
                                    h(Sidebar),
                                    h('main', { style: { flex: 1, padding: '40px', maxWidth: '1600px', margin: '0 auto' } },
                                        h('div', { style: { background: 'white', borderRadius: '16px', padding: '40px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)' } },
                                            h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '40px' } },
                                                h('h2', { style: { fontSize: '2.8rem', fontWeight: 'bold', color: '#1f2937', margin: 0 } }, 
                                                    `🔍 AUDITORIA ${currentAuditoriaState.tipo === 'staff' ? 'STAFF' : 'ROLEPLAY'}`
                                                ),
                                                h('button', {
                                                    onClick: () => setCurrentAuditoriaState(null),
                                                    style: {
                                                        background: '#6b7280',
                                                        color: 'white',
                                                        padding: '14px 28px',
                                                        border: 'none',
                                                        borderRadius: '10px',
                                                        cursor: 'pointer',
                                                        fontWeight: '700'
                                                    }
                                                }, '❌ Cancelar')
                                            ),
                                            
                                            h('div', { style: { display: 'grid', gap: '40px' } },
                                                // Seção 1: Dados básicos da auditoria
                                                h('div', { style: { background: 'linear-gradient(135deg, #3b82f6, #1e40af)', padding: '36px', borderRadius: '20px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '2rem', fontWeight: 'bold', marginBottom: '28px' } }, '📋 DADOS DA AUDITORIA'),
                                                    
                                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '28px' } },
                                                        h('div', null,
                                                            h('label', { style: { display: 'block', fontWeight: '700', color: 'white', marginBottom: '10px', fontSize: '1.2rem' } }, 
                                                                currentAuditoriaState.tipo === 'staff' ? '🏢 Equipe Staff' : '🏛️ Setor RP'
                                                            ),
                                                            h('select', {
                                                                value: auditoriaFormState.setor || '',
                                                                onChange: (e) => setAuditoriaFormState({...auditoriaFormState, setor: e.target.value}),
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '16px',
                                                                    border: '3px solid white',
                                                                    borderRadius: '10px',
                                                                    fontSize: '1.1rem',
                                                                    background: 'white',
                                                                    color: '#1f2937',
                                                                    fontWeight: '600'
                                                                }
                                                            },
                                                                h('option', { value: '' }, currentAuditoriaState.tipo === 'staff' ? 'Selecione a equipe...' : 'Selecione o setor...'),
                                                                (currentAuditoriaState.tipo === 'staff' 
                                                                    ? ['Alta Cúpula', 'ADM Staff', 'RESP Comunidade', 'Mentoria', 'Equipe Legal', 'Social Media', 'Comercial', 'Ticketing', 'Eventos']
                                                                    : ['Jurídico', 'Prefeitura', 'Igreja', 'Jornal', 'Hospital', 'Bombeiros', 'Mecânica', 'Empresários', 'Facção', 'Máfia', 'Polícia']
                                                                ).map(item => h('option', { key: item, value: item }, item))
                                                            )
                                                        ),
                                                        // Campo subsetor para Polícia na Auditoria
                                                        auditoriaFormState.setor === 'Polícia' && h('div', null,
                                                            h('label', { style: { display: 'block', fontWeight: '700', color: 'white', marginBottom: '10px', fontSize: '1.2rem' } }, '🚔 Subsetor da Polícia'),
                                                            h('select', {
                                                                value: auditoriaFormState.subsetor || '',
                                                                onChange: (e) => setAuditoriaFormState({...auditoriaFormState, subsetor: e.target.value}),
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '16px',
                                                                    border: '3px solid white',
                                                                    borderRadius: '10px',
                                                                    fontSize: '1.1rem',
                                                                    background: 'white',
                                                                    color: '#1f2937',
                                                                    fontWeight: '600'
                                                                }
                                                            },
                                                                h('option', { value: '' }, 'Selecione o subsetor...'),
                                                                ['PRF', 'Federal', 'Civil', 'Militar', 'Prisão', 'BOPE', 'MPF', 'Segurança Jurídica'].map(sub => 
                                                                    h('option', { key: sub, value: sub }, sub)
                                                                )
                                                            )
                                                        ),
                                                        h('div', null,
                                                            h('label', { style: { display: 'block', fontWeight: '700', color: 'white', marginBottom: '10px', fontSize: '1.2rem' } }, '🕐 Turno'),
                                                            h('select', {
                                                                value: auditoriaFormState.turno || '',
                                                                onChange: (e) => setAuditoriaFormState({...auditoriaFormState, turno: e.target.value}),
                                                                style: {
                                                                    width: '100%',
                                                                    padding: '16px',
                                                                    border: '3px solid white',
                                                                    borderRadius: '10px',
                                                                    fontSize: '1.1rem',
                                                                    background: 'white',
                                                                    color: '#1f2937',
                                                                    fontWeight: '600'
                                                                }
                                                            },
                                                                h('option', { value: '' }, 'Selecione o turno...'),
                                                                h('option', { value: 'manha' }, '🌅 Manhã (06:00 - 14:00)'),
                                                                h('option', { value: 'tarde' }, '☀️ Tarde (14:00 - 22:00)'),
                                                                h('option', { value: 'noite' }, '🌙 Noite (22:00 - 06:00)')
                                                            )
                                                        )
                                                    )
                                                ),

                                                // Seção 2: Sistema COMPLETO de Perguntas Gerais 
                                                h('div', { style: { background: 'linear-gradient(135deg, #10b981, #059669)', padding: '32px', borderRadius: '20px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '2rem', fontWeight: 'bold', marginBottom: '24px' } }, '📋 PERGUNTAS GERAIS COMPLETAS'),
                                                    h('p', { style: { fontSize: '1.1rem', marginBottom: '24px', opacity: 0.9 } }, '✅ 8 Perguntas Gerais + 10 Específicas = Sistema Duplo Completo'),
                                                    h('div', { style: { display: 'grid', gap: '20px' } },
                                                        [
                                                            'A organização possui pelo menos 5 membros ativos?',
                                                            'Os membros estão cumprindo suas funções adequadamente?',
                                                            'A organização possui hierarquia bem definida?',
                                                            'Há respeito mútuo entre os membros?',
                                                            'A organização contribui positivamente para o RP da cidade?',
                                                            'Os protocolos internos estão sendo seguidos?',
                                                            'A comunicação interna é eficiente?',
                                                            'A liderança está ativa e engajada?'
                                                        ].map((pergunta, index) => 
                                                            h('div', { key: `geral_${index}`, style: { background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px' } },
                                                                h('p', { style: { fontSize: '1.1rem', marginBottom: '12px', fontWeight: '600' } }, `${index + 1}. ${pergunta}`),
                                                                h('div', { style: { display: 'flex', gap: '16px' } },
                                                                    h('label', { style: { display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' } },
                                                                        h('input', {
                                                                            type: 'radio',
                                                                            name: `pergunta_geral_${index}`,
                                                                            value: 'sim',
                                                                            checked: auditoriaFormState[`pergunta_geral_${index}`] === 'sim',
                                                                            onChange: (e) => setAuditoriaFormState({
                                                                                ...auditoriaFormState,
                                                                                [`pergunta_geral_${index}`]: e.target.value
                                                                            }),
                                                                            style: { marginRight: '4px' }
                                                                        }),
                                                                        '✅ SIM'
                                                                    ),
                                                                    h('label', { style: { display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' } },
                                                                        h('input', {
                                                                            type: 'radio',
                                                                            name: `pergunta_geral_${index}`,
                                                                            value: 'nao',
                                                                            checked: auditoriaFormState[`pergunta_geral_${index}`] === 'nao',
                                                                            onChange: (e) => setAuditoriaFormState({
                                                                                ...auditoriaFormState,
                                                                                [`pergunta_geral_${index}`]: e.target.value
                                                                            }),
                                                                            style: { marginRight: '4px' }
                                                                        }),
                                                                        '❌ NÃO'
                                                                    )
                                                                )
                                                            )
                                                        )
                                                    )
                                                ),

                                                // Seção 3: Sistema ULTRA COMPLETO de Perguntas Específicas 
                                                auditoriaFormState.setor && h('div', { style: { background: 'linear-gradient(135deg, #f59e0b, #d97706)', padding: '32px', borderRadius: '20px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '2rem', fontWeight: 'bold', marginBottom: '24px' } }, 
                                                        `🎯 SISTEMA ESPECÍFICO COMPLETO - ${auditoriaFormState.setor.toUpperCase()}`
                                                    ),
                                                    h('div', { style: { display: 'grid', gap: '20px' } },
                                                        // Perguntas específicas baseadas no setor
                                                        (() => {
                                                            let perguntasEspecificas = [];
                                                            
                                                            if (auditoriaFormState.setor === 'Polícia') {
                                                                perguntasEspecificas = [
                                                                    'As abordagens estão sendo feitas de forma realista e respeitosa?',
                                                                    'Os protocolos policiais estão sendo seguidos adequadamente?',
                                                                    'Há cooperação efetiva entre os diferentes subsetores?',
                                                                    'Os equipamentos estão sendo usados corretamente?',
                                                                    'As prisões são justificadas e bem documentadas?',
                                                                    'O comportamento policial está adequado ao cargo?',
                                                                    'Há respeito aos direitos dos cidadãos?',
                                                                    'As investigações são conduzidas adequadamente?',
                                                                    'Existe transparência nas ações policiais?',
                                                                    'O uso da força é proporcional e justificado?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Hospital') {
                                                                perguntasEspecificas = [
                                                                    'Os atendimentos médicos são realistas e precisos?',
                                                                    'Os protocolos hospitalares são seguidos?',
                                                                    'Os preços dos tratamentos são justos?',
                                                                    'Há médicos suficientes para a demanda?',
                                                                    'O RP médico está sendo bem executado?',
                                                                    'Há disponibilidade de medicamentos necessários?',
                                                                    'O atendimento de emergência é eficiente?',
                                                                    'Existe sigilo médico e ética profissional?',
                                                                    'As cirurgias são realizadas adequadamente?',
                                                                    'Há programas de prevenção e educação em saúde?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Mecânica') {
                                                                perguntasEspecificas = [
                                                                    'Os reparos são realizados de forma realista?',
                                                                    'Os preços dos serviços são adequados?',
                                                                    'Há mecânicos disponíveis nos horários necessários?',
                                                                    'O RP de conserto está sendo bem feito?',
                                                                    'Os materiais necessários estão disponíveis?',
                                                                    'O tempo de reparo é razoável?',
                                                                    'Há variedade de serviços oferecidos?',
                                                                    'O diagnóstico de problemas é preciso?',
                                                                    'Existe garantia nos serviços prestados?',
                                                                    'O atendimento ao cliente é satisfatório?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Jurídico') {
                                                                perguntasEspecificas = [
                                                                    'Os processos judiciais são conduzidos adequadamente?',
                                                                    'Os advogados conhecem as leis da cidade?',
                                                                    'As audiências são realizadas de forma realista?',
                                                                    'Há juízes disponíveis quando necessário?',
                                                                    'O sistema jurídico funciona eficientemente?',
                                                                    'Os direitos dos cidadãos são respeitados?',
                                                                    'Há transparência nos processos?',
                                                                    'A justiça é aplicada de forma imparcial?',
                                                                    'Existe orientação jurídica para a população?',
                                                                    'Os prazos processuais são respeitados?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Prefeitura') {
                                                                perguntasEspecificas = [
                                                                    'As decisões administrativas são bem fundamentadas?',
                                                                    'Há transparência nas ações da prefeitura?',
                                                                    'Os serviços públicos funcionam adequadamente?',
                                                                    'O prefeito está ativo e presente?',
                                                                    'As políticas públicas beneficiam a cidade?',
                                                                    'Há participação popular nas decisões?',
                                                                    'Os recursos públicos são bem utilizados?',
                                                                    'A comunicação com a população é eficiente?',
                                                                    'Existe planejamento urbano adequado?',
                                                                    'Os funcionários públicos são eficientes?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Empresários') {
                                                                perguntasEspecificas = [
                                                                    'Os negócios estão sendo conduzidos de forma realista?',
                                                                    'Há variedade de empresas na cidade?',
                                                                    'Os preços praticados são justos?',
                                                                    'As empresas geram empregos para a população?',
                                                                    'Há inovação no setor empresarial?',
                                                                    'A concorrência é saudável?',
                                                                    'Os produtos/serviços atendem a demanda?',
                                                                    'Existe responsabilidade social empresarial?',
                                                                    'As empresas respeitam leis trabalhistas?',
                                                                    'Há crescimento econômico sustentável?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Facção') {
                                                                perguntasEspecificas = [
                                                                    'As atividades criminosas são realistas?',
                                                                    'Há organização hierárquica bem definida?',
                                                                    'Os confrontos são bem executados?',
                                                                    'As guerras entre facções têm motivos válidos?',
                                                                    'O RP criminal está adequado ao servidor?',
                                                                    'Há respeito aos limites estabelecidos?',
                                                                    'As atividades não prejudicam novatos?',
                                                                    'Existe código de conduta interno?',
                                                                    'Os territórios são respeitados?',
                                                                    'Há consequências realistas para as ações?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Máfia') {
                                                                perguntasEspecificas = [
                                                                    'As operações mafiosas são sofisticadas?',
                                                                    'Há discrição nas atividades ilegais?',
                                                                    'A hierarquia mafiosa é respeitada?',
                                                                    'Os negócios de fachada funcionam adequadamente?',
                                                                    'O RP mafioso está sendo bem interpretado?',
                                                                    'Há código de honra respeitado?',
                                                                    'As atividades são bem planejadas?',
                                                                    'Existe controle territorial estabelecido?',
                                                                    'Os rituais e tradições são mantidos?',
                                                                    'Há lealdade e omertà entre membros?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Igreja') {
                                                                perguntasEspecificas = [
                                                                    'Os cultos são realizados regularmente?',
                                                                    'Há participação da comunidade?',
                                                                    'O RP religioso está sendo bem executado?',
                                                                    'A igreja oferece apoio à comunidade?',
                                                                    'Há respeito às diferentes crenças?',
                                                                    'As atividades beneficentes funcionam?',
                                                                    'O espaço é bem utilizado para eventos?',
                                                                    'Há orientação espiritual disponível?',
                                                                    'Existe educação religiosa para jovens?',
                                                                    'A igreja promove valores positivos?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Jornal') {
                                                                perguntasEspecificas = [
                                                                    'As notícias são publicadas regularmente?',
                                                                    'O conteúdo jornalístico é de qualidade?',
                                                                    'Há imparcialidade nas reportagens?',
                                                                    'O jornal cobre eventos importantes da cidade?',
                                                                    'A equipe jornalística está ativa?',
                                                                    'Há variedade nos tipos de conteúdo?',
                                                                    'As informações são verificadas?',
                                                                    'Existe interação com a comunidade?',
                                                                    'O design e layout são atrativos?',
                                                                    'Há liberdade de imprensa respeitada?'
                                                                ];
                                                            } else if (auditoriaFormState.setor === 'Bombeiros') {
                                                                perguntasEspecificas = [
                                                                    'Os resgates são executados adequadamente?',
                                                                    'Há bombeiros suficientes para a demanda?',
                                                                    'Os equipamentos estão funcionando?',
                                                                    'O tempo de resposta é adequado?',
                                                                    'O RP de emergência está realista?',
                                                                    'Há treinamento adequado da equipe?',
                                                                    'As operações de combate a incêndio são eficientes?',
                                                                    'Existe prevenção e educação sobre segurança?',
                                                                    'Os protocolos de segurança são seguidos?',
                                                                    'Há cooperação com outros órgãos de segurança?'
                                                                ];
                                                            } else {
                                                                // Para setores staff ou outros
                                                                perguntasEspecificas = [
                                                                    'A equipe está cumprindo suas responsabil idades?',
                                                                    'Há comunicação eficiente com outras equipes?',
                                                                    'Os prazos são respeitados adequadamente?',
                                                                    'A qualidade do trabalho está satisfatória?',
                                                                    'Há proatividade na resolução de problemas?',
                                                                    'Existe organização nos processos internos?',
                                                                    'Os membros estão devidamente treinados?',
                                                                    'Há feedback constante sobre o desempenho?',
                                                                    'A equipe se adapta bem a mudanças?',
                                                                    'Existe inovação nas soluções propostas?'
                                                                ];
                                                            }

                                                            return perguntasEspecificas.map((pergunta, index) => 
                                                                h('div', { key: `especifica_${index}`, style: { background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px' } },
                                                                    h('p', { style: { fontSize: '1.1rem', marginBottom: '12px', fontWeight: '600' } }, `${index + 1}. ${pergunta}`),
                                                                    h('div', { style: { display: 'flex', gap: '16px' } },
                                                                        h('label', { style: { display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' } },
                                                                            h('input', {
                                                                                type: 'radio',
                                                                                name: `pergunta_especifica_${index}`,
                                                                                value: 'sim',
                                                                                checked: auditoriaFormState[`pergunta_especifica_${index}`] === 'sim',
                                                                                onChange: (e) => setAuditoriaFormState({
                                                                                    ...auditoriaFormState,
                                                                                    [`pergunta_especifica_${index}`]: e.target.value
                                                                                }),
                                                                                style: { marginRight: '4px' }
                                                                            }),
                                                                            '✅ SIM'
                                                                        ),
                                                                        h('label', { style: { display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' } },
                                                                            h('input', {
                                                                                type: 'radio',
                                                                                name: `pergunta_especifica_${index}`,
                                                                                value: 'nao',
                                                                                checked: auditoriaFormState[`pergunta_especifica_${index}`] === 'nao',
                                                                                onChange: (e) => setAuditoriaFormState({
                                                                                    ...auditoriaFormState,
                                                                                    [`pergunta_especifica_${index}`]: e.target.value
                                                                                }),
                                                                                style: { marginRight: '4px' }
                                                                            }),
                                                                            '❌ NÃO'
                                                                        )
                                                                    )
                                                                )
                                                            );
                                                        })()
                                                    )
                                                ),

                                                // Seção 4: Relatório final
                                                h('div', { style: { background: 'linear-gradient(135deg, #dc2626, #b91c1c)', padding: '40px', borderRadius: '20px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '2rem', fontWeight: 'bold', marginBottom: '20px' } }, '📝 RELATÓRIO FINAL'),
                                                    h('p', { style: { fontSize: '1.1rem', marginBottom: '20px', opacity: 0.9 } }, 
                                                        '⚠️ Mínimo 100 caracteres para uma auditoria completa'
                                                    ),
                                                    h('textarea', {
                                                        value: auditoriaFormState.relatorioFinal || '',
                                                        onChange: (e) => setAuditoriaFormState({...auditoriaFormState, relatorioFinal: e.target.value}),
                                                        style: {
                                                            width: '100%',
                                                            padding: '24px',
                                                            border: '4px solid white',
                                                            borderRadius: '16px',
                                                            fontSize: '1.1rem',
                                                            resize: 'vertical',
                                                            minHeight: '300px',
                                                            background: 'white',
                                                            color: '#1f2937',
                                                            fontFamily: 'inherit',
                                                            lineHeight: '1.6'
                                                        },
                                                        placeholder: `📝 RELATÓRIO COMPLETO DA AUDITORIA\n\n• Resumo dos principais achados\n• Pontos fortes identificados\n• Problemas encontrados\n• Recomendações específicas\n• Conclusão da auditoria\n\nAuditor: ${currentUser.nome}\nSetor: ${auditoriaFormState.setor || 'A definir'}\nTurno: ${auditoriaFormState.turno || 'A definir'}`
                                                    })
                                                ),

                                                // SEÇÃO DE NOTA FINAL
                                                h('div', { style: { background: 'linear-gradient(135deg, #16a34a, #15803d)', padding: '32px', borderRadius: '16px', color: 'white' } },
                                                    h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '20px', textAlign: 'center' } }, '📊 NOTA FINAL DA AUDITORIA'),
                                                    h('div', { style: { maxWidth: '400px', margin: '0 auto' } },
                                                        h('input', {
                                                            type: 'number',
                                                            min: '0',
                                                            max: '100',
                                                            step: '0.1',
                                                            value: auditoriaFormState.notaFinal || '',
                                                            onChange: (e) => setAuditoriaFormState({...auditoriaFormState, notaFinal: e.target.value}),
                                                            style: {
                                                                width: '100%',
                                                                padding: '16px',
                                                                border: '3px solid white',
                                                                borderRadius: '12px',
                                                                fontSize: '1.5rem',
                                                                background: 'white',
                                                                color: '#1f2937',
                                                                fontWeight: '700',
                                                                textAlign: 'center'
                                                            },
                                                            placeholder: 'Ex: 87.5'
                                                        })
                                                    )
                                                ),

                                                // Botão finalizar
                                                h('div', { style: { display: 'flex', justifyContent: 'center', gap: '24px', padding: '32px' } },
                                                    h('button', {
                                                        onClick: saveAuditoriaData,
                                                        style: {
                                                            background: auditoriaFormState.notaFinal ? '#16a34a' : '#f59e0b',
                                                            color: 'white',
                                                            padding: '18px 40px',
                                                            border: 'none',
                                                            borderRadius: '12px',
                                                            cursor: 'pointer',
                                                            fontWeight: '700',
                                                            fontSize: '1.2rem'
                                                        }
                                                    }, auditoriaFormState.notaFinal ? '🏆 FINALIZAR AUDITORIA' : '⚠️ FALTA A NOTA')
                                                )
                                            )
                                        )
                                    )
                                )
                            );
                        }

                        return h('div', { style: { minHeight: '100vh', background: '#f8fafc' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '32px' } }, '🔍 Auditoria'),
                                    
                                    // Cards para criar novas auditorias
                                    h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '24px', marginBottom: '40px' } },
                                        h('div', {
                                            onClick: () => startNewAuditoria('staff'),
                                            style: {
                                                background: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                                                color: 'white',
                                                padding: '32px',
                                                borderRadius: '16px',
                                                cursor: 'pointer',
                                                textAlign: 'center'
                                            }
                                        },
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '👥'),
                                            h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '8px' } }, 'Auditoria Staff'),
                                            h('p', { style: { opacity: 0.9, fontSize: '1.1rem' } }, 'Auditoria das equipes Discord - 100 pontos')
                                        ),
                                        h('div', {
                                            onClick: () => startNewAuditoria('roleplay'),
                                            style: {
                                                background: 'linear-gradient(135deg, #06b6d4, #0891b2)',
                                                color: 'white',
                                                padding: '32px',
                                                borderRadius: '16px',
                                                cursor: 'pointer',
                                                textAlign: 'center'
                                            }
                                        },
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '🎭'),
                                            h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '8px' } }, 'Auditoria Roleplay'),
                                            h('p', { style: { opacity: 0.9, fontSize: '1.1rem' } }, 'Auditoria dos setores RP - 100 pontos')
                                        )
                                    ),

                                    // Lista de auditorias existentes
                                    h('div', { style: { background: 'white', borderRadius: '16px', padding: '32px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)' } },
                                        h('h3', { style: { fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '24px' } }, 'Minhas Auditorias'),
                                        h('div', { style: { display: 'grid', gap: '16px' } },
                                            auditorias
                                                .filter(a => a.autorId === currentUser.id)
                                                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                                                .slice(0, 10)
                                                .map(auditoria => 
                                                    h('div', {
                                                        key: auditoria.id,
                                                        style: {
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center',
                                                            padding: '28px',
                                                            border: '2px solid #e5e7eb',
                                                            borderRadius: '16px',
                                                            background: '#fafafa',
                                                            borderLeft: `6px solid ${auditoria.status === 'aprovada' ? '#16a34a' : auditoria.status === 'aguardando_aprovacao' ? '#f59e0b' : '#8b5cf6'}`
                                                        }
                                                    },
                                                        h('div', { style: { flex: 1 } },
                                                            h('p', { style: { fontWeight: '700', color: '#1f2937', fontSize: '1.3rem', margin: '0 0 12px 0' } },
                                                                `AUDITORIA ${auditoria.tipo === 'staff' ? 'STAFF' : 'ROLEPLAY'}`
                                                            ),
                                                            h('p', { style: { color: '#1f2937', fontSize: '1rem', margin: '0 0 8px 0', fontWeight: '600' } },
                                                                `🏛️ Setor: ${auditoria.setor || 'Não especificado'}`
                                                            ),
                                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))', gap: '8px' } },
                                                                auditoria.turno && h('p', { style: { color: '#6b7280', fontSize: '0.95rem', margin: 0 } },
                                                                    `🕐 Turno: ${auditoria.turno}`
                                                                ),
                                                                h('p', { style: { color: '#6b7280', fontSize: '0.9rem', margin: 0 } },
                                                                    `📅 Criado: ${new Date(auditoria.createdAt).toLocaleDateString('pt-BR')}`
                                                                ),
                                                                auditoria.subsetor && h('p', { style: { color: '#6b7280', fontSize: '0.9rem', margin: 0 } },
                                                                    `🚔 Subsetor: ${auditoria.subsetor}`
                                                                )
                                                            )
                                                        ),
                                                        h('div', { style: { display: 'flex', alignItems: 'center', gap: '16px' } },
                                                            h('span', {
                                                                style: {
                                                                    padding: '12px 24px',
                                                                    borderRadius: '25px',
                                                                    fontSize: '0.9rem',
                                                                    fontWeight: '700',
                                                                    ...(auditoria.status === 'aprovada' ? {
                                                                        background: '#dcfce7',
                                                                        color: '#16a34a',
                                                                        border: '2px solid #16a34a'
                                                                    } : auditoria.status === 'aguardando_aprovacao' ? {
                                                                        background: '#fef3c7',
                                                                        color: '#d97706',
                                                                        border: '2px solid #f59e0b'
                                                                    } : {
                                                                        background: '#e0e7ff',
                                                                        color: '#5b21b6',
                                                                        border: '2px solid #8b5cf6'
                                                                    })
                                                                }
                                                            }, auditoria.status === 'aprovada' ? '✅ APROVADA' : 
                                                               auditoria.status === 'aguardando_aprovacao' ? '⏳ AGUARDANDO' : 
                                                               '📝 EM ANDAMENTO'),
                                                            auditoria.status === 'em_andamento' && h('button', {
                                                                onClick: () => {
                                                                    setCurrentAuditoriaState(auditoria);
                                                                    setAuditoriaFormState(auditoria);
                                                                },
                                                                style: {
                                                                    background: '#8b5cf6',
                                                                    color: 'white',
                                                                    padding: '12px 20px',
                                                                    border: 'none',
                                                                    borderRadius: '8px',
                                                                    cursor: 'pointer',
                                                                    fontWeight: '600'
                                                                }
                                                            }, '📝 Continuar')
                                                        )
                                                    )
                                                )
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página do Painel da Cidade
                    const PainelCidadePage = () => {
                        const checklistsAprovados = checklists.filter(c => c.status === 'aprovado');
                        const auditoriasAprovadas = auditorias.filter(a => a.status === 'aprovada');
                        
                        // Calcular pontuação pelas NOTAS FINAIS (sistema simplificado)
                        const pontuacaoChecklist = checklistsAprovados.reduce((total, checklist) => {
                            return total + (checklist.notaFinal || 0);
                        }, 0);
                        
                        const pontuacaoAuditoria = auditoriasAprovadas.reduce((total, auditoria) => {
                            return total + (auditoria.notaFinal || 0);
                        }, 0);
                        
                        // Pontuação total da cidade
                        const pontuacaoTotal = pontuacaoChecklist + pontuacaoAuditoria;
                        
                        const metaCidade = 815; // Meta da cidade

                        return h('div', { style: { minHeight: '100vh', background: '#f8fafc' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '32px' } }, '🏙️ Painel da Cidade'),
                                    
                                    // Card principal da pontuação
                                    h('div', { style: { background: 'white', borderRadius: '16px', padding: '40px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)', textAlign: 'center', marginBottom: '32px' } },
                                        h('div', { style: { display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '16px' } },
                                            h('img', { 
                                                src: 'arh6AXLgsTz2G5P60d8DS', 
                                                alt: 'Ilusion RP',
                                                style: { width: '60px', height: '35px', marginRight: '16px' }
                                            }),
                                            h('h3', { style: { fontSize: '2rem', fontWeight: 'bold', color: '#1f2937', margin: 0 } }, 'Pontuação Ilusion RP')
                                        ),
                                        
                                        h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '32px', marginBottom: '32px' } },
                                            // Checklist
                                            h('div', { style: { textAlign: 'center' } },
                                                h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '✅'),
                                                h('h4', { style: { fontSize: '1.3rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '8px' } }, 'Checklists'),
                                                h('p', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#3b82f6' } }, pontuacaoChecklist),
                                                h('p', { style: { color: '#6b7280', marginBottom: '4px' } }, `${checklistsAprovados.length} checklists aprovados`),
                                                h('p', { style: { color: '#6b7280' } }, `Soma das notas finais`)
                                            ),
                                            
                                            // Auditoria
                                            h('div', { style: { textAlign: 'center' } },
                                                h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '🔍'),
                                                h('h4', { style: { fontSize: '1.3rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '8px' } }, 'Auditorias'),
                                                h('p', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#10b981' } }, pontuacaoAuditoria),
                                                h('p', { style: { color: '#6b7280', marginBottom: '4px' } }, `${auditoriasAprovadas.length} auditorias aprovadas`),
                                                h('p', { style: { color: '#6b7280' } }, `Soma das notas finais`)
                                            ),
                                            
                                            // Total
                                            h('div', { style: { textAlign: 'center' } },
                                                h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '🏆'),
                                                h('h4', { style: { fontSize: '1.3rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '8px' } }, 'Total'),
                                                h('p', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#8b5cf6' } }, pontuacaoTotal),
                                                h('p', { style: { color: '#6b7280' } }, 'Pontos acumulados')
                                            )
                                        ),
                                        
                                        // Progresso para meta
                                        h('div', { style: { background: '#f8fafc', padding: '24px', borderRadius: '12px' } },
                                            h('h4', { style: { fontSize: '1.2rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '16px' } }, 
                                                `🎯 Progresso para Meta: ${metaCidade} pontos`
                                            ),
                                            h('div', { style: { width: '100%', background: '#e5e7eb', borderRadius: '20px', height: '20px', position: 'relative' } },
                                                h('div', {
                                                    style: {
                                                        width: `${Math.min((pontuacaoTotal / metaCidade) * 100, 100)}%`,
                                                        background: pontuacaoTotal >= metaCidade ? 
                                                            'linear-gradient(90deg, #10b981, #16a34a)' : 
                                                            'linear-gradient(90deg, #3b82f6, #8b5cf6)',
                                                        height: '100%',
                                                        borderRadius: '20px',
                                                        transition: 'width 0.5s ease'
                                                    }
                                                }),
                                                h('div', {
                                                    style: {
                                                        position: 'absolute',
                                                        top: '50%',
                                                        left: '50%',
                                                        transform: 'translate(-50%, -50%)',
                                                        fontSize: '0.9rem',
                                                        fontWeight: 'bold',
                                                        color: 'white',
                                                        textShadow: '1px 1px 2px rgba(0,0,0,0.5)'
                                                    }
                                                }, `${Math.round((pontuacaoTotal / metaCidade) * 100)}%`)
                                            )
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Página do Painel Financeiro
                    const PainelFinanceiroPage = () => {
                        const [form, setForm] = useState({
                            organizacao: '', comando: '', motivo: '', valor: '', quemAutorizou: '', corruptoId: '', corruptoNome: ''
                        });
                        const [erro, setErro] = useState('');

                        const podeAprovar = ['RESP Comunidade', 'Alta Cúpula', 'Diretor', 'CEO'].includes(currentUser?.cargo);

                        function enviarSolicitacao(e) {
                            e.preventDefault();
                            // Validação simples
                            if (!form.organizacao || !form.comando || !form.motivo || !form.valor || !form.quemAutorizou) {
                                setErro('Preencha todos os campos obrigatórios!');
                                return;
                            }
                            if(form.motivo === 'caixa2' && (!form.corruptoId || !form.corruptoNome)){
                                setErro('Preencha os dados do corrupto!');
                                return;
                            }
                            setErro('');
                            setSolicitacoesFinanceiras([
                                ...solicitacoesFinanceiras,
                                {
                                    ...form,
                                    status: 'pendente',
                                    criadoPor: currentUser.id,
                                    criadoEm: new Date().toISOString(),
                                    id: Date.now()
                                }
                            ]);
                            setForm({ organizacao: '', comando: '', motivo: '', valor: '', quemAutorizou: '', corruptoId: '', corruptoNome: '' });
                            alert('✅ Solicitação enviada! Aguarde aprovação.');
                        }

                        function aprovarSol(id) {
                            setSolicitacoesFinanceiras(
                                solicitacoesFinanceiras.map(sol => sol.id === id ? { 
                                    ...sol, 
                                    status: 'aprovado', 
                                    aprovadoPor: currentUser.id, 
                                    aprovadorNome: currentUser.nome,
                                    aprovadoEm: new Date().toISOString() 
                                } : sol)
                            );
                            alert('✅ Solicitação aprovada!');
                        }

                        function rejeitarSol(id) {
                            const motivoRejeicao = prompt('💬 Motivo da rejeição:');
                            if (!motivoRejeicao) return;
                            
                            setSolicitacoesFinanceiras(
                                solicitacoesFinanceiras.map(sol => sol.id === id ? { 
                                    ...sol, 
                                    status: 'rejeitado', 
                                    rejeitadoPor: currentUser.id,
                                    rejeitadorNome: currentUser.nome,
                                    motivoRejeicao: motivoRejeicao,
                                    rejeitadoEm: new Date().toISOString() 
                                } : sol)
                            );
                            alert('❌ Solicitação rejeitada!');
                        }

                        const solicitacoesPendentes = solicitacoesFinanceiras.filter(s => s.status === 'pendente');

                        return h('div', { style: { minHeight: '100vh', background: '#f8fafc' } },
                            h(Header),
                            h('div', { style: { display: 'flex' } },
                                h(Sidebar),
                                h('main', { style: { flex: 1, padding: '40px' } },
                                    h('h2', { style: { fontSize: '2.5rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '32px' } }, '💸 Painel Financeiro'),

                                    // Formulário de Solicitação
                                    h('div', { style: { background: 'white', borderRadius: '16px', padding: '32px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)', marginBottom: '32px' } },
                                        h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '24px' } }, '📝 Nova Solicitação'),
                                        
                                        h('form', { onSubmit: enviarSolicitacao },
                                            erro && h('div', { style: { background: '#fef2f2', border: '1px solid #fca5a5', color: '#dc2626', padding: '16px', borderRadius: '8px', marginBottom: '20px', fontWeight: 'bold' } }, 
                                                `⚠️ ${erro}`
                                            ),
                                            
                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '20px', marginBottom: '20px' } },
                                                h('div', null,
                                                    h('label', { style: { display: 'block', fontWeight: '600', color: '#374151', marginBottom: '8px' } }, 'Nome da Organização *'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: form.organizacao,
                                                        onChange: e => setForm(f => ({ ...f, organizacao: e.target.value })),
                                                        style: { width: '100%', padding: '12px', border: '1px solid #d1d5db', borderRadius: '8px', fontSize: '16px' },
                                                        placeholder: 'Ex: Polícia Civil'
                                                    })
                                                ),
                                                h('div', null,
                                                    h('label', { style: { display: 'block', fontWeight: '600', color: '#374151', marginBottom: '8px' } }, 'Quem Comanda (Nome/ID) *'),
                                                    h('input', {
                                                        type: 'text',
                                                        value: form.comando,
                                                        onChange: e => setForm(f => ({ ...f, comando: e.target.value })),
                                                        style: { width: '100%', padding: '12px', border: '1px solid #d1d5db', borderRadius: '8px', fontSize: '16px' },
                                                        placeholder: 'Ex: João Silva (ID: 123)'
                                                    })
                                                )
                                            ),

                                            h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '20px', marginBottom: '20px' } },
                                                h('div', null,
                                                    h('label', { style: { display: 'block', fontWeight: '600', color: '#374151', marginBottom: '8px' } }, 'Motivo da Quebra *'),
                                                    h('select', {
                                                        value: form.motivo,
                                                        onChange: e => setForm(f => ({ ...f, motivo: e.target.value })),
                                                        style: { width: '100%', padding: '12px', border: '1px solid #d1d5db', borderRadius: '8px', fontSize: '16px' }
                                                    },
                                                        h('option', { value: '' }, 'Selecione o motivo...'),
                                                        h('option', { value: 'saldoneg' }, 'Saldo Negativo'),
                                                        h('option', { value: 'hack' }, 'Hack/Bug'),
                                                        h('option', { value: 'caixa2' }, 'Caixa 2 (Corrupção)')
                                                    )
                                                ),
                                                h('div', null,
                                                    h('label', { style: { display: 'block', fontWeight: '600', color: '#374151', marginBottom: '8px' } }, 'Valor a Adicionar (R$) *'),
                                                    h('input', {
                                                        type: 'number',
                                                        min: '0',
                                                        step: '0.01',
                                                        value: form.valor,
                                                        onChange: e => setForm(f => ({ ...f, valor: e.target.value })),
                                                        style: { width: '100%', padding: '12px', border: '1px solid #d1d5db', borderRadius: '8px', fontSize: '16px' },
                                                        placeholder: 'Ex: 50000.00'
                                                    })
                                                )
                                            ),

                                            // Campos específicos para Caixa 2
                                            form.motivo === 'caixa2' && h('div', { style: { background: '#fef3c7', padding: '20px', borderRadius: '12px', marginBottom: '20px', border: '2px solid #f59e0b' } },
                                                h('h4', { style: { fontSize: '1.2rem', fontWeight: 'bold', color: '#92400e', marginBottom: '16px' } }, '⚠️ Dados do Corrupto (Obrigatório para Caixa 2)'),
                                                h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '16px' } },
                                                    h('div', null,
                                                        h('label', { style: { display: 'block', fontWeight: '600', color: '#92400e', marginBottom: '8px' } }, 'ID do Corrupto *'),
                                                        h('input', {
                                                            type: 'text',
                                                            value: form.corruptoId,
                                                            onChange: e => setForm(f => ({ ...f, corruptoId: e.target.value })),
                                                            style: { width: '100%', padding: '12px', border: '1px solid #f59e0b', borderRadius: '8px', fontSize: '16px' },
                                                            placeholder: 'Ex: 789'
                                                        })
                                                    ),
                                                    h('div', null,
                                                        h('label', { style: { display: 'block', fontWeight: '600', color: '#92400e', marginBottom: '8px' } }, 'Nome do Corrupto *'),
                                                        h('input', {
                                                            type: 'text',
                                                            value: form.corruptoNome,
                                                            onChange: e => setForm(f => ({ ...f, corruptoNome: e.target.value })),
                                                            style: { width: '100%', padding: '12px', border: '1px solid #f59e0b', borderRadius: '8px', fontSize: '16px' },
                                                            placeholder: 'Ex: Carlos Corrupto'
                                                        })
                                                    )
                                                )
                                            ),

                                            h('div', { style: { marginBottom: '24px' } },
                                                h('label', { style: { display: 'block', fontWeight: '600', color: '#374151', marginBottom: '8px' } }, 'Quem Autorizou da Staff *'),
                                                h('input', {
                                                    type: 'text',
                                                    value: form.quemAutorizou,
                                                    onChange: e => setForm(f => ({ ...f, quemAutorizou: e.target.value })),
                                                    style: { width: '100%', padding: '12px', border: '1px solid #d1d5db', borderRadius: '8px', fontSize: '16px' },
                                                    placeholder: 'Ex: Daniel (Diretor)'
                                                })
                                            ),

                                            h('button', { 
                                                type: 'submit', 
                                                style: { 
                                                    background: '#10b981', 
                                                    color: 'white', 
                                                    padding: '16px 32px', 
                                                    borderRadius: '8px', 
                                                    fontWeight: 'bold', 
                                                    border: 'none', 
                                                    fontSize: '16px',
                                                    cursor: 'pointer'
                                                } 
                                            }, '📤 Enviar Solicitação')
                                        )
                                    ),

                                    // Lista de Solicitações
                                    h('div', { style: { background: 'white', borderRadius: '16px', padding: '32px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)' } },
                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' } },
                                            h('h3', { style: { fontSize: '1.8rem', fontWeight: 'bold', color: '#1f2937', margin: 0 } }, '📋 Solicitações Recentes'),
                                            solicitacoesPendentes.length > 0 && podeAprovar && h('span', { 
                                                style: { 
                                                    background: '#fbbf24', 
                                                    color: 'white', 
                                                    padding: '8px 16px', 
                                                    borderRadius: '20px', 
                                                    fontWeight: 'bold',
                                                    fontSize: '14px'
                                                } 
                                            }, `⏳ ${solicitacoesPendentes.length} pendente${solicitacoesPendentes.length > 1 ? 's' : ''}`)
                                        ),
                                        
                                        solicitacoesFinanceiras.length > 0 ? h('div', { style: { display: 'grid', gap: '16px' } },
                                            solicitacoesFinanceiras
                                                .sort((a, b) => new Date(b.criadoEm) - new Date(a.criadoEm))
                                                .slice(0, 15)
                                                .map(sol =>
                                                    h('div', { 
                                                        key: sol.id, 
                                                        style: { 
                                                            background: '#f9fafb', 
                                                            borderRadius: '12px', 
                                                            padding: '24px', 
                                                            border: `2px solid ${sol.status === 'aprovado' ? '#10b981' : sol.status === 'rejeitado' ? '#ef4444' : '#f59e0b'}`,
                                                            borderLeft: `6px solid ${sol.status === 'aprovado' ? '#10b981' : sol.status === 'rejeitado' ? '#ef4444' : '#f59e0b'}`
                                                        } 
                                                    },
                                                        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '16px' } },
                                                            h('div', null,
                                                                h('h4', { style: { fontSize: '1.3rem', fontWeight: 'bold', color: '#1f2937', margin: '0 0 8px 0' } }, sol.organizacao),
                                                                h('p', { style: { color: '#6b7280', margin: '4px 0', fontSize: '14px' } }, `📅 ${new Date(sol.criadoEm).toLocaleString('pt-BR')}`)
                                                            ),
                                                            h('span', {
                                                                style: {
                                                                    padding: '8px 16px',
                                                                    borderRadius: '20px',
                                                                    fontSize: '12px',
                                                                    fontWeight: 'bold',
                                                                    ...(sol.status === 'pendente' ? {
                                                                        background: '#fef3c7',
                                                                        color: '#92400e'
                                                                    } : sol.status === 'aprovado' ? {
                                                                        background: '#d1fae5',
                                                                        color: '#065f46'
                                                                    } : {
                                                                        background: '#fee2e2',
                                                                        color: '#991b1b'
                                                                    })
                                                                }
                                                            }, sol.status === 'pendente' ? '⏳ PENDENTE' :
                                                               sol.status === 'aprovado' ? '✅ APROVADO' : '❌ REJEITADO')
                                                        ),
                                                        
                                                        h('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '12px', marginBottom: '16px' } },
                                                            h('p', { style: { margin: 0, fontSize: '14px' } }, h('strong', null, 'Comando: '), sol.comando),
                                                            h('p', { style: { margin: 0, fontSize: '14px' } }, h('strong', null, 'Motivo: '), 
                                                                sol.motivo === 'saldoneg' ? 'Saldo Negativo' : 
                                                                sol.motivo === 'hack' ? 'Hack/Bug' : 'Caixa 2'
                                                            ),
                                                            h('p', { style: { margin: 0, fontSize: '14px' } }, h('strong', null, 'Valor: '), `R$ ${parseFloat(sol.valor).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`),
                                                            h('p', { style: { margin: 0, fontSize: '14px' } }, h('strong', null, 'Autorizado por: '), sol.quemAutorizou)
                                                        ),
                                                        
                                                        sol.motivo === 'caixa2' && h('div', { style: { background: '#fef3c7', padding: '12px', borderRadius: '8px', marginBottom: '16px' } },
                                                            h('p', { style: { margin: 0, fontSize: '14px', fontWeight: 'bold', color: '#92400e' } }, 
                                                                `⚠️ Corrupto: ${sol.corruptoNome} (ID: ${sol.corruptoId})`
                                                            )
                                                        ),

                                                        sol.status === 'aprovado' && sol.aprovadorNome && h('div', { style: { background: '#d1fae5', padding: '12px', borderRadius: '8px', marginBottom: '8px' } },
                                                            h('p', { style: { margin: 0, fontSize: '14px', color: '#065f46' } }, 
                                                                `✅ Aprovado por: ${sol.aprovadorNome} em ${new Date(sol.aprovadoEm).toLocaleString('pt-BR')}`
                                                            )
                                                        ),

                                                        sol.status === 'rejeitado' && sol.rejeitadorNome && h('div', { style: { background: '#fee2e2', padding: '12px', borderRadius: '8px', marginBottom: '8px' } },
                                                            h('p', { style: { margin: 0, fontSize: '14px', color: '#991b1b' } }, 
                                                                `❌ Rejeitado por: ${sol.rejeitadorNome} em ${new Date(sol.rejeitadoEm).toLocaleString('pt-BR')}`
                                                            ),
                                                            sol.motivoRejeicao && h('p', { style: { margin: '4px 0 0 0', fontSize: '14px', color: '#991b1b', fontWeight: 'bold' } }, 
                                                                `Motivo: ${sol.motivoRejeicao}`
                                                            )
                                                        ),

                                                        podeAprovar && sol.status === 'pendente' && h('div', { style: { display: 'flex', gap: '12px', justifyContent: 'flex-end' } },
                                                            h('button', { 
                                                                onClick: () => aprovarSol(sol.id), 
                                                                style: { 
                                                                    background: '#10b981', 
                                                                    color: 'white', 
                                                                    border: 'none', 
                                                                    borderRadius: '8px', 
                                                                    padding: '10px 20px', 
                                                                    fontWeight: 'bold',
                                                                    cursor: 'pointer'
                                                                } 
                                                            }, '✅ Aprovar'),
                                                            h('button', { 
                                                                onClick: () => rejeitarSol(sol.id), 
                                                                style: { 
                                                                    background: '#ef4444', 
                                                                    color: 'white', 
                                                                    border: 'none', 
                                                                    borderRadius: '8px', 
                                                                    padding: '10px 20px', 
                                                                    fontWeight: 'bold',
                                                                    cursor: 'pointer'
                                                                } 
                                                            }, '❌ Rejeitar')
                                                        )
                                                    )
                                                )
                                        ) : h('div', { style: { textAlign: 'center', padding: '40px', background: '#f8fafc', borderRadius: '12px', border: '2px dashed #d1d5db' } },
                                            h('div', { style: { fontSize: '4rem', marginBottom: '16px' } }, '💸'),
                                            h('p', { style: { fontSize: '1.2rem', fontWeight: 'bold', color: '#6b7280', marginBottom: '8px' } }, 'Nenhuma solicitação ainda'),
                                            h('p', { style: { fontSize: '1rem', color: '#9ca3af' } }, 'Crie sua primeira solicitação usando o formulário acima')
                                        )
                                    )
                                )
                            )
                        );
                    };

                    // Se não logado, mostrar login
                    if (!currentUser) {
                        return h(LoginPage);
                    }

                    // Roteamento das páginas
                    switch (currentView) {
                        case 'checklist':
                            return h(ChecklistPage);
                        case 'auditoria':
                            return h(AuditoriaPage);
                        case 'painel':
                            return h(PainelCidadePage);
                        case 'financeiro':
                            return h(PainelFinanceiroPage);
                        default:
                            return h(DashboardPage);
                    }
                };

                // Renderizar aplicação
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    const root = ReactDOM.createRoot(rootElement);
                    root.render(h(MetaXSystem));
                    console.log('✅ MetaX - Sistema de Auditoria carregado com sucesso!');
                    console.log('🔥 Sistema Financeiro implementado!');
                    console.log('📊 Sistema de pontuação simplificado!');
                    console.log('⚡ Todas as funcionalidades operacionais!');
                } else {
                    throw new Error('Elemento root não encontrado');
                }

            } catch (error) {
                console.error('❌ Erro ao carregar MetaX:', error);
                document.getElementById('root').innerHTML = `
                    <div style="
                        min-height: 100vh;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: linear-gradient(135deg, #ef4444, #dc2626);
                        color: white;
                        font-family: system-ui;
                        text-align: center;
                        padding: 2rem;
                    ">
                        <div style="
                            background: rgba(255,255,255,0.1);
                            backdrop-filter: blur(10px);
                            border-radius: 1rem;
                            padding: 2rem;
                            border: 1px solid rgba(255,255,255,0.2);
                        ">
                            <h1 style="font-size: 3rem; margin-bottom: 1rem;">⚠️</h1>
                            <h2 style="font-size: 1.5rem; margin-bottom: 1rem;">Erro no Sistema MetaX</h2>
                            <p style="margin-bottom: 1.5rem; opacity: 0.9;">${error.message}</p>
                            <button onclick="location.reload()" style="
                                background: white;
                                color: #dc2626;
                                border: none;
                                padding: 0.75rem 1.5rem;
                                border-radius: 0.5rem;
                                font-weight: bold;
                                cursor: pointer;
                                font-size: 1rem;
                            ">
                                🔄 Recarregar Página
                            </button>
                        </div>
                    </div>
                `;
            }
        }, 1000);
    </script>
</body>
</html>
